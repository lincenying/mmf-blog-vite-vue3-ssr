import{v as e,u as E,s as y,b as B,g as C,m as N,f as m,e as f}from"./main-BBnOZaJ_.js";import{u as k}from"./use-global-comment-store-ud-2Leja.js";import{u as V}from"./vue.8fc199ce-DvXPQa2A.js";const b={class:"card"},w={class:"comments"},D={class:"comment-back"},S={class:"comment-items-wrap"},j={href:"javascript:;",class:"comment-author-avatar-link"},M=["src"],$={class:"comment-content-wrap"},x={class:"comment-author-wrap"},A={href:"javascript:;",class:"comment-author"},L={class:"comment-content"},R={class:"comment-footer"},T={class:"comment-time"},P=["onClick"],F=["onClick"],H={key:0,class:"load-more-wrap"},q={key:1,href:"javascript:;",class:"comments-load-more"},J=e.defineComponent({name:"BackendArticleComment",asyncData(i){const{store:l,route:n,api:r}=i;return k(l).getCommentList({page:1,path:n.fullPath,all:1,id:n.params.id},r)},__name:"backend-article-comment",setup(i){const l=E(),n=k(),r=y(n),s=e.toRef(r,"lists"),[d,p]=B(!1);async function u(t=s.value.page){d.value||(p(!0),await n.getCommentList({page:t,path:l.fullPath,all:1,id:l.params.id},m),p(!1))}async function v(t){const{code:a,message:c}=await m.get("frontend/comment/recover",{id:t});a===200&&(f({type:"success",content:c}),n.recoverComment(t))}async function h(t){const{code:a,message:c}=await m.get("frontend/comment/delete",{id:t});a===200&&(f({type:"success",content:c}),n.deleteComment(t))}e.onMounted(()=>{s.value.path===""&&u(1)});const _=e.ref("评论列表 - M.M.F 小屋");return V({title:_,meta:[{name:"description",content:_}]}),(t,a)=>{const c=e.resolveComponent("router-link");return e.openBlock(),e.createElementBlock("div",b,[e.createElementVNode("div",w,[e.createElementVNode("div",D,[e.createVNode(c,{to:"/backend/article/list",class:"btn btn-blue"},{default:e.withCtx(()=>a[1]||(a[1]=[e.createTextVNode("返回")])),_:1})]),e.createElementVNode("div",S,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.data,o=>(e.openBlock(),e.createElementBlock("div",{key:o._id,class:"comment-item"},[e.createElementVNode("a",j,[e.createElementVNode("img",{src:("useAvatar"in t?t.useAvatar:e.unref(C))(o.email),alt:"",class:"avatar-img"},null,8,M)]),e.createElementVNode("div",$,[e.createElementVNode("span",x,[e.createElementVNode("a",A,e.toDisplayString(o.username),1)]),e.createElementVNode("div",L,e.toDisplayString(o.content),1),e.createElementVNode("div",R,[e.createElementVNode("span",T,e.toDisplayString(e.unref(N)(`${o.timestamp}`)),1),o.is_delete?(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comment-action-item comment-reply",onClick:g=>v(o._id)},"恢复",8,P)):(e.openBlock(),e.createElementBlock("a",{key:1,href:"javascript:;",class:"comment-action-item comment-reply",onClick:g=>h(o._id)},"删除",8,F))])])]))),128))]),s.value.hasNext?(e.openBlock(),e.createElementBlock("div",H,[e.unref(d)?(e.openBlock(),e.createElementBlock("a",q,"加载中...")):(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:a[0]||(a[0]=o=>u())},"加载更多"))])):e.createCommentVNode("",!0)])])}}});export{J as default};
