import{v as e,u as E,s as C,b as y,g as B,m as N,f as m,e as f}from"./main-D2Sdt6Zp.js";import{u as h}from"./use-global-comment-store-_IhRfDVo.js";import{u as V}from"./vue.f36acd1f-DwM9bNv8.js";const b={class:"card"},w={class:"comments"},D={class:"comment-back"},S={class:"comment-items-wrap"},j={href:"javascript:;",class:"comment-author-avatar-link"},M=["src"],$={class:"comment-content-wrap"},x={class:"comment-author-wrap"},A={href:"javascript:;",class:"comment-author"},L={class:"comment-content"},R={class:"comment-footer"},T={class:"comment-time"},F=["onClick"],P=["onClick"],G={key:0,class:"load-more-wrap"},H={key:1,href:"javascript:;",class:"comments-load-more"},J=e.defineComponent({name:"BackendArticleComment",asyncData(i){const{store:l,route:a,api:r}=i;return h(l).getCommentList({page:1,path:a.fullPath,all:1,id:a.params.id},r)},__name:"backend-article-comment",setup(i){const l=E(),a=h(),r=C(a),s=e.toRef(r,"lists"),[d,p]=y(!1);async function u(t=s.value.page){d.value||(p(!0),await a.getCommentList({page:t,path:l.fullPath,all:1,id:l.params.id},m),p(!1))}async function k(t){const{code:n,message:c}=await m.get("frontend/comment/recover",{id:t});n===200&&(f({type:"success",content:c}),a.recoverComment(t))}async function v(t){const{code:n,message:c}=await m.get("frontend/comment/delete",{id:t});n===200&&(f({type:"success",content:c}),a.deleteComment(t))}e.onMounted(()=>{s.value.path===""&&u(1)});const _=e.ref("评论列表 - M.M.F 小屋");return V({title:_,meta:[{name:"description",content:_}]}),(t,n)=>{const c=e.resolveComponent("router-link");return e.openBlock(),e.createElementBlock("div",b,[e.createElementVNode("div",w,[e.createElementVNode("div",D,[e.createVNode(c,{to:"/backend/article/list",class:"btn btn-blue"},{default:e.withCtx(()=>[e.createTextVNode("返回")]),_:1})]),e.createElementVNode("div",S,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value.data,o=>(e.openBlock(),e.createElementBlock("div",{key:o._id,class:"comment-item"},[e.createElementVNode("a",j,[e.createElementVNode("img",{src:("useAvatar"in t?t.useAvatar:e.unref(B))(o.email),alt:"",class:"avatar-img"},null,8,M)]),e.createElementVNode("div",$,[e.createElementVNode("span",x,[e.createElementVNode("a",A,e.toDisplayString(o.username),1)]),e.createElementVNode("div",L,e.toDisplayString(o.content),1),e.createElementVNode("div",R,[e.createElementVNode("span",T,e.toDisplayString(e.unref(N)(`${o.timestamp}`)),1),o.is_delete?(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comment-action-item comment-reply",onClick:g=>k(o._id)},"恢复",8,F)):(e.openBlock(),e.createElementBlock("a",{key:1,href:"javascript:;",class:"comment-action-item comment-reply",onClick:g=>v(o._id)},"删除",8,P))])])]))),128))]),s.value.hasNext?(e.openBlock(),e.createElementBlock("div",G,[e.unref(d)?(e.openBlock(),e.createElementBlock("a",H,"加载中...")):(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:n[0]||(n[0]=o=>u())},"加载更多"))])):e.createCommentVNode("",!0)])])}}});export{J as default};
