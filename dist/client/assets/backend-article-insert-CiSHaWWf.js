import{d as B,M as P,N as R,s as T,t as F,r as f,l as H,A as L,I as N,h as j,o as c,c as g,b as o,e as _,w as v,G as y,p as a,H as q,F as E,q as G,j as z,R as J,y as K,x as O,T as Q,L as W,C,V as X,D as V,_ as Y}from"./main-CTY4IKlK.js";import{_ as Z}from"./a-input.vue_vue_type_script_setup_true_lang-oFZQFnI9.js";import{u as M}from"./use-global-category-store-CvhW7WrR.js";import{u as tt}from"./use-backend-article-store-BiUGPQDu.js";import{u as $}from"./upload-api-B8RxlIE4.js";import{u as et}from"./vue.8fc199ce-Bmv443Wm.js";const ot={class:"settings-main card"},st={class:"settings-main-content"},at=["value"],nt={class:"settings-section"},lt={id:"post-content",class:"settings-item-content"},it={class:"settings-footer"},rt={"mr-10px":"","inline-flex":"","items-center":""},gt=B({name:"BackendArticleInsert",asyncData(h){const{store:d,route:u,api:m}=h;return M(d).getCategoryList({limit:99,path:u.fullPath},m)},__name:"backend-article-insert",setup(h){const{ctx:d}=P(),u=R(),m=M(),b=T(m),S=F(b,"lists"),D=tt();let k=f(!1);const i=f(!0),[I,w]=H(!1),s=L({title:"",category:"",content:"",html:""});N(async()=>{k.value=!0});async function U(){if(!s.title||!s.category||!s.content){C("请将表单填写完整!");return}if(I.value)return;if(w(!0),i.value){const l=X.vMdParser.themeConfig.markdownParser.render(s.content);s.html=l}const{code:p,data:t,message:n}=await V.post("backend/article/insert",s);w(!1),p===200&&(C({type:"success",content:n}),D.insertArticleItem(t),u.push("/backend/article/list"))}async function A(p,t,n){const l=d.$loading.show(),r=new FormData;r.append("file",n[0]);try{const{data:e}=await V.file(`${$}/api/fetch/upload`,r);e&&e.filepath&&t({url:`${$}/${e.filepath}`,desc:""})}catch(e){console.log(e)}l.hide()}const x=f("发布文章 - M.M.F 小屋");return et({title:x,meta:[{name:"description",content:x}]}),(p,t)=>{const n=Z,l=j("v-md-editor"),r=Y;return c(),g("div",ot,[o("div",st,[_(n,{title:"标题"},{default:v(()=>[y(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a(s).title=e),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[q,a(s).title]]),t[4]||(t[4]=o("span",{class:"input-info error"},"请输入标题",-1))]),_:1}),_(n,{title:"分类",classes:"select-item-wrap"},{default:v(()=>[t[6]||(t[6]=o("i",{class:"icon icon-arrow-down"},null,-1)),y(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>a(s).category=e),class:"select-item",name:"category"},[t[5]||(t[5]=o("option",{value:""},"请选择分类",-1)),(c(!0),g(E,null,G(S.value,e=>(c(),g("option",{key:e._id,value:`${e._id}|${e.cate_name}`},z(e.cate_name),9,at))),128))],512),[[J,a(s).category]]),t[7]||(t[7]=o("span",{class:"input-info error"},"请输入分类",-1))]),_:1}),o("div",nt,[o("div",lt,[_(r,null,{default:v(()=>[a(k)?(c(),K(l,{key:0,modelValue:a(s).content,"onUpdate:modelValue":t[2]||(t[2]=e=>a(s).content=e),"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:A},null,8,["modelValue"])):O("",!0)]),_:1})])])]),o("div",it,[o("label",rt,[y(o("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>W(i)?i.value=e:null),type:"checkbox",value:"1"},null,512),[[Q,a(i)]]),t[8]||(t[8]=o("span",{"ml-5px":""},"使用前端生成Html?",-1))]),o("a",{href:"javascript:;",class:"btn btn-yellow",onClick:U},"添加文章")])])}}});export{gt as default};
