import{e as P,s as C,c as M,_ as A}from"./main-Bpljy6lB.js";import{_ as F}from"./a-input.vue_vue_type_script_setup_true_lang-gsShgKbE.js";import{d as L,s as R,B as T,r as f,w as H,h as N,o as E,a2 as G,c as g,g as o,K as _,L as v,F as y,af as j,u as s,ad as q,Y as J,M as K,f as c,G as O,ag as Y,a7 as z,a8 as Q,a6 as W,O as X,e as Z,J as ee}from"./vendor-C8cObGch.js";import{u as V}from"./use-global-category-store-BoSDKVum.js";import{u as te}from"./use-backend-article-store-IOWC6QEw.js";import{u as $}from"./upload-api-B8RxlIE4.js";/* empty css               */const oe={class:"settings-main card"},ae={class:"settings-main-content"},se=["value"],ne={class:"settings-section"},le={id:"post-content",class:"settings-item-content"},ie={class:"settings-footer"},re={"mr-10px":"","inline-flex":"","items-center":""},_e=L({name:"BackendArticleInsert",asyncData(h){const{store:d,route:u,api:m}=h;return V(d).getCategoryList({limit:99,path:u.fullPath},m)},__name:"backend-article-insert",setup(h){const{ctx:d}=P(),u=K(),m=V(),b=R(m),S=T(b,"lists"),B=te();let k=f(!1);const i=f(!0),[U,w]=H(!1),a=N({title:"",category:"",content:"",html:""});E(async()=>{k.value=!0});async function D(){if(!a.title||!a.category||!a.content){C("请将表单填写完整!");return}if(U.value)return;if(w(!0),i.value){const l=J.vMdParser.themeConfig.markdownParser.render(a.content);a.html=l}const{code:p,data:e,message:n}=await M.post("backend/article/insert",a);w(!1),p===200&&(C({type:"success",content:n}),B.insertArticleItem(e),u.push("/backend/article/list"))}async function I(p,e,n){const l=d.$loading.show(),r=new FormData;r.append("file",n[0]);try{const{data:t}=await M.file(`${$}/api/fetch/upload`,r);t&&t.filepath&&e({url:`${$}/${t.filepath}`,desc:""})}catch(t){console.log(t)}l.hide()}const x=f("发布文章 - M.M.F 小屋");return G({title:x,meta:[{name:"description",content:x}]}),(p,e)=>{const n=F,l=ee("v-md-editor"),r=A;return c(),g("div",oe,[o("div",ae,[_(n,{title:"标题"},{default:v(()=>[y(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).title=t),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[O,s(a).title]]),e[4]||(e[4]=o("span",{class:"input-info error"},"请输入标题",-1))]),_:1}),_(n,{title:"分类",classes:"select-item-wrap"},{default:v(()=>[e[6]||(e[6]=o("i",{class:"icon icon-arrow-down"},null,-1)),y(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s(a).category=t),class:"select-item",name:"category"},[e[5]||(e[5]=o("option",{value:""},"请选择分类",-1)),(c(!0),g(z,null,Q(S.value,t=>(c(),g("option",{key:t._id,value:`${t._id}|${t.cate_name}`},W(t.cate_name),9,se))),128))],512),[[Y,s(a).category]]),e[7]||(e[7]=o("span",{class:"input-info error"},"请输入分类",-1))]),_:1}),o("div",ne,[o("div",le,[_(r,null,{default:v(()=>[s(k)?(c(),X(l,{key:0,modelValue:s(a).content,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).content=t),"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:I},null,8,["modelValue"])):Z("",!0)]),_:1})])])]),o("div",ie,[o("label",re,[y(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>q(i)?i.value=t:null),type:"checkbox",value:"1"},null,512),[[j,s(i)]]),e[8]||(e[8]=o("span",{"ml-5px":""},"使用前端生成Html?",-1))]),o("a",{href:"javascript:;",class:"btn btn-yellow",onClick:D},"添加文章")])])}}});export{_e as default};
