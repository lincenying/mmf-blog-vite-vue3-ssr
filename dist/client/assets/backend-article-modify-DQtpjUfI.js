import{e as L,_ as j,s as C,c as V}from"./main-C-aJ0Mow.js";import{_ as q}from"./a-input.vue_vue_type_script_setup_true_lang-vtPVtJw7.js";import{d as E,y as $,F as S,q as G,r as U,h as J,x as K,ae as A,g as Y,a2 as z,c as y,o as b,b as o,J as d,K as p,w as v,G as O,u as i,ac as Q,a8 as W,a9 as X,M as D,ad as Z,aa as tt,a5 as et,Y as ot,N as at,a6 as st}from"./vendor-BNfFymli.js";import{u as P}from"./use-global-category-store-BdIPzeg9.js";import{u as nt}from"./use-backend-article-store-DQ_sWuxE.js";import{u as R}from"./upload-api-B8RxlIE4.js";/* empty css               */const it={class:"settings-main card"},lt={class:"settings-main-content"},rt=["value"],dt={class:"settings-section"},ct={id:"modify-content",class:"settings-item-content"},ut={class:"settings-footer"},mt={"mr-10px":"","inline-flex":"","items-center":""},ht=E({name:"BackendArticleModify",asyncData(h){const{store:f,route:c,api:_}=h;return P(f).getCategoryList({limit:99,path:c.fullPath},_)},__name:"backend-article-modify",setup(h){const{ctx:f}=L(),c=K(),_=at(),k=P(),T=$(k),w=S(T,"lists"),g=nt(),B=$(g),F=S(B,"item"),[I,x]=G(!1),u=U(!0),e=J({id:c.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});A(()=>e.category,a=>{const t=w.value.find(n=>n._id===a);t&&(e.category_name=t.cate_name)}),A(()=>F.value,a=>{a.data&&(e.title=a.data.title,e.category_old=a.data.category,e.category=a.data.category,e.content=a.data.content)},{deep:!0,immediate:!0}),Y(async()=>{g.getArticleItem({id:c.params.id})});async function N(){if(!e.title||!e.category||!e.content){C("请将表单填写完整!");return}if(I.value)return;if(x(!0),u.value){const l=ot.vMdParser.themeConfig.markdownParser.render(e.content);e.html=l}const{code:a,data:t,message:n}=await V.post("backend/article/modify",e);x(!1),a===200&&(C({type:"success",content:n}),g.updateArticleItem(t),_.push("/backend/article/list"))}async function H(a,t,n){const l=f.$loading.show(),m=new FormData;m.append("file",n[0]);const{data:r}=await V.file(`${R}/api/fetch/upload`,m);r&&r.filepath&&t({url:`${R}/${r.filepath}`,desc:""}),l.hide()}const M=U("编辑文章 - M.M.F 小屋");return z({title:M,meta:[{name:"description",content:M}]}),(a,t)=>{const n=q,l=D("v-md-editor"),m=j,r=D("router-link");return b(),y("div",it,[o("div",lt,[d(n,{title:"标题"},{default:p(()=>[v(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>i(e).title=s),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[O,i(e).title]]),t[4]||(t[4]=o("span",{class:"input-info error"},"请输入标题",-1))]),_:1,__:[4]}),d(n,{title:"分类",classes:"select-item-wrap"},{default:p(()=>[t[6]||(t[6]=o("i",{class:"icon icon-arrow-down"},null,-1)),v(o("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>i(e).category=s),class:"select-item",name:"category"},[t[5]||(t[5]=o("option",{value:""},"请选择分类",-1)),(b(!0),y(W,null,X(w.value,s=>(b(),y("option",{key:s._id,value:s._id},st(s.cate_name),9,rt))),128))],512),[[Q,i(e).category]]),t[7]||(t[7]=o("span",{class:"input-info error"},"请输入分类",-1))]),_:1,__:[6,7]}),o("div",dt,[o("div",ct,[d(m,null,{default:p(()=>[d(l,{modelValue:i(e).content,"onUpdate:modelValue":t[2]||(t[2]=s=>i(e).content=s),"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:H},null,8,["modelValue"])]),_:1})])])]),o("div",ut,[o("label",mt,[v(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>tt(u)?u.value=s:null),type:"checkbox",value:"1"},null,512),[[Z,i(u)]]),t[8]||(t[8]=o("span",{"ml-5px":""},"使用前端生成Html?",-1))]),o("a",{href:"javascript:;",class:"btn btn-yellow",onClick:N},"编辑文章"),d(r,{to:"/backend/article/list",class:"btn btn-blue"},{default:p(()=>t[9]||(t[9]=[et("返回")])),_:1,__:[9]})])])}}});export{ht as default};
