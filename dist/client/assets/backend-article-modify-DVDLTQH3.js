import{v as e,i as S,u as B,j as D,s as v,b as R,e as b,V as U,f as h,_ as A}from"./main-BBnOZaJ_.js";import{_ as P}from"./a-input.vue_vue_type_script_setup_true_lang-CsH4OfB8.js";import{u as k}from"./use-global-category-store-BpjaM1BR.js";import{u as T}from"./use-backend-article-store-wuXV6Y7B.js";import{u as w}from"./upload-api-B8RxlIE4.js";import{u as I}from"./vue.8fc199ce-DvXPQa2A.js";const j={class:"settings-main card"},F={class:"settings-main-content"},H=["value"],L={class:"settings-section"},q={id:"modify-content",class:"settings-item-content"},G={class:"settings-footer"},z={"mr-10px":"","inline-flex":"","items-center":""},Y=e.defineComponent({name:"BackendArticleModify",asyncData(f){const{store:m,route:r,api:u}=f;return k(m).getCategoryList({limit:99,path:r.fullPath},u)},__name:"backend-article-modify",setup(f){const{ctx:m}=S(),r=B(),u=D(),g=k(),N=v(g),_=e.toRef(N,"lists"),p=T(),E=v(p),x=e.toRef(E,"item"),[C,y]=R(!1),c=e.ref(!0),o=e.reactive({id:r.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});e.watch(()=>o.category,n=>{const t=_.value.find(l=>l._id===n);t&&(o.category_name=t.cate_name)}),e.watch(()=>x.value,n=>{n.data&&(o.title=n.data.title,o.category_old=n.data.category,o.category=n.data.category,o.content=n.data.content)},{deep:!0}),e.onMounted(async()=>{p.getArticleItem({id:r.params.id})});async function M(){if(!o.title||!o.category||!o.content){b("请将表单填写完整!");return}if(C.value)return;if(y(!0),c.value){const s=U.vMdParser.themeConfig.markdownParser.render(o.content);o.html=s}const{code:n,data:t,message:l}=await h.post("backend/article/modify",o);y(!1),n===200&&(b({type:"success",content:l}),p.updateArticleItem(t),u.push("/backend/article/list"))}async function $(n,t,l){const s=m.$loading.show(),d=new FormData;d.append("file",l[0]);const{data:i}=await h.file(`${w}/api/fetch/upload`,d);i&&i.filepath&&t({url:`${w}/${i.filepath}`,desc:""}),s.hide()}const V=e.ref("编辑文章 - M.M.F 小屋");return I({title:V,meta:[{name:"description",content:V}]}),(n,t)=>{const l=P,s=e.resolveComponent("v-md-editor"),d=A,i=e.resolveComponent("router-link");return e.openBlock(),e.createElementBlock("div",j,[e.createElementVNode("div",F,[e.createVNode(l,{title:"标题"},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>e.unref(o).title=a),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[e.vModelText,e.unref(o).title]]),t[4]||(t[4]=e.createElementVNode("span",{class:"input-info error"},"请输入标题",-1))]),_:1}),e.createVNode(l,{title:"分类",classes:"select-item-wrap"},{default:e.withCtx(()=>[t[6]||(t[6]=e.createElementVNode("i",{class:"icon icon-arrow-down"},null,-1)),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>e.unref(o).category=a),class:"select-item",name:"category"},[t[5]||(t[5]=e.createElementVNode("option",{value:""},"请选择分类",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.value,a=>(e.openBlock(),e.createElementBlock("option",{key:a._id,value:a._id},e.toDisplayString(a.cate_name),9,H))),128))],512),[[e.vModelSelect,e.unref(o).category]]),t[7]||(t[7]=e.createElementVNode("span",{class:"input-info error"},"请输入分类",-1))]),_:1}),e.createElementVNode("div",L,[e.createElementVNode("div",q,[e.createVNode(d,null,{default:e.withCtx(()=>[e.createVNode(s,{modelValue:e.unref(o).content,"onUpdate:modelValue":t[2]||(t[2]=a=>e.unref(o).content=a),"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:$},null,8,["modelValue"])]),_:1})])])]),e.createElementVNode("div",G,[e.createElementVNode("label",z,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>e.isRef(c)?c.value=a:null),type:"checkbox",value:"1"},null,512),[[e.vModelCheckbox,e.unref(c)]]),t[8]||(t[8]=e.createElementVNode("span",{"ml-5px":""},"使用前端生成Html?",-1))]),e.createElementVNode("a",{href:"javascript:;",class:"btn btn-yellow",onClick:M},"编辑文章"),e.createVNode(i,{to:"/backend/article/list",class:"btn btn-blue"},{default:e.withCtx(()=>t[9]||(t[9]=[e.createTextVNode("返回")])),_:1})])])}}});export{Y as default};
