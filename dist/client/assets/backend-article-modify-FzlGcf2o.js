import{v as e,i as M,u as S,j as $,s as h,b as A,e as V,f as b,_ as D}from"./main-wXgH7lLL.js";import{_ as R}from"./a-input.vue_vue_type_script_setup_true_lang-HrA5Vu1V.js";import{u as v}from"./upload-api-uVvbjo2i.js";import{u as k}from"./use-global-category-store-id0GnSUP.js";import{u as T}from"./use-backend-article-store-_O15z-fU.js";import{u as U}from"./vue.f36acd1f-YJpvjER5.js";const j={class:"settings-main card"},I={class:"settings-main-content"},F=e.createElementVNode("span",{class:"input-info error"},"请输入标题",-1),L=e.createElementVNode("i",{class:"icon icon-arrow-down"},null,-1),G=e.createElementVNode("option",{value:""},"请选择分类",-1),H=["value"],P=e.createElementVNode("span",{class:"input-info error"},"请输入分类",-1),q={class:"settings-section"},z={id:"modify-content",class:"settings-item-content"},J={class:"settings-footer"},Z=e.defineComponent({name:"BackendArticleModify",asyncData(p){const{store:r,route:i,api:d}=p;return k(r).getCategoryList({limit:99,path:i.fullPath},d)},__name:"backend-article-modify",setup(p){const{ctx:r}=M(),i=S(),d=$(),_=k(),w=h(_),f=e.toRef(w,"lists"),m=T(),N=h(m),E=e.toRef(N,"item"),[x,g]=A(!1),t=e.reactive({id:i.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});e.watch(()=>t.category,a=>{const o=f.value.find(s=>s._id===a);o&&(t.category_name=o.cate_name)}),e.watch(()=>E.value,a=>{a.data&&(t.title=a.data.title,t.category_old=a.data.category,t.category=a.data.category,t.content=a.data.content)},{deep:!0}),e.onMounted(async()=>{m.getArticleItem({id:i.params.id})});async function C(){if(!t.title||!t.category||!t.content){V("请将表单填写完整!");return}if(x.value)return;g(!0);const{code:a,data:o,message:s}=await b.post("backend/article/modify",t);g(!1),a===200&&(V({type:"success",content:s}),m.updateArticleItem(o),d.push("/backend/article/list"))}async function B(a,o,s){const u=r.$loading.show(),l=new FormData;l.append("file",s[0]);const{data:c}=await b.file(`${v}/ajax.php?action=upload`,l);c&&c.filepath&&o({url:`${v}/${c.filepath}`,desc:""}),u.hide()}const y=e.ref("编辑文章 - M.M.F 小屋");return U({title:y,meta:[{name:"description",content:y}]}),(a,o)=>{const s=R,u=e.resolveComponent("v-md-editor"),l=D,c=e.resolveComponent("router-link");return e.openBlock(),e.createElementBlock("div",j,[e.createElementVNode("div",I,[e.createVNode(s,{title:"标题"},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=n=>e.unref(t).title=n),type:"text",placeholder:"标题",class:"base-input",name:"title"},null,512),[[e.vModelText,e.unref(t).title]]),F]),_:1}),e.createVNode(s,{title:"分类",classes:"select-item-wrap"},{default:e.withCtx(()=>[L,e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":o[1]||(o[1]=n=>e.unref(t).category=n),class:"select-item",name:"category"},[G,(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,n=>(e.openBlock(),e.createElementBlock("option",{key:n._id,value:n._id},e.toDisplayString(n.cate_name),9,H))),128))],512),[[e.vModelSelect,e.unref(t).category]]),P]),_:1}),e.createElementVNode("div",q,[e.createElementVNode("div",z,[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(u,{modelValue:e.unref(t).content,"onUpdate:modelValue":o[2]||(o[2]=n=>e.unref(t).content=n),"disabled-menus":[],mode:"edit",height:"500px",onUploadImage:B},null,8,["modelValue"])]),_:1})])])]),e.createElementVNode("div",J,[e.createElementVNode("a",{href:"javascript:;",class:"btn btn-yellow",onClick:C},"编辑文章"),e.createVNode(c,{to:"/backend/article/list",class:"btn btn-blue"},{default:e.withCtx(()=>[e.createTextVNode("返回")]),_:1})])])}}});export{Z as default};
