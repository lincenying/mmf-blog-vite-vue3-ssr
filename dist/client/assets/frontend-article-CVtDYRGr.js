import{_ as tt,a as et,b as st}from"./item-actions.vue_vue_type_script_setup_true_lang-BG621-Tm.js";import{u as E,_ as ot}from"./use-frontend-article-store-BwR25q4X.js";import{a as nt,b as at,s as R,c as ct,d as H,u as it,_ as rt}from"./main-Bpljy6lB.js";import{d as J,t as O,B as x,w as lt,h as dt,q as mt,k as q,c as o,g as t,e as I,u as i,F as ut,G as _t,a7 as B,a8 as K,f as n,a6 as C,s as V,r as z,aa as pt,o as ht,a2 as vt,K as a,L as h,J as ft,a5 as M,a9 as gt,ab as yt,n as $t,ac as wt}from"./vendor-C8cObGch.js";import{u as D}from"./use-global-comment-store-Bxcgx7dV.js";import{u as G}from"./use-global-category-store-BoSDKVum.js";/* empty css               */const kt={class:"card"},xt={class:"comments"},Ct={class:"comment-post-wrap"},bt=["src"],St={class:"comment-post-input-wrap base-textarea-wrap"},At={class:"comment-post-actions"},Lt={class:"comment-items-wrap"},Tt={href:"javascript:;",class:"comment-author-avatar-link"},Mt=["src"],qt={class:"comment-content-wrap"},Ft={class:"comment-author-wrap"},Nt={href:"javascript:;",class:"comment-author"},Pt={class:"comment-content"},jt={class:"comment-footer"},Rt={class:"comment-time"},Vt=["onClick"],It={key:0,class:"load-more-wrap"},Bt={key:1,href:"javascript:;",class:"comments-load-more"},Dt=J({name:"FrontendComment",__name:"frontend-comment",props:{comments:{}},setup(F){const b=O(F),r=x(b,"comments"),v=nt(),f=O(v),g=x(f,"cookies"),y=D(),[S,c]=lt(!1),N=mt(),u=dt({id:N.params.id,content:""}),P=q(()=>g.value.user),_=q(()=>g.value.useremail);async function A(){c(!0),await y.getCommentList({id:N.params.id,page:r.value.page+1,limit:10}),c(!1)}const $=at(async()=>{if(!P.value)R("请先登录!"),v.setLoginModal(!0);else if(u.content==="")R("请输入评论内容!");else{const{code:l,data:d}=await ct.post("frontend/comment/insert",u);l===200&&(u.content="",R({type:"success",content:"评论发布成功!"}),y.insertCommentItem(d))}});function j(l){var s;u.content=`回复 @${(s=l.userid)==null?void 0:s.username}: `,document.querySelector("#content").focus()}return(l,d)=>(n(),o("div",kt,[t("div",xt,[t("div",Ct,[t("img",{src:("useAvatar"in l?l.useAvatar:i(H))(_.value),alt:"",class:"avatar-img"},null,8,bt),t("div",St,[ut(t("textarea",{id:"content","onUpdate:modelValue":d[0]||(d[0]=s=>i(u).content=s),class:"base-input textarea-input",cols:"30",rows:"4"},null,512),[[_t,i(u).content]])]),t("div",At,[t("a",{href:"javascript:;",class:"btn btn-blue",onClick:d[1]||(d[1]=(...s)=>i($)&&i($)(...s))},"发表评论")])]),t("div",Lt,[(n(!0),o(B,null,K(r.value.data,s=>(n(),o("div",{key:s._id,class:"comment-item"},[t("a",Tt,[t("img",{src:("useAvatar"in l?l.useAvatar:i(H))(s.userid.email),alt:"",class:"avatar-img"},null,8,Mt)]),t("div",qt,[t("span",Ft,[t("a",Nt,C(s.userid.username),1)]),t("div",Pt,C(s.content),1),t("div",jt,[t("span",Rt,C(s.creat_date),1),t("a",{href:"javascript:;",class:"comment-action-item comment-reply",onClick:e=>j(s)},"回复",8,Vt)])])]))),128))]),r.value.hasNext?(n(),o("div",It,[i(S)?(n(),o("a",Bt,"加载中...")):(n(),o("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:A},"加载更多"))])):I("",!0)])]))}}),Et={class:"main wrap"},Ht={class:"main-left"},Ot={key:0,class:"card card-content-loader"},zt={key:0,class:"toc"},Gt={class:"card card-trending"},Jt={class:"card-content"},Kt=["onClick"],Ut={class:"card card-question-head"},Qt={class:"question-content"},Wt={class:"question-title"},Xt={class:"card card-answer"},Yt={class:"answer-content"},Zt=["innerHTML"],te={key:2,class:"card card-answer"},ee={class:"main-right"},de=J({name:"FrontendArticle",asyncData(F){const{store:w,route:b,api:r}=F,{fullPath:v,params:{id:f}}=b,g=G(w),y=E(w),S=D(w);return Promise.all([g.getCategoryList({},r),y.getTrending(void 0,r),S.getCommentList({id:f,path:v,page:1,limit:10},r),y.getArticleItem({id:f,path:v},r)])},__name:"frontend-article",setup(F){const w=G(),b=V(w),r=x(b,"lists"),v=E(),f=V(v),g=x(f,"item"),y=x(f,"trending"),S=q(()=>g.value.isLoad),c=q(()=>g.value.data),N=D(),u=V(N),P=x(u,"lists");it();const _=z("none"),A=pt("preview"),$=z([]);function j(){var p;const s=(p=A.value)==null?void 0:p.querySelectorAll("h1,h2,h3,h4,h5,h6");if(!s)return;const e=Array.from(s).filter(m=>!!m.textContent.trim());if(!e.length){$.value=[];return}const k=Array.from(new Set(e.map(m=>m.tagName))).sort();$.value=e.map(m=>{var L;return{title:((L=m.textContent)==null?void 0:L.trim())||"",lineIndex:m.getAttribute("data-v-md-line"),indent:k.indexOf(m.tagName)}}),$.value.length?_.value="show":_.value="none"}function l(s){var p;const{lineIndex:e}=s,k=(p=A.value)==null?void 0:p.querySelector(`[data-v-md-line="${e}"]`);k&&k.scrollIntoView({behavior:"smooth"})}ht(()=>{j()});const d=q(()=>{var e;let s="M.M.F 小屋";return s=(e=c.value)!=null&&e.title?`${c.value.title} - M.M.F 小屋`:"M.M.F 小屋",s});return vt({title:d,meta:[{name:"description",content:d}]}),(s,e)=>{const k=yt,p=wt,m=rt,L=ft("router-link"),U=tt,Q=Dt,W=et,X=ot,Y=st;return n(),o("div",Et,[t("div",Ht,[S.value?c.value?(n(),o(B,{key:1},[a(m,null,{default:h(()=>[i(_)==="show"?(n(),o("div",zt,[t("div",Gt,[e[3]||(e[3]=t("h2",{class:"card-title"},"文章导航",-1)),t("div",Jt,[a(k,{"max-height":"calc(100vh - 150px)"},{default:h(()=>[(n(!0),o(B,null,K(i($),(T,Z)=>(n(),o("div",{key:Z,class:"toc-item",style:$t(`--padding-left: ${T.indent*20}px`),onClick:se=>l(T)},C(T.title),13,Kt))),128))]),_:1})])]),t("div",{class:"btn-toc close-toc",onClick:e[0]||(e[0]=T=>_.value="hide")},[a(p,{class:"box-item",effect:"dark",content:"收起导航",placement:"top"},{default:h(()=>[...e[4]||(e[4]=[t("i",{class:"i-mdi-transfer-left"},null,-1)])]),_:1})])])):I("",!0)]),_:1}),t("div",Ut,[t("div",Qt,[a(L,{to:`/category/${c.value.category}`,class:"topic-link-item"},{default:h(()=>[M(C(c.value.category_name),1)]),_:1},8,["to"]),t("h2",Wt,[a(L,{to:`/article/${c.value._id}`,class:"question-title-link"},{default:h(()=>[M(C(c.value.title),1)]),_:1},8,["to"])])]),a(m,null,{default:h(()=>[i(_)==="hide"?(n(),o("div",{key:0,class:"btn-toc open-toc",onClick:e[1]||(e[1]=T=>_.value="show")},[a(p,{class:"box-item",effect:"dark",content:"展开导航",placement:"top"},{default:h(()=>[...e[5]||(e[5]=[t("i",{class:"i-mdi-transfer-right"},null,-1)])]),_:1})])):I("",!0)]),_:1})]),t("div",Xt,[t("div",Yt,[t("div",{ref_key:"preview",ref:A,class:"markdown-body vuepress-markdown-body github-markdown-body article-content",innerHTML:c.value.html},null,8,Zt)]),a(U,{item:c.value},null,8,["item"])]),a(Q,{comments:P.value},null,8,["comments"])],64)):(n(),o("div",te,[...e[6]||(e[6]=[t("div",{class:"answer-content"},"该文章不存在, 或者该文章已经被删除",-1)])])):(n(),o("div",Ot,[a(i(gt),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:h(()=>[...e[2]||(e[2]=[t("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"},null,-1),M(),t("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"},null,-1),t("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"},null,-1),M(),t("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"},null,-1),t("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"},null,-1),M(),t("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"},null,-1),t("circle",{cx:"30",cy:"30",r:"30"},null,-1)])]),_:1})]))]),t("div",ee,[a(W,{category:r.value},null,8,["category"]),a(X,{trending:y.value},null,8,["trending"]),a(Y)])])}}});export{de as default};
