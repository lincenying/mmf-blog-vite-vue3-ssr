import{C as b,_ as L,a as T,b as M}from"./vue-content-loader.es-HJG41hNm.js";import{u as w,_ as R}from"./use-frontend-article-store-wJWlJhmQ.js";import{v as e,c as A,b as F,u as D,d as j,e as y,f as q,g as C,s as E,a as P}from"./main-XEZyR5BI.js";import{u as k}from"./use-global-comment-store-yBGbetxC.js";import{u as x}from"./use-global-category-store-rJyqS94f.js";import{u as H}from"./vue.f36acd1f-SeFXRhf0.js";const G={class:"card"},I={class:"comments"},U={class:"comment-post-wrap"},z=["src"],J={class:"comment-post-input-wrap base-textarea-wrap"},K={class:"comment-post-actions"},O={class:"comment-items-wrap"},Q={href:"javascript:;",class:"comment-author-avatar-link"},W=["src"],X={class:"comment-content-wrap"},Y={class:"comment-author-wrap"},Z={href:"javascript:;",class:"comment-author"},ee={class:"comment-content"},te={class:"comment-footer"},oe={class:"comment-time"},ne=["onClick"],ae={key:0,class:"load-more-wrap"},se={key:1,href:"javascript:;",class:"comments-load-more"},ce=e.defineComponent({name:"FrontendComment",__name:"frontend-comment",props:{comments:null},setup(f){const l=f,u=e.toRefs(l),a=e.toRef(u,"comments"),i=A(),d=e.toRefs(i),m=e.toRef(d,"cookies"),_=k(),[p,o]=F(!1),v=D(),r=e.reactive({id:v.params.id,content:""}),N=e.computed(()=>m.value.user),V=e.computed(()=>m.value.useremail);async function g(){o(!0),await _.getCommentList({id:v.params.id,page:a.value.page+1,limit:10}),o(!1)}const s=j(async()=>{if(!N.value)y("请先登录!"),i.setLoginModal(!0);else if(r.content==="")y("请输入评论内容!");else{const{code:n,data:c}=await q.post("frontend/comment/insert",r);n===200&&(r.content="",y({type:"success",content:"评论发布成功!"}),_.insertCommentItem(c))}});function h(n){var t;r.content=`回复 @${(t=n.userid)==null?void 0:t.username}: `,document.querySelector("#content").focus()}return(n,c)=>(e.openBlock(),e.createElementBlock("div",G,[e.createElementVNode("div",I,[e.createElementVNode("div",U,[e.createElementVNode("img",{src:("useAvatar"in n?n.useAvatar:e.unref(C))(V.value),alt:"",class:"avatar-img"},null,8,z),e.createElementVNode("div",J,[e.withDirectives(e.createElementVNode("textarea",{id:"content","onUpdate:modelValue":c[0]||(c[0]=t=>e.unref(r).content=t),class:"base-input textarea-input",cols:"30",rows:"4"},null,512),[[e.vModelText,e.unref(r).content]])]),e.createElementVNode("div",K,[e.createElementVNode("a",{href:"javascript:;",class:"btn btn-blue",onClick:c[1]||(c[1]=(...t)=>e.unref(s)&&e.unref(s)(...t))},"发表评论")])]),e.createElementVNode("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.data,t=>(e.openBlock(),e.createElementBlock("div",{key:t._id,class:"comment-item"},[e.createElementVNode("a",Q,[e.createElementVNode("img",{src:("useAvatar"in n?n.useAvatar:e.unref(C))(t.userid.email),alt:"",class:"avatar-img"},null,8,W)]),e.createElementVNode("div",X,[e.createElementVNode("span",Y,[e.createElementVNode("a",Z,e.toDisplayString(t.userid.username),1)]),e.createElementVNode("div",ee,e.toDisplayString(t.content),1),e.createElementVNode("div",te,[e.createElementVNode("span",oe,e.toDisplayString(t.creat_date),1),e.createElementVNode("a",{href:"javascript:;",class:"comment-action-item comment-reply",onClick:$=>h(t)},"回复",8,ne)])])]))),128))]),a.value.hasNext?(e.openBlock(),e.createElementBlock("div",ae,[e.unref(p)?(e.openBlock(),e.createElementBlock("a",se,"加载中...")):(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:g},"加载更多"))])):e.createCommentVNode("",!0)])]))}}),re={class:"main wrap"},le={class:"main-left"},ie={key:0,class:"card card-content-loader"},de=e.createElementVNode("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"},null,-1),me=e.createElementVNode("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"},null,-1),_e=e.createElementVNode("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"},null,-1),ue=e.createElementVNode("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"},null,-1),pe=e.createElementVNode("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"},null,-1),he=e.createElementVNode("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"},null,-1),fe=e.createElementVNode("circle",{cx:"30",cy:"30",r:"30"},null,-1),ve={class:"card card-question-head"},ge={class:"question-content"},Ne={class:"question-title"},Ve={class:"card card-answer"},ye={class:"answer-content"},Ee=["innerHTML"],ke={key:2,class:"card card-answer"},$e=e.createElementVNode("div",{class:"answer-content"},"该文章不存在, 或者该文章已经被删除",-1),we=[$e],Ce={class:"main-right"},Me=e.defineComponent({name:"FrontendArticle",asyncData(f){const{store:l,route:u,api:a}=f,{fullPath:i,params:{id:d}}=u,m=x(l),_=w(l),p=k(l);return Promise.all([m.getCategoryList({},a),_.getTrending({},a),p.getCommentList({id:d,path:i,page:1,limit:10},a),_.getArticleItem({id:d,path:i},a)])},__name:"frontend-article",setup(f){const l=x(),u=E(l),a=e.toRef(u,"lists"),i=w(),d=E(i),m=e.toRef(d,"item"),_=e.toRef(d,"trending"),p=e.computed(()=>m.value.isLoad),o=e.computed(()=>m.value.data),v=k(),r=E(v),N=e.toRef(r,"lists");P();function V(s){return s?s.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}e.onMounted(()=>{});const g=e.computed(()=>{var h;let s="M.M.F 小屋";return s=(h=o.value)!=null&&h.title?`${o.value.title} - M.M.F 小屋`:"M.M.F 小屋",s});return H({title:g,meta:[{name:"description",content:g}]}),(s,h)=>{const n=e.resolveComponent("router-link"),c=L,t=ce,$=T,B=R,S=M;return e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("div",le,[p.value?o.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",ve,[e.createElementVNode("div",ge,[e.createVNode(n,{to:`/category/${o.value.category}`,class:"topic-link-item"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.category_name),1)]),_:1},8,["to"]),e.createElementVNode("h2",Ne,[e.createVNode(n,{to:`/article/${o.value._id}`,class:"question-title-link"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.title),1)]),_:1},8,["to"])])])]),e.createElementVNode("div",Ve,[e.createElementVNode("div",ye,[e.createElementVNode("div",{class:"markdown-body article-content",innerHTML:V(o.value.html)},null,8,Ee)]),e.createVNode(c,{item:o.value},null,8,["item"])]),e.createVNode(t,{comments:N.value},null,8,["comments"])],64)):(e.openBlock(),e.createElementBlock("div",ke,we)):(e.openBlock(),e.createElementBlock("div",ie,[e.createVNode(e.unref(b),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:e.withCtx(()=>[de,e.createTextVNode(),me,_e,e.createTextVNode(),ue,pe,e.createTextVNode(),he,fe]),_:1})]))]),e.createElementVNode("div",Ce,[e.createVNode($,{category:a.value},null,8,["category"]),e.createVNode(B,{trending:_.value},null,8,["trending"]),e.createVNode(S)])])}}});export{Me as default};
