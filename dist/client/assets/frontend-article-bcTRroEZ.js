import{C as S,_ as L,a as T,b as M}from"./vue-content-loader.es-tzqubSEG.js";import{u as $,_ as R}from"./use-frontend-article-store-BOVOJ0x2.js";import{v as e,c as A,b as D,u as F,d as P,e as y,f as j,g as x,s as E,a as q}from"./main-BBnOZaJ_.js";import{u as k}from"./use-global-comment-store-ud-2Leja.js";import{u as C}from"./use-global-category-store-BpjaM1BR.js";import{u as H}from"./vue.8fc199ce-DvXPQa2A.js";const I={class:"card"},U={class:"comments"},z={class:"comment-post-wrap"},G=["src"],J={class:"comment-post-input-wrap base-textarea-wrap"},K={class:"comment-post-actions"},O={class:"comment-items-wrap"},Q={href:"javascript:;",class:"comment-author-avatar-link"},W=["src"],X={class:"comment-content-wrap"},Y={class:"comment-author-wrap"},Z={href:"javascript:;",class:"comment-author"},ee={class:"comment-content"},te={class:"comment-footer"},oe={class:"comment-time"},ne=["onClick"],ae={key:0,class:"load-more-wrap"},se={key:1,href:"javascript:;",class:"comments-load-more"},ce=e.defineComponent({name:"FrontendComment",__name:"frontend-comment",props:{comments:{}},setup(v){const i=v,p=e.toRefs(i),a=e.toRef(p,"comments"),m=A(),d=e.toRefs(m),u=e.toRef(d,"cookies"),_=k(),[h,o]=D(!1),f=F(),l=e.reactive({id:f.params.id,content:""}),N=e.computed(()=>u.value.user),V=e.computed(()=>u.value.useremail);async function g(){o(!0),await _.getCommentList({id:f.params.id,page:a.value.page+1,limit:10}),o(!1)}const s=P(async()=>{if(!N.value)y("请先登录!"),m.setLoginModal(!0);else if(l.content==="")y("请输入评论内容!");else{const{code:n,data:r}=await j.post("frontend/comment/insert",l);n===200&&(l.content="",y({type:"success",content:"评论发布成功!"}),_.insertCommentItem(r))}});function c(n){var t;l.content=`回复 @${(t=n.userid)==null?void 0:t.username}: `,document.querySelector("#content").focus()}return(n,r)=>(e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("div",U,[e.createElementVNode("div",z,[e.createElementVNode("img",{src:("useAvatar"in n?n.useAvatar:e.unref(x))(V.value),alt:"",class:"avatar-img"},null,8,G),e.createElementVNode("div",J,[e.withDirectives(e.createElementVNode("textarea",{id:"content","onUpdate:modelValue":r[0]||(r[0]=t=>e.unref(l).content=t),class:"base-input textarea-input",cols:"30",rows:"4"},null,512),[[e.vModelText,e.unref(l).content]])]),e.createElementVNode("div",K,[e.createElementVNode("a",{href:"javascript:;",class:"btn btn-blue",onClick:r[1]||(r[1]=(...t)=>e.unref(s)&&e.unref(s)(...t))},"发表评论")])]),e.createElementVNode("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.data,t=>(e.openBlock(),e.createElementBlock("div",{key:t._id,class:"comment-item"},[e.createElementVNode("a",Q,[e.createElementVNode("img",{src:("useAvatar"in n?n.useAvatar:e.unref(x))(t.userid.email),alt:"",class:"avatar-img"},null,8,W)]),e.createElementVNode("div",X,[e.createElementVNode("span",Y,[e.createElementVNode("a",Z,e.toDisplayString(t.userid.username),1)]),e.createElementVNode("div",ee,e.toDisplayString(t.content),1),e.createElementVNode("div",te,[e.createElementVNode("span",oe,e.toDisplayString(t.creat_date),1),e.createElementVNode("a",{href:"javascript:;",class:"comment-action-item comment-reply",onClick:w=>c(t)},"回复",8,ne)])])]))),128))]),a.value.hasNext?(e.openBlock(),e.createElementBlock("div",ae,[e.unref(h)?(e.openBlock(),e.createElementBlock("a",se,"加载中...")):(e.openBlock(),e.createElementBlock("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:g},"加载更多"))])):e.createCommentVNode("",!0)])]))}}),re={class:"main wrap"},le={class:"main-left"},ie={key:0,class:"card card-content-loader"},me={class:"card card-question-head"},de={class:"question-content"},ue={class:"question-title"},_e={class:"card card-answer"},pe={class:"answer-content"},he=["innerHTML"],ve={key:2,class:"card card-answer"},fe={class:"main-right"},we=e.defineComponent({name:"FrontendArticle",asyncData(v){const{store:i,route:p,api:a}=v,{fullPath:m,params:{id:d}}=p,u=C(i),_=$(i),h=k(i);return Promise.all([u.getCategoryList({},a),_.getTrending(void 0,a),h.getCommentList({id:d,path:m,page:1,limit:10},a),_.getArticleItem({id:d,path:m},a)])},__name:"frontend-article",setup(v){const i=C(),p=E(i),a=e.toRef(p,"lists"),m=$(),d=E(m),u=e.toRef(d,"item"),_=e.toRef(d,"trending"),h=e.computed(()=>u.value.isLoad),o=e.computed(()=>u.value.data),f=k(),l=E(f),N=e.toRef(l,"lists");q();function V(s){return s?s.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}e.onMounted(()=>{});const g=e.computed(()=>{var c;let s="M.M.F 小屋";return s=(c=o.value)!=null&&c.title?`${o.value.title} - M.M.F 小屋`:"M.M.F 小屋",s});return H({title:g,meta:[{name:"description",content:g}]}),(s,c)=>{const n=e.resolveComponent("router-link"),r=L,t=ce,w=T,b=R,B=M;return e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("div",le,[h.value?o.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",me,[e.createElementVNode("div",de,[e.createVNode(n,{to:`/category/${o.value.category}`,class:"topic-link-item"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.category_name),1)]),_:1},8,["to"]),e.createElementVNode("h2",ue,[e.createVNode(n,{to:`/article/${o.value._id}`,class:"question-title-link"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value.title),1)]),_:1},8,["to"])])])]),e.createElementVNode("div",_e,[e.createElementVNode("div",pe,[e.createElementVNode("div",{class:"markdown-body vuepress-markdown-body github-markdown-body article-content",innerHTML:V(o.value.html)},null,8,he)]),e.createVNode(r,{item:o.value},null,8,["item"])]),e.createVNode(t,{comments:N.value},null,8,["comments"])],64)):(e.openBlock(),e.createElementBlock("div",ve,c[1]||(c[1]=[e.createElementVNode("div",{class:"answer-content"},"该文章不存在, 或者该文章已经被删除",-1)]))):(e.openBlock(),e.createElementBlock("div",ie,[e.createVNode(e.unref(S),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:e.withCtx(()=>c[0]||(c[0]=[e.createElementVNode("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"},null,-1),e.createTextVNode(),e.createElementVNode("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"},null,-1),e.createElementVNode("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"},null,-1),e.createTextVNode(),e.createElementVNode("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"},null,-1),e.createElementVNode("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"},null,-1),e.createTextVNode(),e.createElementVNode("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"},null,-1),e.createElementVNode("circle",{cx:"30",cy:"30",r:"30"},null,-1)])),_:1})]))]),e.createElementVNode("div",fe,[e.createVNode(w,{category:a.value},null,8,["category"]),e.createVNode(b,{trending:_.value},null,8,["trending"]),e.createVNode(B)])])}}});export{we as default};
