import{C as I,_ as z,a as G,b as U}from"./vue-content-loader.es-UiczhdIO.js";import{u as q,_ as J}from"./use-frontend-article-store-VM_8Qz1e.js";import{d as V,g as D,t as f,z as K,l as O,u as Q,A as W,n as k,B as X,C as A,D as Y,o as a,c,b as t,p as u,E as N,G as Z,H as tt,F as B,q as et,x as st,j as C,s as T,k as ot,I as nt,h as at,e as d,w as F,i as w}from"./main-CTY4IKlK.js";import{u as j}from"./use-global-comment-store-C6vMCYgp.js";import{u as R}from"./use-global-category-store-CvhW7WrR.js";import{u as ct}from"./vue.8fc199ce-Bmv443Wm.js";const rt={class:"card"},it={class:"comments"},lt={class:"comment-post-wrap"},mt=["src"],dt={class:"comment-post-input-wrap base-textarea-wrap"},ut={class:"comment-post-actions"},_t={class:"comment-items-wrap"},pt={href:"javascript:;",class:"comment-author-avatar-link"},ht=["src"],vt={class:"comment-content-wrap"},gt={class:"comment-author-wrap"},ft={href:"javascript:;",class:"comment-author"},yt={class:"comment-content"},$t={class:"comment-footer"},wt={class:"comment-time"},kt=["onClick"],Ct={key:0,class:"load-more-wrap"},bt={key:1,href:"javascript:;",class:"comments-load-more"},xt=V({name:"FrontendComment",__name:"frontend-comment",props:{comments:{}},setup(b){const y=D(b),n=f(y,"comments"),_=K(),p=D(_),h=f(p,"cookies"),v=j(),[$,s]=O(!1),x=Q(),m=W({id:x.params.id,content:""}),L=k(()=>h.value.user),M=k(()=>h.value.useremail);async function S(){s(!0),await v.getCommentList({id:x.params.id,page:n.value.page+1,limit:10}),s(!1)}const r=X(async()=>{if(!L.value)A("请先登录!"),_.setLoginModal(!0);else if(m.content==="")A("请输入评论内容!");else{const{code:o,data:l}=await Y.post("frontend/comment/insert",m);o===200&&(m.content="",A({type:"success",content:"评论发布成功!"}),v.insertCommentItem(l))}});function i(o){var e;m.content=`回复 @${(e=o.userid)==null?void 0:e.username}: `,document.querySelector("#content").focus()}return(o,l)=>(a(),c("div",rt,[t("div",it,[t("div",lt,[t("img",{src:("useAvatar"in o?o.useAvatar:u(N))(M.value),alt:"",class:"avatar-img"},null,8,mt),t("div",dt,[Z(t("textarea",{id:"content","onUpdate:modelValue":l[0]||(l[0]=e=>u(m).content=e),class:"base-input textarea-input",cols:"30",rows:"4"},null,512),[[tt,u(m).content]])]),t("div",ut,[t("a",{href:"javascript:;",class:"btn btn-blue",onClick:l[1]||(l[1]=(...e)=>u(r)&&u(r)(...e))},"发表评论")])]),t("div",_t,[(a(!0),c(B,null,et(n.value.data,e=>(a(),c("div",{key:e._id,class:"comment-item"},[t("a",pt,[t("img",{src:("useAvatar"in o?o.useAvatar:u(N))(e.userid.email),alt:"",class:"avatar-img"},null,8,ht)]),t("div",vt,[t("span",gt,[t("a",ft,C(e.userid.username),1)]),t("div",yt,C(e.content),1),t("div",$t,[t("span",wt,C(e.creat_date),1),t("a",{href:"javascript:;",class:"comment-action-item comment-reply",onClick:P=>i(e)},"回复",8,kt)])])]))),128))]),n.value.hasNext?(a(),c("div",Ct,[u($)?(a(),c("a",bt,"加载中...")):(a(),c("a",{key:0,href:"javascript:;",class:"comments-load-more",onClick:S},"加载更多"))])):st("",!0)])]))}}),St={class:"main wrap"},Lt={class:"main-left"},Mt={key:0,class:"card card-content-loader"},At={class:"card card-question-head"},Tt={class:"question-content"},Ft={class:"question-title"},jt={class:"card card-answer"},Pt={class:"answer-content"},qt=["innerHTML"],Dt={key:2,class:"card card-answer"},Nt={class:"main-right"},zt=V({name:"FrontendArticle",asyncData(b){const{store:g,route:y,api:n}=b,{fullPath:_,params:{id:p}}=y,h=R(g),v=q(g),$=j(g);return Promise.all([h.getCategoryList({},n),v.getTrending(void 0,n),$.getCommentList({id:p,path:_,page:1,limit:10},n),v.getArticleItem({id:p,path:_},n)])},__name:"frontend-article",setup(b){const g=R(),y=T(g),n=f(y,"lists"),_=q(),p=T(_),h=f(p,"item"),v=f(p,"trending"),$=k(()=>h.value.isLoad),s=k(()=>h.value.data),x=j(),m=T(x),L=f(m,"lists");ot();function M(r){return r?r.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}nt(()=>{});const S=k(()=>{var i;let r="M.M.F 小屋";return r=(i=s.value)!=null&&i.title?`${s.value.title} - M.M.F 小屋`:"M.M.F 小屋",r});return ct({title:S,meta:[{name:"description",content:S}]}),(r,i)=>{const o=at("router-link"),l=z,e=xt,P=G,H=J,E=U;return a(),c("div",St,[t("div",Lt,[$.value?s.value?(a(),c(B,{key:1},[t("div",At,[t("div",Tt,[d(o,{to:`/category/${s.value.category}`,class:"topic-link-item"},{default:F(()=>[w(C(s.value.category_name),1)]),_:1},8,["to"]),t("h2",Ft,[d(o,{to:`/article/${s.value._id}`,class:"question-title-link"},{default:F(()=>[w(C(s.value.title),1)]),_:1},8,["to"])])])]),t("div",jt,[t("div",Pt,[t("div",{class:"markdown-body vuepress-markdown-body github-markdown-body article-content",innerHTML:M(s.value.html)},null,8,qt)]),d(l,{item:s.value},null,8,["item"])]),d(e,{comments:L.value},null,8,["comments"])],64)):(a(),c("div",Dt,i[1]||(i[1]=[t("div",{class:"answer-content"},"该文章不存在, 或者该文章已经被删除",-1)]))):(a(),c("div",Mt,[d(u(I),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:F(()=>i[0]||(i[0]=[t("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"},null,-1),w(),t("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"},null,-1),t("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"},null,-1),w(),t("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"},null,-1),t("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"},null,-1),w(),t("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"},null,-1),t("circle",{cx:"30",cy:"30",r:"30"},null,-1)])),_:1})]))]),t("div",Nt,[d(P,{category:n.value},null,8,["category"]),d(H,{trending:v.value},null,8,["trending"]),d(E)])])}}});export{zt as default};
