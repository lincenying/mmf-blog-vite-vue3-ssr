import{e as P,c as q,_ as E}from"../entry-server.js";import{_ as H}from"./a-input-a46fa5e4.js";import{defineComponent as z,toRef as S,reactive as J,watch as A,onMounted as K,ref as O,resolveComponent as R,mergeProps as Q,withCtx as _,unref as n,withDirectives as U,createVNode as c,vModelText as W,openBlock as h,createBlock as M,Fragment as X,renderList as Y,toDisplayString as Z,vModelSelect as ee,createTextVNode as te,useSSRContext as oe}from"vue";import{ssrRenderAttrs as ae,ssrRenderComponent as u,ssrRenderAttr as B,ssrIncludeBooleanAttr as ne,ssrLooseContain as re,ssrLooseEqual as ie,ssrRenderList as se,ssrInterpolate as le}from"vue/server-renderer";import{u as D}from"./upload-api-acac9f68.js";import{u as L}from"./use-global-category-store-9a41de21.js";import{useRoute as ce,useRouter as de}from"vue-router";import{storeToRefs as T}from"pinia";import{u as me}from"./use-backend-article-store-0d766600.js";import{useToggle as pe}from"@vueuse/core";import{useHead as ue}from"@unhead/vue";import"node:path";import"@vue/server-renderer";import"@unhead/ssr";import"js-cookie";import"@lincy/utils";import"axios";import"qs";import"element-plus";import"md5";import"lru-cache";const F=z({name:"BackendArticleModify",asyncData(f){const{store:d,route:l,api:y}=f;return L(d).getCategoryList({limit:99,path:l.fullPath},y)},__name:"backend-article-modify",__ssrInlineRender:!0,setup(f){const{ctx:d}=P(),l=ce();de();const y=L(),w=T(y),v=S(w,"lists"),x=me(),I=T(x),G=S(I,"item");pe(!1);const e=J({id:l.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});A(()=>e.category,i=>{const o=v.value.find(s=>s._id===i);o&&(e.category_name=o.cate_name)}),A(()=>G.value,i=>{i.data&&(e.title=i.data.title,e.category_old=i.data.category,e.category=i.data.category,e.content=i.data.content)},{deep:!0}),K(async()=>{x.getArticleItem({id:l.params.id})});async function C(i,o,s){const $=d.$loading.show(),m=new FormData;m.append("file",s[0]);const{data:p}=await q.file(`${D}/ajax.php?action=upload`,m);p&&p.filepath&&o({url:`${D}/${p.filepath}`,desc:""}),$.hide()}const V=O("编辑文章 - M.M.F 小屋");return ue({title:V,meta:[{name:"description",content:V}]}),(i,o,s,$)=>{const m=H,p=E,k=R("v-md-editor"),N=R("router-link");o(`<div${ae(Q({class:"settings-main card"},$))}><div class="settings-main-content">`),o(u(m,{title:"标题"},{default:_((b,a,g,r)=>{if(a)a(`<input${B("value",n(e).title)} type="text" placeholder="标题" class="base-input" name="title"${r}><span class="input-info error"${r}>请输入标题</span>`);else return[U(c("input",{"onUpdate:modelValue":t=>n(e).title=t,type:"text",placeholder:"标题",class:"base-input",name:"title"},null,8,["onUpdate:modelValue"]),[[W,n(e).title]]),c("span",{class:"input-info error"},"请输入标题")]}),_:1},s)),o(u(m,{title:"分类",classes:"select-item-wrap"},{default:_((b,a,g,r)=>{if(a)a(`<i class="icon icon-arrow-down"${r}></i><select class="select-item" name="category"${r}><option value=""${ne(Array.isArray(n(e).category)?re(n(e).category,""):ie(n(e).category,""))?" selected":""}${r}>请选择分类</option><!--[-->`),se(v.value,t=>{a(`<option${B("value",t._id)}${r}>${le(t.cate_name)}</option>`)}),a(`<!--]--></select><span class="input-info error"${r}>请输入分类</span>`);else return[c("i",{class:"icon icon-arrow-down"}),U(c("select",{"onUpdate:modelValue":t=>n(e).category=t,class:"select-item",name:"category"},[c("option",{value:""},"请选择分类"),(h(!0),M(X,null,Y(v.value,t=>(h(),M("option",{key:t._id,value:t._id},Z(t.cate_name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[ee,n(e).category]]),c("span",{class:"input-info error"},"请输入分类")]}),_:1},s)),o('<div class="settings-section"><div id="modify-content" class="settings-item-content">'),o(u(p,null,{default:_((b,a,g,r)=>{if(a)a(u(k,{modelValue:n(e).content,"onUpdate:modelValue":t=>n(e).content=t,"disabled-menus":[],mode:"edit",height:"500px",onUploadImage:C},null,g,r));else return[c(k,{modelValue:n(e).content,"onUpdate:modelValue":t=>n(e).content=t,"disabled-menus":[],mode:"edit",height:"500px",onUploadImage:C},null,8,["modelValue","onUpdate:modelValue"])]}),_:1},s)),o('</div></div></div><div class="settings-footer"><a href="javascript:;" class="btn btn-yellow">编辑文章</a>'),o(u(N,{to:"/backend/article/list",class:"btn btn-blue"},{default:_((b,a,g,r)=>{if(a)a("返回");else return[te("返回")]}),_:1},s)),o("</div></div>")}}}),j=F.setup;F.setup=(f,d)=>{const l=oe();return(l.modules||(l.modules=new Set)).add("src/pages/backend-article-modify.vue"),j?j(f,d):void 0};export{F as default};
