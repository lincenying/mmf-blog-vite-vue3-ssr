import{e as J,_ as K,c as O}from"../entry-server.js";import{_ as Q}from"./a-input-BeZLXpwF.js";import{defineComponent as W,toRef as R,ref as U,reactive as X,watch as L,onMounted as Y,resolveComponent as M,mergeProps as Z,withCtx as y,unref as t,withDirectives as D,createVNode as c,vModelText as ee,createBlock as T,openBlock as B,Fragment as te,renderList as oe,toDisplayString as ae,vModelSelect as re,createTextVNode as ie,useSSRContext as ne}from"vue";import{ssrRenderAttrs as le,ssrRenderComponent as u,ssrRenderAttr as P,ssrIncludeBooleanAttr as k,ssrLooseContain as x,ssrLooseEqual as q,ssrRenderList as se,ssrInterpolate as ce}from"vue/server-renderer";import{u as F}from"./upload-api-CDhSk3CP.js";import{u as H}from"./use-global-category-store-BpFdaCEC.js";import{useRoute as me,useRouter as de}from"vue-router";import{storeToRefs as I}from"pinia";import{u as pe}from"./use-backend-article-store-BMOF_Kc5.js";import{useToggle as ue}from"@vueuse/core";import{useHead as fe}from"@unhead/vue";import"node:path";import"@unhead/vue/server";import"@vue/server-renderer";import"element-plus";import"@lincy/utils";import"md5";import"axios";import"qs";import"js-cookie";import"lru-cache";import"node:process";import"@kangc/v-md-editor";import"@kangc/v-md-editor/lib/plugins/line-number/index.js";import"@kangc/v-md-editor/lib/theme/vuepress.js";import"prismjs";import"prismjs/components/prism-json.js";import"prismjs/components/prism-javascript.js";import"prismjs/components/prism-typescript.js";import"prismjs/components/prism-markup-templating.js";import"prismjs/components/prism-php.js";import"prismjs/components/prism-twig.js";import"prismjs/components/prism-css.js";import"prismjs/components/prism-sass.js";import"prismjs/components/prism-less.js";import"prismjs/components/prism-bash.js";const N=W({name:"BackendArticleModify",asyncData(f){const{store:m,route:s,api:_}=f;return H(m).getCategoryList({limit:99,path:s.fullPath},_)},__name:"backend-article-modify",__ssrInlineRender:!0,setup(f){const{ctx:m}=J(),s=me();de();const _=H(),w=I(_),b=R(w,"lists"),A=pe(),E=I(A),G=R(E,"item"),[ge,ye]=ue(!1),v=U(!0),e=X({id:s.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});L(()=>e.category,n=>{const a=b.value.find(l=>l._id===n);a&&(e.category_name=a.cate_name)}),L(()=>G.value,n=>{n.data&&(e.title=n.data.title,e.category_old=n.data.category,e.category=n.data.category,e.content=n.data.content)},{deep:!0}),Y(async()=>{A.getArticleItem({id:s.params.id})});async function V(n,a,l){const $=m.$loading.show(),d=new FormData;d.append("file",l[0]);const{data:p}=await O.file(`${F}/api/fetch/upload`,d);p&&p.filepath&&a({url:`${F}/${p.filepath}`,desc:""}),$.hide()}const C=U("编辑文章 - M.M.F 小屋");return fe({title:C,meta:[{name:"description",content:C}]}),(n,a,l,$)=>{const d=Q,p=K,S=M("v-md-editor"),z=M("router-link");a(`<div${le(Z({class:"settings-main card"},$))}><div class="settings-main-content">`),a(u(d,{title:"标题"},{default:y((h,r,g,i)=>{if(r)r(`<input${P("value",t(e).title)} type="text" placeholder="标题" class="base-input" name="title"${i}><span class="input-info error"${i}>请输入标题</span>`);else return[D(c("input",{"onUpdate:modelValue":o=>t(e).title=o,type:"text",placeholder:"标题",class:"base-input",name:"title"},null,8,["onUpdate:modelValue"]),[[ee,t(e).title]]),c("span",{class:"input-info error"},"请输入标题")]}),_:1},l)),a(u(d,{title:"分类",classes:"select-item-wrap"},{default:y((h,r,g,i)=>{if(r)r(`<i class="icon icon-arrow-down"${i}></i><select class="select-item" name="category"${i}><option value=""${k(Array.isArray(t(e).category)?x(t(e).category,""):q(t(e).category,""))?" selected":""}${i}>请选择分类</option><!--[-->`),se(b.value,o=>{r(`<option${P("value",o._id)}${k(Array.isArray(t(e).category)?x(t(e).category,o._id):q(t(e).category,o._id))?" selected":""}${i}>${ce(o.cate_name)}</option>`)}),r(`<!--]--></select><span class="input-info error"${i}>请输入分类</span>`);else return[c("i",{class:"icon icon-arrow-down"}),D(c("select",{"onUpdate:modelValue":o=>t(e).category=o,class:"select-item",name:"category"},[c("option",{value:""},"请选择分类"),(B(!0),T(te,null,oe(b.value,o=>(B(),T("option",{key:o._id,value:o._id},ae(o.cate_name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[re,t(e).category]]),c("span",{class:"input-info error"},"请输入分类")]}),_:1},l)),a('<div class="settings-section"><div id="modify-content" class="settings-item-content">'),a(u(p,null,{default:y((h,r,g,i)=>{if(r)r(u(S,{modelValue:t(e).content,"onUpdate:modelValue":o=>t(e).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:V},null,g,i));else return[c(S,{modelValue:t(e).content,"onUpdate:modelValue":o=>t(e).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:V},null,8,["modelValue","onUpdate:modelValue"])]}),_:1},l)),a(`</div></div></div><div class="settings-footer"><label mr-10px inline-flex items-center><input${k(Array.isArray(t(v))?x(t(v),"1"):t(v))?" checked":""} type="checkbox" value="1"><span ml-5px>使用前端生成Html?</span></label><a href="javascript:;" class="btn btn-yellow">编辑文章</a>`),a(u(z,{to:"/backend/article/list",class:"btn btn-blue"},{default:y((h,r,g,i)=>{if(r)r("返回");else return[ie("返回")]}),_:1},l)),a("</div></div>")}}}),j=N.setup;N.setup=(f,m)=>{const s=ne();return(s.modules||(s.modules=new Set)).add("src/pages/backend-article-modify.vue"),j?j(f,m):void 0};export{N as default};
