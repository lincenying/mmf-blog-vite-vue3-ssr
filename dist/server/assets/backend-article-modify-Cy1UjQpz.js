import{e as J,_ as K,c as O}from"../entry-server.js";import{_ as Q}from"./a-input-BeZLXpwF.js";import{defineComponent as W,toRef as R,ref as U,reactive as X,watch as L,onMounted as Y,resolveComponent as M,mergeProps as Z,withCtx as y,unref as e,withDirectives as D,createVNode as c,vModelText as tt,createBlock as T,openBlock as B,Fragment as et,renderList as ot,toDisplayString as rt,vModelSelect as it,createTextVNode as at,useSSRContext as nt}from"vue";import{ssrRenderAttrs as lt,ssrRenderComponent as u,ssrRenderAttr as P,ssrIncludeBooleanAttr as k,ssrLooseContain as x,ssrLooseEqual as q,ssrRenderList as st,ssrInterpolate as ct}from"vue/server-renderer";import{u as F}from"./upload-api-D6N3NHls.js";import{u as H}from"./use-global-category-store-BpFdaCEC.js";import{useRoute as mt,useRouter as dt}from"vue-router";import{storeToRefs as I}from"pinia";import{u as pt}from"./use-backend-article-store-D5khvARS.js";import{useToggle as ut}from"@vueuse/core";import{useHead as ft}from"@unhead/vue";import"node:path";import"@unhead/vue/server";import"@vue/server-renderer";import"./vendor-Dh2hNSeG.js";import"@vue/shared";import"@popperjs/core";import"lodash-unified";import"dayjs";import"dayjs/plugin/localeData.js";import"dayjs/plugin/customParseFormat.js";import"dayjs/plugin/advancedFormat.js";import"dayjs/plugin/weekOfYear.js";import"dayjs/plugin/weekYear.js";import"dayjs/plugin/dayOfYear.js";import"dayjs/plugin/isSameOrAfter.js";import"dayjs/plugin/isSameOrBefore.js";import"normalize-wheel-es";import"@element-plus/icons-vue";import"@ctrl/tinycolor";import"@lincy/utils";import"md5";import"axios";import"qs";import"js-cookie";import"lru-cache";import"node:process";import"@kangc/v-md-editor";import"@kangc/v-md-editor/lib/plugins/line-number/index.js";import"@kangc/v-md-editor/lib/theme/vuepress.js";import"prismjs";import"prismjs/components/prism-json.js";import"prismjs/components/prism-javascript.js";import"prismjs/components/prism-typescript.js";import"prismjs/components/prism-markup-templating.js";import"prismjs/components/prism-php.js";import"prismjs/components/prism-twig.js";import"prismjs/components/prism-css.js";import"prismjs/components/prism-sass.js";import"prismjs/components/prism-less.js";import"prismjs/components/prism-bash.js";const N=W({name:"BackendArticleModify",asyncData(f){const{store:m,route:s,api:_}=f;return H(m).getCategoryList({limit:99,path:s.fullPath},_)},__name:"backend-article-modify",__ssrInlineRender:!0,setup(f){const{ctx:m}=J(),s=mt();dt();const _=H(),w=I(_),b=R(w,"lists"),A=pt(),E=I(A),G=R(E,"item"),[gt,yt]=ut(!1),v=U(!0),t=X({id:s.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});L(()=>t.category,n=>{const r=b.value.find(l=>l._id===n);r&&(t.category_name=r.cate_name)}),L(()=>G.value,n=>{n.data&&(t.title=n.data.title,t.category_old=n.data.category,t.category=n.data.category,t.content=n.data.content)},{deep:!0,immediate:!0}),Y(async()=>{A.getArticleItem({id:s.params.id})});async function V(n,r,l){const $=m.$loading.show(),d=new FormData;d.append("file",l[0]);const{data:p}=await O.file(`${F}/api/fetch/upload`,d);p&&p.filepath&&r({url:`${F}/${p.filepath}`,desc:""}),$.hide()}const C=U("编辑文章 - M.M.F 小屋");return ft({title:C,meta:[{name:"description",content:C}]}),(n,r,l,$)=>{const d=Q,p=K,S=M("v-md-editor"),z=M("router-link");r(`<div${lt(Z({class:"settings-main card"},$))}><div class="settings-main-content">`),r(u(d,{title:"标题"},{default:y((h,i,g,a)=>{if(i)i(`<input${P("value",e(t).title)} type="text" placeholder="标题" class="base-input" name="title"${a}><span class="input-info error"${a}>请输入标题</span>`);else return[D(c("input",{"onUpdate:modelValue":o=>e(t).title=o,type:"text",placeholder:"标题",class:"base-input",name:"title"},null,8,["onUpdate:modelValue"]),[[tt,e(t).title]]),c("span",{class:"input-info error"},"请输入标题")]}),_:1},l)),r(u(d,{title:"分类",classes:"select-item-wrap"},{default:y((h,i,g,a)=>{if(i)i(`<i class="icon icon-arrow-down"${a}></i><select class="select-item" name="category"${a}><option value=""${k(Array.isArray(e(t).category)?x(e(t).category,""):q(e(t).category,""))?" selected":""}${a}>请选择分类</option><!--[-->`),st(b.value,o=>{i(`<option${P("value",o._id)}${k(Array.isArray(e(t).category)?x(e(t).category,o._id):q(e(t).category,o._id))?" selected":""}${a}>${ct(o.cate_name)}</option>`)}),i(`<!--]--></select><span class="input-info error"${a}>请输入分类</span>`);else return[c("i",{class:"icon icon-arrow-down"}),D(c("select",{"onUpdate:modelValue":o=>e(t).category=o,class:"select-item",name:"category"},[c("option",{value:""},"请选择分类"),(B(!0),T(et,null,ot(b.value,o=>(B(),T("option",{key:o._id,value:o._id},rt(o.cate_name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[it,e(t).category]]),c("span",{class:"input-info error"},"请输入分类")]}),_:1},l)),r('<div class="settings-section"><div id="modify-content" class="settings-item-content">'),r(u(p,null,{default:y((h,i,g,a)=>{if(i)i(u(S,{modelValue:e(t).content,"onUpdate:modelValue":o=>e(t).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:V},null,g,a));else return[c(S,{modelValue:e(t).content,"onUpdate:modelValue":o=>e(t).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:V},null,8,["modelValue","onUpdate:modelValue"])]}),_:1},l)),r(`</div></div></div><div class="settings-footer"><label mr-10px inline-flex items-center><input${k(Array.isArray(e(v))?x(e(v),"1"):e(v))?" checked":""} type="checkbox" value="1"><span ml-5px>使用前端生成Html?</span></label><a href="javascript:;" class="btn btn-yellow">编辑文章</a>`),r(u(z,{to:"/backend/article/list",class:"btn btn-blue"},{default:y((h,i,g,a)=>{if(i)i("返回");else return[at("返回")]}),_:1},l)),r("</div></div>")}}}),j=N.setup;N.setup=(f,m)=>{const s=nt();return(s.modules||(s.modules=new Set)).add("src/pages/backend-article-modify.vue"),j?j(f,m):void 0};export{N as default};
