import{e as P,c as H,_ as q}from"../entry-server.js";import{_ as z}from"./a-input-a46fa5e4.js";import{defineComponent as E,toRef as S,reactive as J,watch as R,onMounted as K,ref as O,resolveComponent as U,mergeProps as Q,withCtx as _,unref as r,withDirectives as h,createVNode as c,vModelText as W,openBlock as A,createBlock as M,Fragment as X,renderList as Y,toDisplayString as Z,vModelSelect as ee,createTextVNode as te,useSSRContext as oe}from"vue";import{ssrRenderAttrs as ae,ssrRenderComponent as u,ssrRenderAttr as D,ssrRenderList as ne,ssrInterpolate as ie}from"vue/server-renderer";import{u as T}from"./upload-api-acac9f68.js";import{u as B}from"./use-global-category-store-9a41de21.js";import{useRoute as re,useRouter as le}from"vue-router";import{storeToRefs as j}from"pinia";import{u as se}from"./use-backend-article-store-0d766600.js";import{useToggle as ce}from"@vueuse/core";import{useHead as de}from"@vueuse/head";import"node:path";import"@vue/server-renderer";import"js-cookie";import"@lincy/utils";import"axios";import"qs";import"element-plus";import"md5";import"lru-cache";const L=E({name:"BackendArticleModify",asyncData(f){const{store:d,route:s,api:y}=f;return B(d).getCategoryList({limit:99,path:s.fullPath},y)},__name:"backend-article-modify",__ssrInlineRender:!0,setup(f){const{ctx:d}=P(),s=re();le();const y=B(),w=j(y),v=S(w,"lists"),x=se(),G=j(x),I=S(G,"item");ce(!1);const e=J({id:s.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});R(()=>e.category,i=>{const o=v.value.find(l=>l._id===i);o&&(e.category_name=o.cate_name)}),R(()=>I.value,i=>{i.data&&(e.title=i.data.title,e.category_old=i.data.category,e.category=i.data.category,e.content=i.data.content)},{deep:!0}),K(async()=>{x.getArticleItem({id:s.params.id})});async function V(i,o,l){const b=d.$loading.show(),m=new FormData;m.append("file",l[0]);const{data:p}=await H.file(`${T}/ajax.php?action=upload`,m);p&&p.filepath&&o({url:`${T}/${p.filepath}`,desc:""}),b.hide()}const k=O("编辑文章 - M.M.F 小屋");return de({title:k,meta:[{name:"description",content:k}]}),(i,o,l,b)=>{const m=z,p=q,C=U("v-md-editor"),N=U("router-link");o(`<div${ae(Q({class:"settings-main card"},b))}><div class="settings-main-content">`),o(u(m,{title:"标题"},{default:_(($,a,g,n)=>{if(a)a(`<input${D("value",r(e).title)} type="text" placeholder="标题" class="base-input" name="title"${n}><span class="input-info error"${n}>请输入标题</span>`);else return[h(c("input",{"onUpdate:modelValue":t=>r(e).title=t,type:"text",placeholder:"标题",class:"base-input",name:"title"},null,8,["onUpdate:modelValue"]),[[W,r(e).title]]),c("span",{class:"input-info error"},"请输入标题")]}),_:1},l)),o(u(m,{title:"分类",classes:"select-item-wrap"},{default:_(($,a,g,n)=>{if(a)a(`<i class="icon icon-arrow-down"${n}></i><select class="select-item" name="category"${n}><option value=""${n}>请选择分类</option><!--[-->`),ne(v.value,t=>{a(`<option${D("value",t._id)}${n}>${ie(t.cate_name)}</option>`)}),a(`<!--]--></select><span class="input-info error"${n}>请输入分类</span>`);else return[c("i",{class:"icon icon-arrow-down"}),h(c("select",{"onUpdate:modelValue":t=>r(e).category=t,class:"select-item",name:"category"},[c("option",{value:""},"请选择分类"),(A(!0),M(X,null,Y(v.value,t=>(A(),M("option",{key:t._id,value:t._id},Z(t.cate_name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[ee,r(e).category]]),c("span",{class:"input-info error"},"请输入分类")]}),_:1},l)),o('<div class="settings-section"><div id="modify-content" class="settings-item-content">'),o(u(p,null,{default:_(($,a,g,n)=>{if(a)a(u(C,{modelValue:r(e).content,"onUpdate:modelValue":t=>r(e).content=t,"disabled-menus":[],mode:"edit",height:"500px",onUploadImage:V},null,g,n));else return[c(C,{modelValue:r(e).content,"onUpdate:modelValue":t=>r(e).content=t,"disabled-menus":[],mode:"edit",height:"500px",onUploadImage:V},null,8,["modelValue","onUpdate:modelValue"])]}),_:1},l)),o('</div></div></div><div class="settings-footer"><a href="javascript:;" class="btn btn-yellow">编辑文章</a>'),o(u(N,{to:"/backend/article/list",class:"btn btn-blue"},{default:_(($,a,g,n)=>{if(a)a("返回");else return[te("返回")]}),_:1},l)),o("</div></div>")}}}),F=L.setup;L.setup=(f,d)=>{const s=oe();return(s.modules||(s.modules=new Set)).add("src/pages/backend-article-modify.vue"),F?F(f,d):void 0};export{L as default};
