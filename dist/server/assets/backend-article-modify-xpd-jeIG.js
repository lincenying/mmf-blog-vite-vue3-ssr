import{e as z,c as J,_ as K}from"../entry-server.js";import{_ as O}from"./a-input-wxmridTV.js";import{defineComponent as Q,toRef as V,ref as S,reactive as W,watch as R,onMounted as X,resolveComponent as U,mergeProps as Y,withCtx as y,unref as t,withDirectives as M,createVNode as c,vModelText as Z,openBlock as B,createBlock as D,Fragment as ee,renderList as te,toDisplayString as oe,vModelSelect as ae,createTextVNode as ne,useSSRContext as re}from"vue";import{ssrRenderAttrs as ie,ssrRenderComponent as u,ssrRenderAttr as L,ssrIncludeBooleanAttr as T,ssrLooseContain as j,ssrLooseEqual as le,ssrRenderList as se,ssrInterpolate as ce}from"vue/server-renderer";import"@kangc/v-md-editor";import{u as q}from"./upload-api-uVvbjo2i.js";import{u as F}from"./use-global-category-store-U2BygGah.js";import{useRoute as de,useRouter as me}from"vue-router";import{storeToRefs as H}from"pinia";import{u as pe}from"./use-backend-article-store-RQUQeDWj.js";import{useToggle as ue}from"@vueuse/core";import{useHead as fe}from"@unhead/vue";import"node:path";import"@vue/server-renderer";import"@unhead/ssr";import"js-cookie";import"@lincy/utils";import"axios";import"qs";import"element-plus";import"md5";import"lru-cache";const G=Q({name:"BackendArticleModify",asyncData(f){const{store:d,route:s,api:_}=f;return F(d).getCategoryList({limit:99,path:s.fullPath},_)},__name:"backend-article-modify",__ssrInlineRender:!0,setup(f){const{ctx:d}=z(),s=de();me();const _=F(),k=H(_),b=V(k,"lists"),x=pe(),N=H(x),P=V(N,"item");ue(!1);const v=S(!0),e=W({id:s.params.id,title:"",category:"",category_name:"",category_old:"",content:"",html:""});R(()=>e.category,i=>{const a=b.value.find(l=>l._id===i);a&&(e.category_name=a.cate_name)}),R(()=>P.value,i=>{i.data&&(e.title=i.data.title,e.category_old=i.data.category,e.category=i.data.category,e.content=i.data.content)},{deep:!0}),X(async()=>{x.getArticleItem({id:s.params.id})});async function w(i,a,l){const $=d.$loading.show(),m=new FormData;m.append("file",l[0]);const{data:p}=await J.file(`${q}/ajax.php?action=upload`,m);p&&p.filepath&&a({url:`${q}/${p.filepath}`,desc:""}),$.hide()}const A=S("编辑文章 - M.M.F 小屋");return fe({title:A,meta:[{name:"description",content:A}]}),(i,a,l,$)=>{const m=O,p=K,C=U("v-md-editor"),E=U("router-link");a(`<div${ie(Y({class:"settings-main card"},$))}><div class="settings-main-content">`),a(u(m,{title:"标题"},{default:y((h,n,g,r)=>{if(n)n(`<input${L("value",t(e).title)} type="text" placeholder="标题" class="base-input" name="title"${r}><span class="input-info error"${r}>请输入标题</span>`);else return[M(c("input",{"onUpdate:modelValue":o=>t(e).title=o,type:"text",placeholder:"标题",class:"base-input",name:"title"},null,8,["onUpdate:modelValue"]),[[Z,t(e).title]]),c("span",{class:"input-info error"},"请输入标题")]}),_:1},l)),a(u(m,{title:"分类",classes:"select-item-wrap"},{default:y((h,n,g,r)=>{if(n)n(`<i class="icon icon-arrow-down"${r}></i><select class="select-item" name="category"${r}><option value=""${T(Array.isArray(t(e).category)?j(t(e).category,""):le(t(e).category,""))?" selected":""}${r}>请选择分类</option><!--[-->`),se(b.value,o=>{n(`<option${L("value",o._id)}${r}>${ce(o.cate_name)}</option>`)}),n(`<!--]--></select><span class="input-info error"${r}>请输入分类</span>`);else return[c("i",{class:"icon icon-arrow-down"}),M(c("select",{"onUpdate:modelValue":o=>t(e).category=o,class:"select-item",name:"category"},[c("option",{value:""},"请选择分类"),(B(!0),D(ee,null,te(b.value,o=>(B(),D("option",{key:o._id,value:o._id},oe(o.cate_name),9,["value"]))),128))],8,["onUpdate:modelValue"]),[[ae,t(e).category]]),c("span",{class:"input-info error"},"请输入分类")]}),_:1},l)),a('<div class="settings-section"><div id="modify-content" class="settings-item-content">'),a(u(p,null,{default:y((h,n,g,r)=>{if(n)n(u(C,{modelValue:t(e).content,"onUpdate:modelValue":o=>t(e).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:w},null,g,r));else return[c(C,{modelValue:t(e).content,"onUpdate:modelValue":o=>t(e).content=o,"disabled-menus":[],mode:"edit",height:"500px","left-toolbar":"undo redo clear | h bold italic strikethrough link | ul ol table hr | image quote code tip | save",onUploadImage:w},null,8,["modelValue","onUpdate:modelValue"])]}),_:1},l)),a(`</div></div></div><div class="settings-footer"><label mr-10px inline-flex items-center><input${T(Array.isArray(t(v))?j(t(v),"1"):t(v))?" checked":""} type="checkbox" value="1"><span ml-5px>使用前端生成Html?</span></label><a href="javascript:;" class="btn btn-yellow">编辑文章</a>`),a(u(E,{to:"/backend/article/list",class:"btn btn-blue"},{default:y((h,n,g,r)=>{if(n)n("返回");else return[ne("返回")]}),_:1},l)),a("</div></div>")}}}),I=G.setup;G.setup=(f,d)=>{const s=re();return(s.modules||(s.modules=new Set)).add("src/pages/backend-article-modify.vue"),I?I(f,d):void 0};export{G as default};
