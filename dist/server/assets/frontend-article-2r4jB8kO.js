import{_ as et,a as rt,b as at}from"./item-actions-CsI6clir.js";import{u as N,_ as ot}from"./use-frontend-article-store-rXgI5GZg.js";import{a as nt,b as st,s as R,c as it,d as G,u as ct}from"../entry-server.js";import{defineComponent as J,toRefs as V,toRef as x,reactive as lt,computed as C,mergeProps as K,unref as b,useSSRContext as O,onMounted as mt,resolveComponent as dt,withCtx as L,createVNode as p,createTextVNode as $,toDisplayString as E}from"vue";import{ssrRenderAttrs as Q,ssrRenderAttr as H,ssrInterpolate as w,ssrRenderList as vt,ssrRenderComponent as d}from"vue/server-renderer";import{u as F}from"./use-global-comment-store-Bq-dgjB1.js";import{useToggle as ut}from"@vueuse/core";import{useRoute as ft}from"vue-router";import{ContentLoader as pt}from"vue-content-loader";import{u as I}from"./use-global-category-store-BHvhQ2np.js";import{storeToRefs as M}from"pinia";import{useHead as gt}from"@unhead/vue";import"node:path";import"@vue/server-renderer";import"@unhead/ssr";import"js-cookie";import"@lincy/utils";import"axios";import"qs";import"element-plus";import"md5";import"lru-cache";import"node:process";const j=J({name:"FrontendComment",__name:"frontend-comment",__ssrInlineRender:!0,props:{comments:null},setup(l){const a=V(l),s=x(a,"comments"),v=nt(),u=V(v),f=x(u,"cookies"),g=F(),[_,r]=ut(!1),S=ft(),y=lt({id:S.params.id,content:""}),k=C(()=>f.value.user),A=C(()=>f.value.useremail);return st(async()=>{if(!k.value)R("请先登录!"),v.setLoginModal(!0);else if(y.content==="")R("请输入评论内容!");else{const{code:i,data:e}=await it.post("frontend/comment/insert",y);i===200&&(y.content="",R({type:"success",content:"评论发布成功!"}),g.insertCommentItem(e))}}),(i,e,t,n)=>{e(`<div${Q(K({class:"card"},n))}><div class="comments"><div class="comment-post-wrap"><img${H("src",("useAvatar"in i?i.useAvatar:b(G))(A.value))} alt="" class="avatar-img"><div class="comment-post-input-wrap base-textarea-wrap"><textarea id="content" class="base-input textarea-input" cols="30" rows="4">${w(b(y).content)}</textarea></div><div class="comment-post-actions"><a href="javascript:;" class="btn btn-blue">发表评论</a></div></div><div class="comment-items-wrap"><!--[-->`),vt(s.value.data,h=>{e(`<div class="comment-item"><a href="javascript:;" class="comment-author-avatar-link"><img${H("src",("useAvatar"in i?i.useAvatar:b(G))(h.userid.email))} alt="" class="avatar-img"></a><div class="comment-content-wrap"><span class="comment-author-wrap"><a href="javascript:;" class="comment-author">${w(h.userid.username)}</a></span><div class="comment-content">${w(h.content)}</div><div class="comment-footer"><span class="comment-time">${w(h.creat_date)}</span><a href="javascript:;" class="comment-action-item comment-reply">回复</a></div></div></div>`)}),e("<!--]--></div>"),s.value.hasNext?(e('<div class="load-more-wrap">'),b(_)?e('<a href="javascript:;" class="comments-load-more">加载中...</a>'):e('<a href="javascript:;" class="comments-load-more">加载更多</a>'),e("</div>")):e("<!---->"),e("</div></div>")}}}),z=j.setup;j.setup=(l,o)=>{const a=O();return(a.modules||(a.modules=new Set)).add("src/components/frontend-comment.vue"),z?z(l,o):void 0};const U=J({name:"FrontendArticle",asyncData(l){const{store:o,route:a,api:s}=l,{fullPath:v,params:{id:u}}=a,f=I(o),g=N(o),_=F(o);return Promise.all([f.getCategoryList({},s),g.getTrending(void 0,s),_.getCommentList({id:u,path:v,page:1,limit:10},s),g.getArticleItem({id:u,path:v},s)])},__name:"frontend-article",__ssrInlineRender:!0,setup(l){const o=I(),a=M(o),s=x(a,"lists"),v=N(),u=M(v),f=x(u,"item"),g=x(u,"trending"),_=C(()=>f.value.isLoad),r=C(()=>f.value.data),S=F(),y=M(S),k=x(y,"lists");ct();function A(e){return e?e.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}mt(()=>{});const i=C(()=>{var t;let e="M.M.F 小屋";return e=(t=r.value)!=null&&t.title?`${r.value.title} - M.M.F 小屋`:"M.M.F 小屋",e});return gt({title:i,meta:[{name:"description",content:i}]}),(e,t,n,h)=>{var q;const T=dt("router-link"),W=et,X=j,Y=rt,Z=ot,tt=at;t(`<div${Q(K({class:"main wrap"},h))}><div class="main-left">`),_.value?r.value?(t('<!--[--><div class="card card-question-head"><div class="question-content">'),t(d(T,{to:`/category/${r.value.category}`,class:"topic-link-item"},{default:L((P,m,D,c)=>{if(m)m(`${w(r.value.category_name)}`);else return[$(E(r.value.category_name),1)]}),_:1},n)),t('<h2 class="question-title">'),t(d(T,{to:`/article/${r.value._id}`,class:"question-title-link"},{default:L((P,m,D,c)=>{if(m)m(`${w(r.value.title)}`);else return[$(E(r.value.title),1)]}),_:1},n)),t(`</h2></div></div><div class="card card-answer"><div class="answer-content"><div class="markdown-body vuepress-markdown-body github-markdown-body article-content">${(q=A(r.value.html))!=null?q:""}</div></div>`),t(d(W,{item:r.value},null,n)),t("</div>"),t(d(X,{comments:k.value},null,n)),t("<!--]-->")):t('<div class="card card-answer"><div class="answer-content">该文章不存在, 或者该文章已经被删除</div></div>'):(t('<div class="card card-content-loader">'),t(d(b(pt),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:L((P,m,D,c)=>{if(m)m(`<rect x="70" y="15" rx="4" ry="4" width="117" height="6.4"${c}></rect> <rect x="70" y="35" rx="3" ry="3" width="85" height="6.4"${c}></rect><rect x="0" y="80" rx="3" ry="3" width="550" height="6.4"${c}></rect> <rect x="0" y="100" rx="3" ry="3" width="620" height="6.4"${c}></rect><rect x="0" y="120" rx="3" ry="3" width="401" height="6.4"${c}></rect> <rect x="0" y="140" rx="3" ry="3" width="501" height="6.4"${c}></rect><circle cx="30" cy="30" r="30"${c}></circle>`);else return[p("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"}),$(),p("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"}),p("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"}),$(),p("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"}),p("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"}),$(),p("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"}),p("circle",{cx:"30",cy:"30",r:"30"})]}),_:1},n)),t("</div>")),t('</div><div class="main-right">'),t(d(Y,{category:s.value},null,n)),t(d(Z,{trending:g.value},null,n)),t(d(tt,null,null,n)),t("</div></div>")}}}),B=U.setup;U.setup=(l,o)=>{const a=O();return(a.modules||(a.modules=new Set)).add("src/pages/frontend-article.vue"),B?B(l,o):void 0};export{U as default};
