import{_ as tt,a as et,b as rt}from"./item-actions-6544baf0.js";import{u as D,_ as at}from"./use-frontend-article-store-8531db95.js";import{a as ot,b as nt,s as k,c as st,d as N,u as it}from"../entry-server.js";import{defineComponent as B,toRefs as G,toRef as x,reactive as ct,computed as C,mergeProps as J,unref as b,useSSRContext as K,onMounted as lt,resolveComponent as mt,withCtx as L,createVNode as p,createTextVNode as w,toDisplayString as V}from"vue";import{ssrRenderAttrs as O,ssrRenderAttr as E,ssrInterpolate as _,ssrRenderList as dt,ssrRenderComponent as d}from"vue/server-renderer";import{u as F}from"./use-global-comment-store-53a738bf.js";import{useToggle as vt}from"@vueuse/core";import{useRoute as ut}from"vue-router";import{ContentLoader as ft}from"vue-content-loader";import{u as H}from"./use-global-category-store-9a41de21.js";import{storeToRefs as M}from"pinia";import{useHead as pt}from"@vueuse/head";import"node:path";import"@vue/server-renderer";import"js-cookie";import"@lincy/utils";import"axios";import"qs";import"element-plus";import"md5";import"lru-cache";const j=B({name:"FrontendComment",__name:"frontend-comment",__ssrInlineRender:!0,props:{comments:null},setup(l){const a=G(l),s=x(a,"comments"),v=ot(),u=G(v),f=x(u,"cookies"),g=F(),[$,r]=vt(!1),S=ut(),y=ct({id:S.params.id,content:""}),A=C(()=>f.value.user),R=C(()=>f.value.useremail);return nt(async()=>{if(!A.value)k("请先登录!"),v.setLoginModal(!0);else if(y.content==="")k("请输入评论内容!");else{const{code:i,data:e}=await st.post("frontend/comment/insert",y);i===200&&(y.content="",k({type:"success",content:"评论发布成功!"}),g.insertCommentItem(e))}}),(i,e,t,n)=>{e(`<div${O(J({class:"card"},n))}><div class="comments"><div class="comment-post-wrap"><img${E("src",("useAvatar"in i?i.useAvatar:b(N))(R.value))} alt="" class="avatar-img"><div class="comment-post-input-wrap base-textarea-wrap"><textarea id="content" class="base-input textarea-input" cols="30" rows="4">${_(b(y).content)}</textarea></div><div class="comment-post-actions"><a href="javascript:;" class="btn btn-blue">发表评论</a></div></div><div class="comment-items-wrap"><!--[-->`),dt(s.value.data,h=>{e(`<div class="comment-item"><a href="javascript:;" class="comment-author-avatar-link"><img${E("src",("useAvatar"in i?i.useAvatar:b(N))(h.userid.email))} alt="" class="avatar-img"></a><div class="comment-content-wrap"><span class="comment-author-wrap"><a href="javascript:;" class="comment-author">${_(h.userid.username)}</a></span><div class="comment-content">${_(h.content)}</div><div class="comment-footer"><span class="comment-time">${_(h.creat_date)}</span><a href="javascript:;" class="comment-action-item comment-reply">回复</a></div></div></div>`)}),e("<!--]--></div>"),s.value.hasNext?(e('<div class="load-more-wrap">'),b($)?e('<a href="javascript:;" class="comments-load-more">加载中...</a>'):e('<a href="javascript:;" class="comments-load-more">加载更多</a>'),e("</div>")):e("<!---->"),e("</div></div>")}}}),I=j.setup;j.setup=(l,o)=>{const a=K();return(a.modules||(a.modules=new Set)).add("src/components/frontend-comment.vue"),I?I(l,o):void 0};const Q=B({name:"FrontendArticle",asyncData(l){const{store:o,route:a,api:s}=l,{fullPath:v,params:{id:u}}=a,f=H(o),g=D(o),$=F(o);return Promise.all([f.getCategoryList({},s),g.getTrending({},s),$.getCommentList({id:u,path:v,page:1,limit:10},s),g.getArticleItem({id:u,path:v},s)])},__name:"frontend-article",__ssrInlineRender:!0,setup(l){const o=H(),a=M(o),s=x(a,"lists"),v=D(),u=M(v),f=x(u,"item"),g=x(u,"trending"),$=C(()=>f.value.isLoad),r=C(()=>f.value.data),S=F(),y=M(S),A=x(y,"lists");it();function R(e){return e?e.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}lt(()=>{});const i=C(()=>{var t;let e="M.M.F 小屋";return e=(t=r.value)!=null&&t.title?`${r.value.title} - M.M.F 小屋`:"M.M.F 小屋",e});return pt({title:i,meta:[{name:"description",content:i}]}),(e,t,n,h)=>{const T=mt("router-link"),U=tt,W=j,X=et,Y=at,Z=rt;t(`<div${O(J({class:"main wrap"},h))}><div class="main-left">`),$.value?r.value?(t('<!--[--><div class="card card-question-head"><div class="question-content">'),t(d(T,{to:`/category/${r.value.category}`,class:"topic-link-item"},{default:L((q,m,P,c)=>{if(m)m(`${_(r.value.category_name)}`);else return[w(V(r.value.category_name),1)]}),_:1},n)),t('<h2 class="question-title">'),t(d(T,{to:`/article/${r.value._id}`,class:"question-title-link"},{default:L((q,m,P,c)=>{if(m)m(`${_(r.value.title)}`);else return[w(V(r.value.title),1)]}),_:1},n)),t(`</h2></div></div><div class="card card-answer"><div class="answer-content"><div class="article-content markdown-body">${R(r.value.html)}</div></div>`),t(d(U,{item:r.value},null,n)),t("</div>"),t(d(W,{comments:A.value},null,n)),t("<!--]-->")):t('<div class="card card-answer"><div class="answer-content">该文章不存在, 或者该文章已经被删除</div></div>'):(t('<div class="card card-content-loader">'),t(d(b(ft),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:L((q,m,P,c)=>{if(m)m(`<rect x="70" y="15" rx="4" ry="4" width="117" height="6.4"${c}></rect> <rect x="70" y="35" rx="3" ry="3" width="85" height="6.4"${c}></rect><rect x="0" y="80" rx="3" ry="3" width="550" height="6.4"${c}></rect> <rect x="0" y="100" rx="3" ry="3" width="620" height="6.4"${c}></rect><rect x="0" y="120" rx="3" ry="3" width="401" height="6.4"${c}></rect> <rect x="0" y="140" rx="3" ry="3" width="501" height="6.4"${c}></rect><circle cx="30" cy="30" r="30"${c}></circle>`);else return[p("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"}),w(),p("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"}),p("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"}),w(),p("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"}),p("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"}),w(),p("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"}),p("circle",{cx:"30",cy:"30",r:"30"})]}),_:1},n)),t("</div>")),t('</div><div class="main-right">'),t(d(X,{category:s.value},null,n)),t(d(Y,{trending:g.value},null,n)),t(d(Z,null,null,n)),t("</div></div>")}}}),z=Q.setup;Q.setup=(l,o)=>{const a=K();return(a.modules||(a.modules=new Set)).add("src/pages/frontend-article.vue"),z?z(l,o):void 0};export{Q as default};
