import{_ as et,a as rt,b as at}from"./item-actions-DtYvRu23.js";import{u as N,_ as ot}from"./use-frontend-article-store-C57bp_9v.js";import{a as st,b as nt,s as R,c as it,d as V,u as ct}from"../entry-server.js";import{defineComponent as J,toRefs as E,toRef as $,reactive as mt,computed as S,mergeProps as K,unref as b,useSSRContext as O,onMounted as lt,resolveComponent as dt,withCtx as L,createVNode as p,createTextVNode as _,toDisplayString as H}from"vue";import{ssrRenderAttrs as Q,ssrRenderAttr as I,ssrInterpolate as x,ssrRenderList as vt,ssrRenderComponent as d}from"vue/server-renderer";import{u as P}from"./use-global-comment-store-BhNjELEy.js";import{useToggle as ut}from"@vueuse/core";import{useRoute as ft}from"vue-router";import{ContentLoader as pt}from"vue-content-loader";import{u as z}from"./use-global-category-store-BpFdaCEC.js";import{storeToRefs as M}from"pinia";import{useHead as gt}from"@unhead/vue";import"node:path";import"@unhead/ssr";import"@vue/server-renderer";import"element-plus";import"@lincy/utils";import"md5";import"axios";import"qs";import"js-cookie";import"lru-cache";import"node:process";const j=J({name:"FrontendComment",__name:"frontend-comment",__ssrInlineRender:!0,props:{comments:{}},setup(m){const a=E(m),n=$(a,"comments"),v=st(),u=E(v),f=$(u,"cookies"),g=P(),[w,r]=ut(!1),C=ft(),y=mt({id:C.params.id,content:""}),k=S(()=>f.value.user),A=S(()=>f.value.useremail);return nt(async()=>{if(!k.value)R("请先登录!"),v.setLoginModal(!0);else if(y.content==="")R("请输入评论内容!");else{const{code:i,data:e}=await it.post("frontend/comment/insert",y);i===200&&(y.content="",R({type:"success",content:"评论发布成功!"}),g.insertCommentItem(e))}}),(i,e,t,s)=>{e(`<div${Q(K({class:"card"},s))}><div class="comments"><div class="comment-post-wrap"><img${I("src",("useAvatar"in i?i.useAvatar:b(V))(A.value))} alt="" class="avatar-img"><div class="comment-post-input-wrap base-textarea-wrap"><textarea id="content" class="base-input textarea-input" cols="30" rows="4">${x(b(y).content)}</textarea></div><div class="comment-post-actions"><a href="javascript:;" class="btn btn-blue">发表评论</a></div></div><div class="comment-items-wrap"><!--[-->`),vt(n.value.data,h=>{e(`<div class="comment-item"><a href="javascript:;" class="comment-author-avatar-link"><img${I("src",("useAvatar"in i?i.useAvatar:b(V))(h.userid.email))} alt="" class="avatar-img"></a><div class="comment-content-wrap"><span class="comment-author-wrap"><a href="javascript:;" class="comment-author">${x(h.userid.username)}</a></span><div class="comment-content">${x(h.content)}</div><div class="comment-footer"><span class="comment-time">${x(h.creat_date)}</span><a href="javascript:;" class="comment-action-item comment-reply">回复</a></div></div></div>`)}),e("<!--]--></div>"),n.value.hasNext?(e('<div class="load-more-wrap">'),b(w)?e('<a href="javascript:;" class="comments-load-more">加载中...</a>'):e('<a href="javascript:;" class="comments-load-more">加载更多</a>'),e("</div>")):e("<!---->"),e("</div></div>")}}}),B=j.setup;j.setup=(m,o)=>{const a=O();return(a.modules||(a.modules=new Set)).add("src/components/frontend-comment.vue"),B?B(m,o):void 0};const U=J({name:"FrontendArticle",asyncData(m){const{store:o,route:a,api:n}=m,{fullPath:v,params:{id:u}}=a,f=z(o),g=N(o),w=P(o);return Promise.all([f.getCategoryList({},n),g.getTrending(void 0,n),w.getCommentList({id:u,path:v,page:1,limit:10},n),g.getArticleItem({id:u,path:v},n)])},__name:"frontend-article",__ssrInlineRender:!0,setup(m){const o=z(),a=M(o),n=$(a,"lists"),v=N(),u=M(v),f=$(u,"item"),g=$(u,"trending"),w=S(()=>f.value.isLoad),r=S(()=>f.value.data),C=P(),y=M(C),k=$(y,"lists");ct();function A(e){return e?e.replace(/<a(.*?)href="http/g,'<a$1target="_blank" href="http'):""}lt(()=>{});const i=S(()=>{var t;let e="M.M.F 小屋";return e=(t=r.value)!=null&&t.title?`${r.value.title} - M.M.F 小屋`:"M.M.F 小屋",e});return gt({title:i,meta:[{name:"description",content:i}]}),(e,t,s,h)=>{var T;const F=dt("router-link"),W=et,X=j,Y=rt,Z=ot,tt=at;t(`<div${Q(K({class:"main wrap"},h))}><div class="main-left">`),w.value?r.value?(t('<!--[--><div class="card card-question-head"><div class="question-content">'),t(d(F,{to:`/category/${r.value.category}`,class:"topic-link-item"},{default:L((q,l,D,c)=>{if(l)l(`${x(r.value.category_name)}`);else return[_(H(r.value.category_name),1)]}),_:1},s)),t('<h2 class="question-title">'),t(d(F,{to:`/article/${r.value._id}`,class:"question-title-link"},{default:L((q,l,D,c)=>{if(l)l(`${x(r.value.title)}`);else return[_(H(r.value.title),1)]}),_:1},s)),t(`</h2></div></div><div class="card card-answer"><div class="answer-content"><div class="markdown-body vuepress-markdown-body github-markdown-body article-content">${(T=A(r.value.html))!=null?T:""}</div></div>`),t(d(W,{item:r.value},null,s)),t("</div>"),t(d(X,{comments:k.value},null,s)),t("<!--]-->")):t('<div class="card card-answer"><div class="answer-content">该文章不存在, 或者该文章已经被删除</div></div>'):(t('<div class="card card-content-loader">'),t(d(b(pt),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:L((q,l,D,c)=>{if(l)l(`<rect x="70" y="15" rx="4" ry="4" width="117" height="6.4"${c}></rect> <rect x="70" y="35" rx="3" ry="3" width="85" height="6.4"${c}></rect><rect x="0" y="80" rx="3" ry="3" width="550" height="6.4"${c}></rect> <rect x="0" y="100" rx="3" ry="3" width="620" height="6.4"${c}></rect><rect x="0" y="120" rx="3" ry="3" width="401" height="6.4"${c}></rect> <rect x="0" y="140" rx="3" ry="3" width="501" height="6.4"${c}></rect><circle cx="30" cy="30" r="30"${c}></circle>`);else return[p("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"}),_(),p("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"}),p("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"}),_(),p("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"}),p("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"}),_(),p("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"}),p("circle",{cx:"30",cy:"30",r:"30"})]}),_:1},s)),t("</div>")),t('</div><div class="main-right">'),t(d(Y,{category:n.value},null,s)),t(d(Z,{trending:g.value},null,s)),t(d(tt,null,null,s)),t("</div></div>")}}}),G=U.setup;U.setup=(m,o)=>{const a=O();return(a.modules||(a.modules=new Set)).add("src/pages/frontend-article.vue"),G?G(m,o):void 0};export{U as default};
