import{_ as wt,a as kt,b as Ct}from"./item-actions-DtYvRu23.js";import{u as I,_ as bt}from"./use-frontend-article-store-C57bp_9v.js";import{a as _t,b as St,s as J,c as At,d as tt,u as Rt,_ as Lt}from"../entry-server.js";import{defineComponent as mt,toRefs as et,toRef as F,reactive as Tt,computed as V,mergeProps as dt,unref as l,useSSRContext as vt,ref as rt,useTemplateRef as Mt,onMounted as Ft,resolveComponent as Pt,withCtx as d,createVNode as n,createTextVNode as N,createBlock as T,openBlock as M,Fragment as ot,renderList as nt,toDisplayString as O,createCommentVNode as at}from"vue";import{ssrRenderAttrs as ft,ssrRenderAttr as it,ssrInterpolate as S,ssrRenderList as ut,ssrRenderComponent as i,ssrRenderStyle as jt}from"vue/server-renderer";import{u as Q}from"./use-global-comment-store-BhNjELEy.js";import{useToggle as qt}from"@vueuse/core";import{useRoute as Nt}from"vue-router";import{c as Vt,d as Dt}from"./vendor-Dh2hNSeG.js";import{ContentLoader as Et}from"vue-content-loader";import{u as st}from"./use-global-category-store-BpFdaCEC.js";import{storeToRefs as K}from"pinia";import{useHead as Bt}from"@unhead/vue";import"node:path";import"@unhead/vue/server";import"@vue/server-renderer";import"@lincy/utils";import"md5";import"axios";import"qs";import"js-cookie";import"lru-cache";import"node:process";import"@vue/shared";import"@popperjs/core";import"lodash-unified";import"dayjs";import"dayjs/plugin/localeData.js";import"dayjs/plugin/customParseFormat.js";import"dayjs/plugin/advancedFormat.js";import"dayjs/plugin/weekOfYear.js";import"dayjs/plugin/weekYear.js";import"dayjs/plugin/dayOfYear.js";import"dayjs/plugin/isSameOrAfter.js";import"dayjs/plugin/isSameOrBefore.js";import"normalize-wheel-es";import"@element-plus/icons-vue";import"@ctrl/tinycolor";const U=mt({name:"FrontendComment",__name:"frontend-comment",__ssrInlineRender:!0,props:{comments:{}},setup(y){const m=et(y),p=F(m,"comments"),h=_t(),w=et(h),k=F(w,"cookies"),A=Q(),[P,s]=qt(!1),H=Nt(),R=Tt({id:H.params.id,content:""}),z=V(()=>k.value.user),f=V(()=>k.value.useremail);return St(async()=>{if(!z.value)J("请先登录!"),h.setLoginModal(!0);else if(R.content==="")J("请输入评论内容!");else{const{code:g,data:o}=await At.post("frontend/comment/insert",R);g===200&&(R.content="",J({type:"success",content:"评论发布成功!"}),A.insertCommentItem(o))}}),(g,o,W,D)=>{o(`<div${ft(dt({class:"card"},D))}><div class="comments"><div class="comment-post-wrap"><img${it("src",("useAvatar"in g?g.useAvatar:l(tt))(f.value))} alt="" class="avatar-img"><div class="comment-post-input-wrap base-textarea-wrap"><textarea id="content" class="base-input textarea-input" cols="30" rows="4">${S(l(R).content)}</textarea></div><div class="comment-post-actions"><a href="javascript:;" class="btn btn-blue">发表评论</a></div></div><div class="comment-items-wrap"><!--[-->`),ut(p.value.data,C=>{o(`<div class="comment-item"><a href="javascript:;" class="comment-author-avatar-link"><img${it("src",("useAvatar"in g?g.useAvatar:l(tt))(C.userid.email))} alt="" class="avatar-img"></a><div class="comment-content-wrap"><span class="comment-author-wrap"><a href="javascript:;" class="comment-author">${S(C.userid.username)}</a></span><div class="comment-content">${S(C.content)}</div><div class="comment-footer"><span class="comment-time">${S(C.creat_date)}</span><a href="javascript:;" class="comment-action-item comment-reply">回复</a></div></div></div>`)}),o("<!--]--></div>"),p.value.hasNext?(o('<div class="load-more-wrap">'),l(P)?o('<a href="javascript:;" class="comments-load-more">加载中...</a>'):o('<a href="javascript:;" class="comments-load-more">加载更多</a>'),o("</div>")):o("<!---->"),o("</div></div>")}}}),ct=U.setup;U.setup=(y,v)=>{const m=vt();return(m.modules||(m.modules=new Set)).add("src/components/frontend-comment.vue"),ct?ct(y,v):void 0};const pt=mt({name:"FrontendArticle",asyncData(y){const{store:v,route:m,api:p}=y,{fullPath:h,params:{id:w}}=m,k=st(v),A=I(v),P=Q(v);return Promise.all([k.getCategoryList({},p),A.getTrending(void 0,p),P.getCommentList({id:w,path:h,page:1,limit:10},p),A.getArticleItem({id:w,path:h},p)])},__name:"frontend-article",__ssrInlineRender:!0,setup(y){const v=st(),m=K(v),p=F(m,"lists"),h=I(),w=K(h),k=F(w,"item"),A=F(w,"trending"),P=V(()=>k.value.isLoad),s=V(()=>k.value.data),H=Q(),R=K(H),z=F(R,"lists");Rt();const f=rt("none"),g=Mt("preview"),o=rt([]);function W(){var b;const $=(b=g.value)==null?void 0:b.querySelectorAll("h1,h2,h3,h4,h5,h6");if(!$)return;const t=Array.from($).filter(u=>!!u.textContent.trim());if(!t.length){o.value=[];return}const a=Array.from(new Set(t.map(u=>u.tagName))).sort();o.value=t.map(u=>{var j;return{title:((j=u.textContent)==null?void 0:j.trim())||"",lineIndex:u.getAttribute("data-v-md-line"),indent:a.indexOf(u.tagName)}}),o.value.length?f.value="show":f.value="none"}function D($){var b;const{lineIndex:t}=$,a=(b=g.value)==null?void 0:b.querySelector(`[data-v-md-line="${t}"]`);a&&a.scrollIntoView({behavior:"smooth"})}Ft(()=>{W()});const C=V(()=>{var t;let $="M.M.F 小屋";return $=(t=s.value)!=null&&t.title?`${s.value.title} - M.M.F 小屋`:"M.M.F 小屋",$});return Bt({title:C,meta:[{name:"description",content:C}]}),($,t,a,b)=>{var Y;const u=Lt,j=Vt,E=Dt,X=Pt("router-link"),gt=wt,yt=U,$t=kt,xt=bt,ht=Ct;t(`<div${ft(dt({class:"main wrap"},b))}><div class="main-left">`),P.value?s.value?(t("<!--[-->"),t(i(u,null,{default:d((B,e,_,r)=>{if(e)l(f)==="show"?(e(`<div class="toc"${r}><div class="card card-trending"${r}><h2 class="card-title"${r}>文章导航</h2><div class="card-content"${r}>`),e(i(j,{"max-height":"calc(100vh - 150px)"},{default:d((x,c,G,q)=>{if(c)c("<!--[-->"),ut(l(o),(L,Z)=>{c(`<div class="toc-item" style="${jt(`--padding-left: ${L.indent*20}px`)}"${q}>${S(L.title)}</div>`)}),c("<!--]-->");else return[(M(!0),T(ot,null,nt(l(o),(L,Z)=>(M(),T("div",{key:Z,class:"toc-item",style:`--padding-left: ${L.indent*20}px`,onClick:Ot=>D(L)},O(L.title),13,["onClick"]))),128))]}),_:1},_,r)),e(`</div></div><div class="btn-toc close-toc"${r}>`),e(i(E,{class:"box-item",effect:"dark",content:"收起导航",placement:"top"},{default:d((x,c,G,q)=>{if(c)c(`<i class="i-mdi-transfer-left"${q}></i>`);else return[n("i",{class:"i-mdi-transfer-left"})]}),_:1},_,r)),e("</div></div>")):e("<!---->");else return[l(f)==="show"?(M(),T("div",{key:0,class:"toc"},[n("div",{class:"card card-trending"},[n("h2",{class:"card-title"},"文章导航"),n("div",{class:"card-content"},[n(j,{"max-height":"calc(100vh - 150px)"},{default:d(()=>[(M(!0),T(ot,null,nt(l(o),(x,c)=>(M(),T("div",{key:c,class:"toc-item",style:`--padding-left: ${x.indent*20}px`,onClick:G=>D(x)},O(x.title),13,["onClick"]))),128))]),_:1})])]),n("div",{class:"btn-toc close-toc",onClick:x=>f.value="hide"},[n(E,{class:"box-item",effect:"dark",content:"收起导航",placement:"top"},{default:d(()=>[n("i",{class:"i-mdi-transfer-left"})]),_:1})],8,["onClick"])])):at("",!0)]}),_:1},a)),t('<div class="card card-question-head"><div class="question-content">'),t(i(X,{to:`/category/${s.value.category}`,class:"topic-link-item"},{default:d((B,e,_,r)=>{if(e)e(`${S(s.value.category_name)}`);else return[N(O(s.value.category_name),1)]}),_:1},a)),t('<h2 class="question-title">'),t(i(X,{to:`/article/${s.value._id}`,class:"question-title-link"},{default:d((B,e,_,r)=>{if(e)e(`${S(s.value.title)}`);else return[N(O(s.value.title),1)]}),_:1},a)),t("</h2></div>"),t(i(u,null,{default:d((B,e,_,r)=>{if(e)l(f)==="hide"?(e(`<div class="btn-toc open-toc"${r}>`),e(i(E,{class:"box-item",effect:"dark",content:"展开导航",placement:"top"},{default:d((x,c,G,q)=>{if(c)c(`<i class="i-mdi-transfer-right"${q}></i>`);else return[n("i",{class:"i-mdi-transfer-right"})]}),_:1},_,r)),e("</div>")):e("<!---->");else return[l(f)==="hide"?(M(),T("div",{key:0,class:"btn-toc open-toc",onClick:x=>f.value="show"},[n(E,{class:"box-item",effect:"dark",content:"展开导航",placement:"top"},{default:d(()=>[n("i",{class:"i-mdi-transfer-right"})]),_:1})],8,["onClick"])):at("",!0)]}),_:1},a)),t(`</div><div class="card card-answer"><div class="answer-content"><div class="markdown-body vuepress-markdown-body github-markdown-body article-content">${(Y=s.value.html)!=null?Y:""}</div></div>`),t(i(gt,{item:s.value},null,a)),t("</div>"),t(i(yt,{comments:z.value},null,a)),t("<!--]-->")):t('<div class="card card-answer"><div class="answer-content">该文章不存在, 或者该文章已经被删除</div></div>'):(t('<div class="card card-content-loader">'),t(i(l(Et),{height:160,width:660,speed:2,"primary-color":"#f3f3f3","secondary-color":"#ecebeb"},{default:d((B,e,_,r)=>{if(e)e(`<rect x="70" y="15" rx="4" ry="4" width="117" height="6.4"${r}></rect> <rect x="70" y="35" rx="3" ry="3" width="85" height="6.4"${r}></rect><rect x="0" y="80" rx="3" ry="3" width="550" height="6.4"${r}></rect> <rect x="0" y="100" rx="3" ry="3" width="620" height="6.4"${r}></rect><rect x="0" y="120" rx="3" ry="3" width="401" height="6.4"${r}></rect> <rect x="0" y="140" rx="3" ry="3" width="501" height="6.4"${r}></rect><circle cx="30" cy="30" r="30"${r}></circle>`);else return[n("rect",{x:"70",y:"15",rx:"4",ry:"4",width:"117",height:"6.4"}),N(),n("rect",{x:"70",y:"35",rx:"3",ry:"3",width:"85",height:"6.4"}),n("rect",{x:"0",y:"80",rx:"3",ry:"3",width:"550",height:"6.4"}),N(),n("rect",{x:"0",y:"100",rx:"3",ry:"3",width:"620",height:"6.4"}),n("rect",{x:"0",y:"120",rx:"3",ry:"3",width:"401",height:"6.4"}),N(),n("rect",{x:"0",y:"140",rx:"3",ry:"3",width:"501",height:"6.4"}),n("circle",{cx:"30",cy:"30",r:"30"})]}),_:1},a)),t("</div>")),t('</div><div class="main-right">'),t(i($t,{category:p.value},null,a)),t(i(xt,{trending:A.value},null,a)),t(i(ht,null,null,a)),t("</div></div>")}}}),lt=pt.setup;pt.setup=(y,v)=>{const m=vt();return(m.modules||(m.modules=new Set)).add("src/pages/frontend-article.vue"),lt?lt(y,v):void 0};export{pt as default};
