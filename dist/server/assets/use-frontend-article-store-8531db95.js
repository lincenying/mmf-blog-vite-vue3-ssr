import{defineComponent as k,toRefs as _,toRef as x,resolveComponent as S,mergeProps as R,withCtx as w,createTextVNode as A,toDisplayString as C,useSSRContext as y,reactive as I}from"vue";import{ssrRenderAttrs as L,ssrRenderList as P,ssrInterpolate as c,ssrRenderComponent as N}from"vue/server-renderer";import{defineStore as T}from"pinia";import{c as g}from"../entry-server.js";const h=k({name:"AsideTrending",__name:"aside-trending",__ssrInlineRender:!0,props:{trending:null},setup(t){const r=_(t),l=x(r,"trending");return(u,e,n,a)=>{const i=S("router-link");e(`<div${L(R({class:"card card-trending"},a))}><h2 class="card-title">热门文章</h2><div class="card-content"><!--[-->`),P(l.value,(s,m)=>{e(`<div class="trending-item"><span class="trending-rank-num">${c(m+1)}</span>`),e(N(i,{to:`/article/${s._id}`,class:"trending-title"},{default:w((f,o,p,j)=>{if(o)o(`${c(s.title)}`);else return[A(C(s.title),1)]}),_:2},n)),e(`<div class="trending-meta"><div class="trending-meta-item"><i class="icon icon-action-voteup"></i>${c(s.like)}</div><div class="trending-meta-item"><i class="icon icon-action-comment"></i>${c(s.comment_count)}</div></div></div>`)}),e("<!--]--></div></div>")}}}),v=h.setup;h.setup=(t,d)=>{const r=y();return(r.modules||(r.modules=new Set)).add("src/components/aside-trending.vue"),v?v(t,d):void 0};const b=T("frontendArticleStore",()=>{const t=I({lists:{data:[],path:"",hasNext:0,hasPrev:0,page:1},item:{data:null,path:""},trending:[]}),d=async(e,n)=>{if(n||(n=g),t.lists.data.length>0&&e.path===t.lists.path&&e.page===1)return;const{code:a,data:i}=await n.get("frontend/article/list",{...e,path:void 0,cache:!0});if(a===200&&i){const{list:s=[],path:m,hasNext:f=0,hasPrev:o=0,page:p}={...i,path:e.path,page:e.page};t.lists={data:p===1?s:t.lists.data.concat(s),hasNext:f,hasPrev:o,page:(p||1)+1,path:m}}},r=async(e,n)=>{n||(n=g);const{code:a,data:i}=await n.get("frontend/article/item",{...e,path:void 0,markdown:1,cache:!0});a===200&&i&&(t.item={data:i,...e,isLoad:!0})},l=async(e,n)=>{if(n||(n=g),t.trending.length)return;const{code:a,data:i}=await n.get("frontend/trending",{cache:!0});a===200&&i&&(t.trending=i.list)},u=e=>{const{id:n,status:a}=e;t.item.data&&t.item.data._id===n&&(a?t.item.data.like++:t.item.data.like--,t.item.data.like_status=a);const i=t.lists.data.findIndex(s=>s._id===n);if(i>-1){const s=Object.assign({},t.lists.data[i]);a?s.like++:s.like--,s.like_status=a,t.lists.data.splice(i,1,s)}};return{..._(t),getArticleList:d,getArticleItem:r,getTrending:l,modifyLikeStatus:u}}),$=b;export{h as _,$ as u};
