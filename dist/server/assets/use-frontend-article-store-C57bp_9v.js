import{defineComponent as k,toRefs as _,toRef as x,resolveComponent as S,mergeProps as R,withCtx as $,createTextVNode as w,toDisplayString as C,useSSRContext as y,reactive as A}from"vue";import{ssrRenderAttrs as I,ssrRenderList as L,ssrInterpolate as c,ssrRenderComponent as P}from"vue/server-renderer";import{defineStore as N}from"pinia";import{c as g}from"../entry-server.js";const h=k({name:"AsideTrending",__name:"aside-trending",__ssrInlineRender:!0,props:{trending:{}},setup(t){const r=_(t),l=x(r,"trending");return(u,e,a,i)=>{const s=S("router-link");e(`<div${I(R({class:"card card-trending"},i))}><h2 class="card-title">热门文章</h2><div class="card-content"><!--[-->`),L(l.value,(n,p)=>{e(`<div class="trending-item"><span class="trending-rank-num">${c(p+1)}</span>`),e(P(s,{to:`/article/${n._id}`,class:"trending-title"},{default:$((f,o,m,T)=>{if(o)o(`${c(n.title)}`);else return[w(C(n.title),1)]}),_:2},a)),e(`<div class="trending-meta"><div class="trending-meta-item"><i class="icon icon-action-voteup"></i>${c(n.like)}</div><div class="trending-meta-item"><i class="icon icon-action-comment"></i>${c(n.comment_count)}</div></div></div>`)}),e("<!--]--></div></div>")}}}),v=h.setup;h.setup=(t,d)=>{const r=y();return(r.modules||(r.modules=new Set)).add("src/components/aside-trending.vue"),v?v(t,d):void 0};const V=N("frontendArticleStore",()=>{const t=A({lists:{data:[],path:"",hasNext:0,hasPrev:0,page:1},item:{data:null,path:""},trending:[]}),d=async(e,a=g)=>{if(t.lists.data.length>0&&e.path===t.lists.path&&e.page===1)return;const{code:i,data:s}=await a.get("frontend/article/list",{...e,path:void 0,cache:!0});if(i===200&&s){const{list:n=[],path:p,hasNext:f=0,hasPrev:o=0,page:m}={...s,path:e.path,page:e.page};t.lists={data:m===1?n:t.lists.data.concat(n),hasNext:f,hasPrev:o,page:(m||1)+1,path:p}}},r=async(e,a=g)=>{const{code:i,data:s}=await a.get("frontend/article/item",{...e,path:void 0,markdown:1,cache:!0});i===200&&s&&(t.item={data:s,...e,isLoad:!0})},l=async(e={},a=g)=>{if(t.trending.length)return;const{code:i,data:s}=await a.get("frontend/trending",{...e,cache:!0});i===200&&s&&(t.trending=s.list)},u=e=>{const{id:a,status:i}=e;t.item.data&&t.item.data._id===a&&(i?t.item.data.like++:t.item.data.like--,t.item.data.like_status=i);const s=t.lists.data.findIndex(n=>n._id===a);if(s>-1){const n=Object.assign({},t.lists.data[s]);i?n.like++:n.like--,n.like_status=i,t.lists.data.splice(s,1,n)}};return{..._(t),getArticleList:d,getArticleItem:r,getTrending:l,modifyLikeStatus:u}});export{h as _,V as u};
