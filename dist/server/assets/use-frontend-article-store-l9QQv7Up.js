import{defineComponent as k,toRefs as g,toRef as x,mergeProps as R,useSSRContext as S,reactive as A}from"vue";import{ssrRenderAttrs as w,ssrRenderList as y,ssrInterpolate as o,ssrRenderAttr as I}from"vue/server-renderer";import{useRouter as L}from"vue-router";import{defineStore as P}from"pinia";import{c as l}from"../entry-server.js";const f=k({name:"AsideTrending",__name:"aside-trending",__ssrInlineRender:!0,props:{trending:null},setup(t){const r=g(t),c=x(r,"trending");return L(),(m,s,n,i)=>{s(`<div${w(R({class:"card card-trending"},i))}><h2 class="card-title">热门文章</h2><div class="card-content"><!--[-->`),y(c.value,(e,a)=>{s(`<div class="trending-item"><span class="trending-rank-num">${o(a+1)}</span><a href="javascript:;"${I("to",`/article/${e._id}`)} class="trending-title">${o(e.title)}</a><div class="trending-meta"><div class="trending-meta-item"><i class="icon icon-action-voteup"></i>${o(e.like)}</div><div class="trending-meta-item"><i class="icon icon-action-comment"></i>${o(e.comment_count)}</div></div></div>`)}),s("<!--]--></div></div>")}}}),u=f.setup;f.setup=(t,d)=>{const r=S();return(r.modules||(r.modules=new Set)).add("src/components/aside-trending.vue"),u?u(t,d):void 0};const j=P("frontendArticleStore",()=>{const t=A({lists:{data:[],path:"",hasNext:0,hasPrev:0,page:1},item:{data:null,path:""},trending:[]}),d=async(s,n)=>{if(n||(n=l),t.lists.data.length>0&&s.path===t.lists.path&&s.page===1)return;const{code:i,data:e}=await n.get("frontend/article/list",{...s,path:void 0,cache:!0});if(i===200&&e){const{list:a=[],path:v,hasNext:h=0,hasPrev:_=0,page:p}={...e,path:s.path,page:s.page};t.lists={data:p===1?a:t.lists.data.concat(a),hasNext:h,hasPrev:_,page:(p||1)+1,path:v}}},r=async(s,n)=>{n||(n=l);const{code:i,data:e}=await n.get("frontend/article/item",{...s,path:void 0,markdown:1,cache:!0});i===200&&e&&(t.item={data:e,...s,isLoad:!0})},c=async(s,n)=>{if(n||(n=l),t.trending.length)return;const{code:i,data:e}=await n.get("frontend/trending",{cache:!0});i===200&&e&&(t.trending=e.list)},m=s=>{const{id:n,status:i}=s;t.item.data&&t.item.data._id===n&&(i?t.item.data.like++:t.item.data.like--,t.item.data.like_status=i);const e=t.lists.data.findIndex(a=>a._id===n);if(e>-1){const a=Object.assign({},t.lists.data[e]);i?a.like++:a.like--,a.like_status=i,t.lists.data.splice(e,1,a)}};return{...g(t),getArticleList:d,getArticleItem:r,getTrending:c,modifyLikeStatus:m}}),F=j;export{f as _,F as u};
