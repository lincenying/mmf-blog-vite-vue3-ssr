import{basename as De}from"node:path";import{createHead as He,renderSSRHead as Oe}from"@unhead/vue/server";import{renderToString as qe}from"@vue/server-renderer";import{createPinia as Pe,defineStore as Te,storeToRefs as oe}from"pinia";import{ref as M,defineComponent as E,unref as v,mergeProps as F,useSSRContext as I,reactive as O,onMounted as ae,computed as J,createElementBlock as ze,toRefs as j,onActivated as Ve,getCurrentInstance as Xe,toRef as G,resolveComponent as Me,withCtx as B,createVNode as _,resolveDynamicComponent as ge,Transition as Je,createBlock as Q,openBlock as Z,KeepAlive as Ge,Suspense as Ke,createSSRApp as Ye}from"vue";import{ElMessage as Be,ElLoading as Qe,ElMessageBox as V}from"element-plus";import{ssrRenderAttrs as N,ssrRenderAttr as L,ssrRenderComponent as k,ssrRenderSuspense as Ze,ssrRenderVNode as et}from"vue/server-renderer";import{useWindowSize as tt,useRafFn as nt,useWindowScroll as st,useToggle as ot}from"@vueuse/core";import{strLen as he,isBrowser as Ce}from"@lincy/utils";import se from"md5";import{useRoute as Ae,onBeforeRouteLeave as at,useRouter as rt,createRouter as it,createMemoryHistory as ct}from"vue-router";import K from"axios";import Le from"qs";import Ee from"js-cookie";import{LRUCache as lt}from"lru-cache";import pt from"node:process";function dt(e){return e.use(Qe),e.config.globalProperties.$msgbox=V,e.config.globalProperties.$alert=V.alert,e.config.globalProperties.$confirm=V.confirm,e.config.globalProperties.$prompt=V.prompt,e.config.globalProperties.$message=Be,e}const ut=Be;function mt(e){dt(e)}const ft={install:mt};function gt(e={}){const{immediate:n=!1,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisteredSW:o,onRegisterError:r}=e;let i,c;const l=async(m=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(i=await import("./assets/vendor-CC4K6GI8.js").then(({Workbox:m})=>new m("/sw.js",{scope:"/",type:"classic"})).catch(m=>{r==null||r(m)}),!i)return;i.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),i.addEventListener("installed",m=>{m.isUpdate||s==null||s()}),i.register({immediate:n}).then(m=>{o?o("/sw.js",m):a==null||a(m)}).catch(m=>{r==null||r(m)})}}return c=h(),l}function ht(e={}){const{immediate:n=!0,onNeedRefresh:t,onOfflineReady:s,onRegistered:a,onRegisteredSW:o,onRegisterError:r}=e,i=M(!1),c=M(!1);return{updateServiceWorker:gt({immediate:n,onNeedRefresh(){i.value=!0,t==null||t()},onOfflineReady(){c.value=!0,s==null||s()},onRegistered:a,onRegisteredSW:o,onRegisterError:r}),offlineReady:c,needRefresh:i}}const re=E({name:"ReloadPrompt",__name:"reload-prompt",__ssrInlineRender:!0,setup(e){const{needRefresh:n}=ht();return(t,s,a,o)=>{v(n)?s(`<div${N(F({id:"app-refresh",class:"app-refresh"},o))}><div class="app-refresh-wrap"><label>新内容可用，单击刷新按钮更新</label><span>刷新</span><span>关闭</span></div></div>`):s("<!---->")}}}),ve=re.setup;re.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/reload-prompt.vue"),ve?ve(e,n):void 0};const vt="#88888825",ie=E({__name:"bg-plum",__ssrInlineRender:!0,setup(e){const n=Math.PI,t=Math.PI/2,s=Math.PI/12,a=M(null),{random:o}=Math,r=O(tt()),i=M(()=>{}),c=M(4),l=M(6),h=M(!1);function m(p,f=400,d=400,x){const g=p.getContext("2d"),$=window.devicePixelRatio||1,C=g.webkitBackingStorePixelRatio||g.mozBackingStorePixelRatio||g.msBackingStorePixelRatio||g.oBackingStorePixelRatio||g.backingStorePixelRatio||1,w=$/C;return p.style.width=`${f}px`,p.style.height=`${d}px`,p.width=w*f,p.height=w*d,g.scale(w,w),{ctx:g,dpi:w}}function y(p=0,f=0,d=0,x=0){const g=d*Math.cos(x),$=d*Math.sin(x);return[p+g,f+$]}ae(async()=>{const p=a.value,{ctx:f}=m(p,r.width,r.height),{width:d,height:x}=p;let g=[],$=[],C=0;const w=(P,W,Y)=>{const Fe=o()*l.value,[D,H]=y(P,W,Fe,Y);f.beginPath(),f.moveTo(P,W),f.lineTo(D,H),f.stroke();const Ne=Y+o()*s,Ue=Y-o()*s;D<-100||D>r.width+100||H<-100||H>r.height+100||((C<=c.value||o()>.5)&&g.push(()=>w(D,H,Ne)),(C<=c.value||o()>.5)&&g.push(()=>w(D,H,Ue)))};let U=performance.now();const z=1e3/40;let A;A=nt(()=>{performance.now()-U<z||(C+=1,$=g,g=[],U=performance.now(),$.length||(A.pause(),h.value=!0),$.forEach(P=>P()))},{immediate:!1}),i.value=()=>{A.pause(),C=0,f.clearRect(0,0,d,x),f.lineWidth=1,f.strokeStyle=vt,$=[],g=[()=>w(o()*r.width,0,t),()=>w(o()*r.width,r.height,-t),()=>w(0,o()*r.height,0),()=>w(r.width,o()*r.height,n)],r.width<500&&(g=g.slice(0,2)),A.resume(),h.value=!1},i.value()});const u=J(()=>"radial-gradient(circle, transparent, black);");return(p,f,d,x)=>{f(`<div${N(F({class:"pointer-events-none fixed bottom-0 left-0 right-0 top-0",style:[{"z-index":"-1"},`mask-image: ${v(u)};--webkit-mask-image: ${v(u)};`]},x))}><canvas width="400" height="400"></canvas></div>`)}}}),we=ie.setup;ie.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/bg-plum.vue"),we?we(e,n):void 0};const ce=E({name:"ClientOnly",props:{fallback:String,placeholder:String,placeholderTag:String,fallbackTag:String},setup(e,{slots:n}){const t=M(!1);return ae(()=>{t.value=!0}),s=>{var i;if(t.value)return(i=n.default)==null?void 0:i.call(n);const a=n.fallback||n.placeholder;if(a)return a();const o=s.fallback||s.placeholder||"",r=s.fallbackTag||s.placeholderTag||"span";return ze(r,null,o)}}}),_e=ce.setup;ce.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/client-only.vue"),_e?_e(e,n):void 0};const le=E({name:"BackTop",__name:"back-top",__ssrInlineRender:!0,setup(e){const{y:n}=st();return(t,s,a,o)=>{s(`<div${N(F({style:v(n)>500?null:{display:"none"},class:"back-top"},o))}><a href="javascript:;"></a></div>`)}}}),ke=le.setup;le.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/back-top.vue"),ke?ke(e,n):void 0};Pe();const q=Te("globalStore",()=>{const e=O({loading:!1,cookies:{},showLoginModal:!1,showRegisterModal:!1,ISDEV:!1,ISPRE:!1,ISPROD:!0}),n=a=>{e.showLoginModal=a},t=a=>{e.showRegisterModal=a},s=a=>{e.cookies=a};return{...j(e),setLoginModal:n,setRegisterModal:t,setCookies:s}}),pe=Te("appShellStore",()=>{const e=O({needPageTransition:!0,isPageSwitching:!1,pageTransitionName:"",historyPageScrollTop:{}}),n=()=>{e.needPageTransition=!0},t=()=>{e.needPageTransition=!1},s=r=>{e.isPageSwitching=r},a=r=>{const{path:i,scrollTop:c}=r;e.historyPageScrollTop[i]=c},o=r=>{e.pageTransitionName=r};return{...j(e),enablePageTransition:n,disablePageTransition:t,setPageSwitching:s,saveScrollTop:a,setPageTransitionName:o}});function dn(){const e=Xe(),n=e.appContext.config.globalProperties,t=e.type;return{ctx:n,options:t}}function Ie(e,n="auto"){const[t,s]=ot(!1);return async(...a)=>{if(!t.value){s(!0);try{const o=await e(...a);(n===!0||n==="auto"&&o!==!1)&&s(!1)}catch(o){throw s(!1),o}}}}function un(){const e=Ae(),n=pe(),{historyPageScrollTop:t}=oe(n);Ve(()=>{const s=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,s)},300)}),ae(()=>{const s=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,s)},300)}),at((s,a,o)=>{n.saveScrollTop({path:a.fullPath,scrollTop:Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop)}),o()})}function ee(e,n){return e=e||"123456",e=decodeURIComponent(e),n=n||256,`https://cravatar.cn/avatar/${se(e)}?s=${n}&d=identicon&r=g`}function T(e){let n,t;e?typeof e=="string"?(n=e,t="error"):(n=e.content,t=e.type):(n="接口返回数据错误",t="error"),ut[t](n)}const be={api:"/api/",timeout:3e4};K.interceptors.request.use(e=>e,e=>Promise.reject(e));K.interceptors.response.use(e=>e,e=>{const n={};return n.config=e.config,n.data=null,n.headers=e.config.headers,n.status=e.code,n.statusText=e.message,n.request=e.request,Promise.resolve(n)});function te(e){return e.status===200||e.status===304?e.data:e.status===401?{code:401,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:"您还没有登录, 或者登录超时!"}:{code:-404,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:`接口返回数据错误, 错误代码: ${e.status||"未知"}`}}function ne(e){return e.code===-500?window.location.href="/backend":e.code===-400?window.location.href="/":e.code!==200&&T(e.message),e}function wt(){const e=K.create({baseURL:be.api,headers:{"X-Requested-With":"XMLHttpRequest"},timeout:be.timeout});return{async get(n,t,s={}){const a=await e({method:"get",url:n,params:t,headers:{...s}}),o=te(a);return ne(o)},async post(n,t,s={}){const a=await e({method:"post",url:n,data:Le.stringify(t),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...s}}),o=te(a);return ne(o)},async file(n,t,s={}){const a=await e({method:"post",url:n,data:t,headers:{...s}}),o=te(a);return ne(o)}}}const We=wt(),de=E({name:"SignUp",__name:"sign-up",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=j(e),s=G(t,"show"),a=q(),o=O({username:"",email:"",password:"",re_password:""});function r(){a.setLoginModal(!0),a.setRegisterModal(!1)}return Ie(async()=>{const i=/^[\w\-.]+@[\w-]+\.[\w-]+$/;if(!o.username||!o.password||!o.email)return T("请将表单填写完整!");if(he(o.username)<4)return T("用户长度至少 2 个中文或 4 个英文!");if(i.test(o.email)){if(he(o.password)<8)return T("密码长度至少 8 位!");if(o.password!==o.re_password)return T("两次输入的密码不一致!")}else return T("邮箱格式错误!");const{code:c,message:l}=await We.post("frontend/user/insert",o);c===200&&(T({type:"success",content:l}),r())}),(i,c,l,h)=>{c(`<div${N(F({class:["modal-wrap modal-signup-wrap",s.value?"active":""]},h))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">注册</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${L("value",v(o).username)} type="text" placeholder="昵称" class="base-input" name="username"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${L("value",v(o).email)} type="text" placeholder="邮箱" class="base-input" name="email"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${L("value",v(o).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${L("value",v(o).re_password)} type="password" placeholder="重复密码" class="base-input" autocomplete="off" name="re_password"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认注册</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">直接登录</a></form></div></div></div>`)}}}),ye=de.setup;de.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/sign-up.vue"),ye?ye(e,n):void 0};const ue=E({name:"SignIn",__name:"sign-in",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=j(e),s=G(t,"show");q();const a=O({username:"",password:""});return Ie(async()=>{if(!a.username||!a.password)return T("请将表单填写完整!");const{code:o,message:r}=await We.post("frontend/user/login",a);o===200&&(T({type:"success",content:r}),window.location.reload())}),(o,r,i,c)=>{r(`<div${N(F({class:["modal-wrap modal-sign-in-wrap",s.value?"active":""]},c))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">登录</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${L("value",v(a).username)} type="text" placeholder="昵称" class="base-input" name="username"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${L("value",v(a).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认登录</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">我要注册</a></form></div></div></div>`)}}}),Se=ue.setup;ue.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/sign-in.vue"),Se?Se(e,n):void 0};const me=E({name:"GlobalNavigation",__name:"global-navigation",__ssrInlineRender:!0,props:{isBackend:{type:Boolean}},setup(e){const t=j(e),s=G(t,"isBackend"),a=q(),o=j(a),r=G(o,"cookies"),i=J(()=>!!r.value.user);return rt(),(c,l,h,m)=>{const y=Me("router-link");l(`<nav${N(F({class:"global-nav"},m))}><div class="wrap"><div class="left-part">`),l(k(y,{to:"/","active-class":"current",exact:"",class:"logo-link"},{default:B((u,p,f,d)=>{if(p)p(`<i class="icon icon-nav-logo"${d}></i><span class="hidden"${d}>M.M.F 小屋</span>`);else return[_("i",{class:"icon icon-nav-logo"}),_("span",{class:"hidden"},"M.M.F 小屋")]}),_:1},h)),l('<div class="main-nav">'),l(k(y,{to:"/","active-class":"current",exact:"",class:"nav-link"},{default:B((u,p,f,d)=>{if(p)p(`<i class="icon icon-nav-home"${d}></i><span class="text"${d}>首页</span>`);else return[_("i",{class:"icon icon-nav-home"}),_("span",{class:"text"},"首页")]}),_:1},h)),l(k(y,{to:"/trending/visit","active-class":"current",class:"nav-link"},{default:B((u,p,f,d)=>{if(p)p(`<i class="icon icon-nav-explore"${d}></i><span class="text"${d}>热门</span>`);else return[_("i",{class:"icon icon-nav-explore"}),_("span",{class:"text"},"热门")]}),_:1},h)),l(k(y,{to:"/about","active-class":"current",class:"nav-link"},{default:B((u,p,f,d)=>{if(p)p(`<i class="icon icon-nav-features"${d}></i><span class="text"${d}>关于</span>`);else return[_("i",{class:"icon icon-nav-features"}),_("span",{class:"text"},"关于")]}),_:1},h)),l('<a href="https://handle.mmxiaowu.com/" target="_blank" class="nav-link"><i class="icon icon-nav-game"></i><span class="text">汉兜</span></a></div></div>'),s.value?l("<!---->"):(l('<div class="right-part"><span class="nav-search"><i class="icon icon-search-white"></i><input placeholder="记得按回车哦" name="search" class="nav-search-input"></span>'),v(i)?(l('<span class="nav-me">'),l(k(y,{to:"/user/account",class:"nav-me-link"},{default:B((u,p,f,d)=>{if(p)p(`<img${L("src",("useAvatar"in c?c.useAvatar:v(ee))(r.value.useremail,100))} class="nav-avatar-img"${d}>`);else return[_("img",{src:("useAvatar"in c?c.useAvatar:v(ee))(r.value.useremail,100),class:"nav-avatar-img"},null,8,["src"])]}),_:1},h)),l("</span>")):l(`<span class="nav-me"><a href="javascript:;" class="nav-me-link"><img${L("src",("useAvatar"in c?c.useAvatar:v(ee))("noavatar"))} class="nav-avatar-img"></a></span>`),l("</div>")),l("</div></nav>")}}}),$e=me.setup;me.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/global-navigation.vue"),$e?$e(e,n):void 0};const fe=E({name:"AppRoot",__name:"app",__ssrInlineRender:!0,setup(e){const n=q(),{showLoginModal:t,showRegisterModal:s}=j(n),a=pe(),{pageTransitionName:o}=oe(a),r=M("frontend-index,frontend-about"),i=Ae(),c=J(()=>(i.meta.path||i.path).replace(/\//g,"_")),l=J(()=>i.path.includes("backend"));function h(){a.setPageSwitching(!0)}function m(){a.setPageSwitching(!1)}return(y,u,p,f)=>{const d=me,x=Me("router-view"),g=ue,$=de,C=le,w=ce,U=ie,z=re;u(`<div${N(F({class:l.value?"backend":"frontend"},f))}>`),u(k(d,{"is-backend":l.value},null,p)),u(k(x,{class:"app-view relative"},{default:B(({Component:A},R,P,W)=>{if(R)R(""),Ze(R,{default:()=>{et(R,_(ge(A),{key:c.value},null),P,W)},_:2});else return[_(Je,{name:v(o),mode:"out-in",onBeforeEnter:h,onAfterEnter:m},{default:B(()=>[(Z(),Q(Ge,{key:c.value,include:r.value},[(Z(),Q(Ke,null,{default:B(()=>[(Z(),Q(ge(A),{key:c.value}))]),_:2},1024))],1032,["include"]))]),_:2},1032,["name"])]}),_:1},p)),u(k(g,{show:v(t)},null,p)),u(k($,{show:v(s)},null,p)),u(k(C,null,null,p)),u(k(w,null,{default:B((A,R,P,W)=>{if(R)R(k(U,null,null,P,W)),R(k(z,null,null,P,W));else return[_(U),_(z)]}),_:1},p)),u("</div>")}}}),xe=fe.setup;fe.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/app.vue"),xe?xe(e,n):void 0};const _t=()=>import("./assets/404-DgQJekxf.js"),X=()=>import("./assets/frontend-index-B3ZtJt7h.js"),kt=()=>import("./assets/frontend-article-C9oPHPvT.js"),bt=()=>import("./assets/frontend-about-CYQdFAnC.js"),yt=()=>import("./assets/frontend-user-BZuJcqZK.js"),St=()=>import("./assets/frontend-user-account-DCiJZTUi.js"),$t=()=>import("./assets/frontend-user-password-CRgXRfyP.js"),xt=()=>import("./assets/backend-login-BcGnSVNS.js"),Rt=()=>import("./assets/backend-index-BGjdZevr.js"),Pt=()=>import("./assets/backend-article-list-iJWvnpbw.js"),Tt=()=>import("./assets/backend-article-insert-B6nChCMx.js"),Mt=()=>import("./assets/backend-article-modify-C1Z2YQyC.js"),Bt=()=>import("./assets/backend-article-comment-CFoBq32K.js"),Ct=()=>import("./assets/backend-category-list-CoVSaL5N.js"),At=()=>import("./assets/backend-category-insert-CKCzU8PZ.js"),Lt=()=>import("./assets/backend-category-modify-Di5i0M1w.js"),Et=()=>import("./assets/backend-admin-list-DhAfa1o9.js"),It=()=>import("./assets/backend-admin-modify-CRrDgBoc.js"),Wt=()=>import("./assets/backend-user-list-BTR9_o6k.js"),jt=()=>import("./assets/backend-user-modify-CHgLwY7I.js");function Ft(e,n,t){const s=Ee.get("user");Ce&&!s?t("/"):t()}function Nt(e,n,t){const s=Ee.get("b_user");Ce&&!s?t("/backend/login"):t()}const S={meta:{index:1,path:"/backend"},beforeEnter:Nt},Ut=[{path:"/index.html",redirect:"/"},{name:"index",path:"/",component:X,meta:{index:1}},{name:"trending",path:"/trending/:by",component:X,meta:{index:1}},{name:"category",path:"/category/:id",component:X,meta:{index:1}},{name:"search",path:"/search/:key",component:X,meta:{index:1}},{name:"article",path:"/article/:id",component:kt,meta:{index:2}},{name:"about",path:"/about",component:bt,meta:{index:1}},{name:"account",path:"/user",component:yt,meta:{index:1},beforeEnter:Ft,children:[{path:"account",component:St,meta:{path:"/user"}},{path:"password",component:$t,meta:{path:"/user"}}]},{name:"backend",path:"/backend",component:Rt,redirect:"/backend/article/list",children:[{name:"login",path:"login",component:xt},{name:"admin_list",path:"admin/list",component:Et,...S},{name:"admin_modify",path:"admin/modify/:id",component:It,...S},{name:"article_list",path:"article/list",component:Pt,...S},{name:"article_insert",path:"article/insert",component:Tt,...S},{name:"article_modify",path:"article/modify/:id",component:Mt,...S},{name:"article_comment",path:"article/comment/:id",component:Bt,...S},{name:"category_list",path:"category/list",component:Ct,...S},{name:"category_insert",path:"category/insert",component:At,...S},{name:"category_modify",path:"category/modify/:id",component:Lt,...S},{name:"user_list",path:"user/list",component:Wt,...S},{name:"user_modify",path:"user/modify/:id",component:jt,...S}]},{name:"404",path:"/:catchAll(.*)",component:_t}];function Dt(e){const n=it({history:ct(),routes:Ut}),t="slide-left",s="slide-right";return n.beforeEach((a,o,r)=>{const i=pe(e),{needPageTransition:c}=oe(i);if(c.value){let l;!o.meta.index||a.meta.index===o.meta.index?l="fade":a.meta.index>o.meta.index?l=t:l=s,i.setPageTransitionName(l)}r()}),n}console.log("当前环境: production");function Ht(){const e=Ye(fe),n=Pe(),t=Dt(n);return e.use(n).use(t).use(ft),{app:e,router:t,store:n}}const je=pt.env.API_URL||"http://127.0.0.1:4000";console.log(`当前API地址: ${je}`);const Ot=new lt({max:1e3,ttl:1e3*10})||null,b={api:`${je}/api/`,timeout:3e4,cached:Ot};function qt(e){if(!e)return"";let n="";return Object.keys(e).forEach(t=>{n+=`${t}=${e[t]}; `}),n}function zt(e){return e=e||{},{api:K.create({baseURL:b.api,headers:{"X-Requested-With":"XMLHttpRequest",cookie:qt(e)},timeout:b.timeout}),getCookies(){return e},async get(t,s,a={}){const o=e.username||"",r=se(t+JSON.stringify(s)+o);if(b.cached&&s.cache&&b.cached.has(r)){const c=b.cached.get(r);return console.log(`${r}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"get",url:t,params:s,headers:{...a}});return b.cached&&s.cache&&b.cached.set(r,i),i&&i.data},async post(t,s,a={}){const o=e.username||"",r=se(t+JSON.stringify(s)+o);if(b.cached&&s.cache&&b.cached.has(r)){const c=b.cached.get(r);return console.log(`${r}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"post",url:t,data:Le.stringify(s),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...a}});return b.cached&&s.cache&&b.cached.set(r,i),i&&i.data}}}function Re(e){return e.endsWith(".js")?`<link rel="modulepreload" crossorigin href="${e}">`:e.endsWith(".css")?`<link rel="stylesheet" href="${e}">`:e.endsWith(".woff")?` <link rel="preload" href="${e}" as="font" type="font/woff" crossorigin>`:e.endsWith(".woff2")?` <link rel="preload" href="${e}" as="font" type="font/woff2" crossorigin>`:e.endsWith(".gif")?` <link rel="preload" href="${e}" as="image" type="image/gif">`:e.endsWith(".jpg")||e.endsWith(".jpeg")?` <link rel="preload" href="${e}" as="image" type="image/jpeg">`:e.endsWith(".png")?` <link rel="preload" href="${e}" as="image" type="image/png">`:""}function Vt(e,n){let t="";const s=new Set;return e.forEach(a=>{const o=n[a];o&&o.forEach(r=>{if(!s.has(r)){s.add(r);const i=De(r);if(n[i])for(const c of n[i])t+=Re(c),s.add(c);t+=Re(r)}})}),t}function Xt(e){return e.replace(/<script(.*?)>/gi,"&lt;script$1&gt;").replace(/<\/script>/g,"&lt;/script&gt;")}async function mn(e,n,t){const{app:s,router:a,store:o}=Ht(),r=He({disableDefaults:!0});s.use(r),s.component("ReloadPrompt",{render:()=>null}).component("VMdEditor",{render:()=>null}),a.push(e),await a.isReady(),a.currentRoute.value.matched.length;const i=a.currentRoute.value.matched.flatMap(u=>Object.values(u.components));q(o).setCookies(t.cookies);try{await Promise.all(i.map(u=>u.asyncData?u.asyncData({store:o,route:a.currentRoute.value,req:t,api:zt(t&&t.cookies)}):null).filter(Boolean))}catch(u){console.log(u)}const l={};let h=await qe(s,l);const{headTags:m}=await Oe(r);h+=`<script>window.__INITIAL_STATE__ = ${Xt(JSON.stringify(o.state.value))}<\/script>`;const y=Vt(l.modules,n);return{html:h,preloadLinks:y,headTags:m,store:o}}export{ce as _,q as a,Ie as b,We as c,ee as d,dn as e,pe as f,mn as render,T as s,un as u};
