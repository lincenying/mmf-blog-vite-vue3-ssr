import{basename as De}from"node:path";import{createHead as He,renderSSRHead as Oe}from"@unhead/vue/server";import{renderToString as Ve}from"@vue/server-renderer";import{createPinia as Pe,defineStore as Te,storeToRefs as oe}from"pinia";import{ref as T,defineComponent as L,unref as h,mergeProps as F,useSSRContext as E,reactive as H,onMounted as ae,computed as G,createElementBlock as ze,toRefs as j,onActivated as Xe,getCurrentInstance as qe,toRef as K,resolveComponent as Me,withCtx as M,createVNode as k,resolveDynamicComponent as ge,Transition as Je,createBlock as Q,openBlock as Z,KeepAlive as Ge,Suspense as Ke,createSSRApp as Ye}from"vue";import{ElMessage as Be,ElLoading as Qe,ElMessageBox as q}from"element-plus";import{ssrRenderAttrs as N,ssrRenderAttr as A,ssrRenderComponent as b,ssrRenderSuspense as Ze,ssrRenderVNode as et}from"vue/server-renderer";import{useWindowSize as tt,useRafFn as nt,useWindowScroll as st,useToggle as ot}from"@vueuse/core";import{strLen as he,isBrowser as Ce,objToCookies as at}from"@lincy/utils";import se from"md5";import{useRoute as Ae,onBeforeRouteLeave as rt,useRouter as it,createRouter as ct,createMemoryHistory as lt}from"vue-router";import Y from"axios";import Le from"qs";import Ee from"js-cookie";import{LRUCache as dt}from"lru-cache";import pt from"node:process";function ut(e){return e.use(Qe),e.config.globalProperties.$msgbox=q,e.config.globalProperties.$alert=q.alert,e.config.globalProperties.$confirm=q.confirm,e.config.globalProperties.$prompt=q.prompt,e.config.globalProperties.$message=Be,e}const mt=Be;function ft(e){ut(e)}const gt={install:ft};function ht(e={}){const{immediate:n=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:a}=e;let i,c;const l=async(m=!0)=>{await c};async function g(){if("serviceWorker"in navigator){if(i=await import("./assets/vendor-CC4K6GI8.js").then(({Workbox:m})=>new m("/sw.js",{scope:"/",type:"classic"})).catch(m=>{a==null||a(m)}),!i)return;i.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),i.addEventListener("installed",m=>{m.isUpdate||o==null||o()}),i.register({immediate:n}).then(m=>{s?s("/sw.js",m):r==null||r(m)}).catch(m=>{a==null||a(m)})}}return c=g(),l}function vt(e={}){const{immediate:n=!0,onNeedRefresh:t,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:a}=e,i=T(!1),c=T(!1);return{updateServiceWorker:ht({immediate:n,onNeedRefresh(){i.value=!0,t==null||t()},onOfflineReady(){c.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:a}),offlineReady:c,needRefresh:i}}const re=L({name:"ReloadPrompt",__name:"reload-prompt",__ssrInlineRender:!0,setup(e){const{needRefresh:n}=vt();return(t,o,r,s)=>{h(n)?o(`<div${N(F({id:"app-refresh",class:"app-refresh"},s))}><div class="app-refresh-wrap"><label>新内容可用，单击刷新按钮更新</label><span>刷新</span><span>关闭</span></div></div>`):o("<!---->")}}}),ve=re.setup;re.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/reload-prompt.vue"),ve?ve(e,n):void 0};const wt="#88888825",ie=L({__name:"bg-plum",__ssrInlineRender:!0,setup(e){const n=Math.PI,t=Math.PI/2,o=Math.PI/12,r=T(null),{random:s}=Math,a=H(tt()),i=T(()=>{}),c=T(4),l=T(6),g=T(!1);function m(d,p=400,u=400,R){const f=d.getContext("2d"),x=window.devicePixelRatio||1,B=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1,w=x/B;return d.style.width=`${p}px`,d.style.height=`${u}px`,d.width=w*p,d.height=w*u,f.scale(w,w),{ctx:f,dpi:w}}function S(d=0,p=0,u=0,R=0){const f=u*Math.cos(R),x=u*Math.sin(R);return[d+f,p+x]}ae(async()=>{const d=r.value,{ctx:p}=m(d,a.width,a.height),{width:u,height:R}=d;let f=[],x=[],B=0;const w=(_,W,C)=>{const Fe=s()*l.value,[U,D]=S(_,W,Fe,C);p.beginPath(),p.moveTo(_,W),p.lineTo(U,D),p.stroke();const Ne=C+s()*o,Ue=C-s()*o;U<-100||U>a.width+100||D<-100||D>a.height+100||((B<=c.value||s()>.5)&&f.push(()=>w(U,D,Ne)),(B<=c.value||s()>.5)&&f.push(()=>w(U,D,Ue)))};let V=performance.now();const z=1e3/40;let I;I=nt(()=>{performance.now()-V<z||(B+=1,x=f,f=[],V=performance.now(),x.length||(I.pause(),g.value=!0),x.forEach(_=>_()))},{immediate:!1}),i.value=()=>{I.pause(),B=0,p.clearRect(0,0,u,R),p.lineWidth=1,p.strokeStyle=wt,x=[],f=[()=>w(s()*a.width,0,t),()=>w(s()*a.width,a.height,-t),()=>w(0,s()*a.height,0),()=>w(a.width,s()*a.height,n)],a.width<500&&(f=f.slice(0,2)),I.resume(),g.value=!1},i.value()});const v=G(()=>"radial-gradient(circle, transparent, black);");return(d,p,u,R)=>{p(`<div${N(F({class:"pointer-events-none fixed bottom-0 left-0 right-0 top-0",style:[{"z-index":"-1"},`mask-image: ${h(v)};--webkit-mask-image: ${h(v)};`]},R))}><canvas width="400" height="400"></canvas></div>`)}}}),we=ie.setup;ie.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/bg-plum.vue"),we?we(e,n):void 0};const ce=L({name:"ClientOnly",props:{fallback:String,placeholder:String,placeholderTag:String,fallbackTag:String},setup(e,{slots:n}){const t=T(!1);return ae(()=>{t.value=!0}),o=>{var i;if(t.value)return(i=n.default)==null?void 0:i.call(n);const r=n.fallback||n.placeholder;if(r)return r();const s=o.fallback||o.placeholder||"",a=o.fallbackTag||o.placeholderTag||"span";return ze(a,null,s)}}}),_e=ce.setup;ce.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/client-only.vue"),_e?_e(e,n):void 0};const le=L({name:"BackTop",__name:"back-top",__ssrInlineRender:!0,setup(e){const{y:n}=st();return(t,o,r,s)=>{o(`<div${N(F({style:h(n)>500?null:{display:"none"},class:"back-top"},s))}><a href="javascript:;"></a></div>`)}}}),ke=le.setup;le.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/back-top.vue"),ke?ke(e,n):void 0};Pe();const O=Te("globalStore",()=>{const e=H({loading:!1,cookies:{},showLoginModal:!1,showRegisterModal:!1,ISDEV:!1,ISPRE:!1,ISPROD:!0}),n=r=>{e.showLoginModal=r},t=r=>{e.showRegisterModal=r},o=r=>{e.cookies=r};return{...j(e),setLoginModal:n,setRegisterModal:t,setCookies:o}}),de=Te("appShellStore",()=>{const e=H({needPageTransition:!0,isPageSwitching:!1,pageTransitionName:"",historyPageScrollTop:{}}),n=()=>{e.needPageTransition=!0},t=()=>{e.needPageTransition=!1},o=a=>{e.isPageSwitching=a},r=a=>{const{path:i,scrollTop:c}=a;e.historyPageScrollTop[i]=c},s=a=>{e.pageTransitionName=a};return{...j(e),enablePageTransition:n,disablePageTransition:t,setPageSwitching:o,saveScrollTop:r,setPageTransitionName:s}});function pn(){const e=qe(),n=e.appContext.config.globalProperties,t=e.type;return{ctx:n,options:t}}function Ie(e,n="auto"){const[t,o]=ot(!1);return async(...r)=>{if(!t.value){o(!0);try{const s=await e(...r);(n===!0||n==="auto"&&s!==!1)&&o(!1)}catch(s){throw o(!1),s}}}}function un(){const e=Ae(),n=de(),{historyPageScrollTop:t}=oe(n);Xe(()=>{const o=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,o)},300)}),ae(()=>{const o=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,o)},300)}),rt((o,r,s)=>{const a=Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop);a!==0&&n.saveScrollTop({path:r.fullPath,scrollTop:a}),s()})}function ee(e,n){return e=e||"123456",e=decodeURIComponent(e),n=n||256,`https://cravatar.cn/avatar/${se(e)}?s=${n}&d=identicon&r=g`}function P(e){let n,t;e?typeof e=="string"?(n=e,t="error"):(n=e.content,t=e.type):(n="接口返回数据错误",t="error"),mt[t](n)}const be={api:"/api/",timeout:3e4};Y.interceptors.request.use(e=>e,e=>Promise.reject(e));Y.interceptors.response.use(e=>e,e=>{const n={};return n.config=e.config,n.data=null,n.headers=e.config.headers,n.status=e.code,n.statusText=e.message,n.request=e.request,Promise.resolve(n)});function te(e){return e.status===200||e.status===304?e.data:e.status===401?{code:401,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:"您还没有登录, 或者登录超时!"}:{code:-404,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:`接口返回数据错误, 错误代码: ${e.status||"未知"}`}}function ne(e){return e.code===-500?window.location.href="/backend":e.code===-400?window.location.href="/":e.code!==200&&P(e.message),e}function _t(){const e=Y.create({baseURL:be.api,headers:{"X-Requested-With":"XMLHttpRequest"},timeout:be.timeout});return{async get(n,t,o={}){const r=await e({method:"get",url:n,params:t,headers:{...o}}),s=te(r);return ne(s)},async post(n,t,o={}){const r=await e({method:"post",url:n,data:Le.stringify(t),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...o}}),s=te(r);return ne(s)},async file(n,t,o={}){const r=await e({method:"post",url:n,data:t,headers:{...o}}),s=te(r);return ne(s)}}}const We=_t(),pe=L({name:"SignUp",__name:"sign-up",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=j(e),o=K(t,"show"),r=O(),s=H({username:"",email:"",password:"",re_password:""});function a(){r.setLoginModal(!0),r.setRegisterModal(!1)}return Ie(async()=>{const i=/^[\w\-.]+@[\w-]+\.[\w-]+$/;if(!s.username||!s.password||!s.email)return P("请将表单填写完整!");if(he(s.username)<4)return P("用户长度至少 2 个中文或 4 个英文!");if(i.test(s.email)){if(he(s.password)<8)return P("密码长度至少 8 位!");if(s.password!==s.re_password)return P("两次输入的密码不一致!")}else return P("邮箱格式错误!");const{code:c,message:l}=await We.post("frontend/user/insert",s);c===200&&(P({type:"success",content:l}),a())}),(i,c,l,g)=>{c(`<div${N(F({class:["modal-wrap modal-signup-wrap",o.value?"active":""]},g))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">注册</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${A("value",h(s).username)} type="text" placeholder="昵称" class="base-input" name="username"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${A("value",h(s).email)} type="text" placeholder="邮箱" class="base-input" name="email"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${A("value",h(s).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${A("value",h(s).re_password)} type="password" placeholder="重复密码" class="base-input" autocomplete="off" name="re_password"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认注册</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">直接登录</a></form></div></div></div>`)}}}),ye=pe.setup;pe.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/sign-up.vue"),ye?ye(e,n):void 0};const ue=L({name:"SignIn",__name:"sign-in",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=j(e),o=K(t,"show");O();const r=H({username:"",password:""});return Ie(async()=>{if(!r.username||!r.password)return P("请将表单填写完整!");const{code:s,message:a}=await We.post("frontend/user/login",r);s===200&&(P({type:"success",content:a}),window.location.reload())}),(s,a,i,c)=>{a(`<div${N(F({class:["modal-wrap modal-sign-in-wrap",o.value?"active":""]},c))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">登录</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${A("value",h(r).username)} type="text" placeholder="昵称" class="base-input" name="username"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${A("value",h(r).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认登录</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">我要注册</a></form></div></div></div>`)}}}),Se=ue.setup;ue.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/sign-in.vue"),Se?Se(e,n):void 0};const me=L({name:"GlobalNavigation",__name:"global-navigation",__ssrInlineRender:!0,props:{isBackend:{type:Boolean}},setup(e){const t=j(e),o=K(t,"isBackend"),r=O(),s=j(r),a=K(s,"cookies"),i=G(()=>!!a.value.user);return it(),(c,l,g,m)=>{const S=Me("router-link");l(`<nav${N(F({class:"global-nav"},m))}><div class="wrap"><div class="left-part">`),l(b(S,{to:"/","active-class":"current",exact:"",class:"logo-link"},{default:M((v,d,p,u)=>{if(d)d(`<i class="icon icon-nav-logo"${u}></i><span class="hidden"${u}>M.M.F 小屋</span>`);else return[k("i",{class:"icon icon-nav-logo"}),k("span",{class:"hidden"},"M.M.F 小屋")]}),_:1},g)),l('<div class="main-nav">'),l(b(S,{to:"/","active-class":"current",exact:"",class:"nav-link"},{default:M((v,d,p,u)=>{if(d)d(`<i class="icon icon-nav-home"${u}></i><span class="text"${u}>首页</span>`);else return[k("i",{class:"icon icon-nav-home"}),k("span",{class:"text"},"首页")]}),_:1},g)),l(b(S,{to:"/trending/visit","active-class":"current",class:"nav-link"},{default:M((v,d,p,u)=>{if(d)d(`<i class="icon icon-nav-explore"${u}></i><span class="text"${u}>热门</span>`);else return[k("i",{class:"icon icon-nav-explore"}),k("span",{class:"text"},"热门")]}),_:1},g)),l(b(S,{to:"/about","active-class":"current",class:"nav-link"},{default:M((v,d,p,u)=>{if(d)d(`<i class="icon icon-nav-features"${u}></i><span class="text"${u}>关于</span>`);else return[k("i",{class:"icon icon-nav-features"}),k("span",{class:"text"},"关于")]}),_:1},g)),l('<a href="https://handle.mmxiaowu.com/" target="_blank" class="nav-link"><i class="icon icon-nav-game"></i><span class="text">汉兜</span></a></div></div>'),o.value?l("<!---->"):(l('<div class="right-part"><span class="nav-search"><i class="icon icon-search-white"></i><input placeholder="记得按回车哦" name="search" class="nav-search-input"></span>'),h(i)?(l('<span class="nav-me">'),l(b(S,{to:"/user/account",class:"nav-me-link"},{default:M((v,d,p,u)=>{if(d)d(`<img${A("src",("useAvatar"in c?c.useAvatar:h(ee))(a.value.useremail,100))} class="nav-avatar-img"${u}>`);else return[k("img",{src:("useAvatar"in c?c.useAvatar:h(ee))(a.value.useremail,100),class:"nav-avatar-img"},null,8,["src"])]}),_:1},g)),l("</span>")):l(`<span class="nav-me"><a href="javascript:;" class="nav-me-link"><img${A("src",("useAvatar"in c?c.useAvatar:h(ee))("noavatar"))} class="nav-avatar-img"></a></span>`),l("</div>")),l("</div></nav>")}}}),$e=me.setup;me.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/components/global-navigation.vue"),$e?$e(e,n):void 0};const fe=L({name:"AppRoot",__name:"app",__ssrInlineRender:!0,setup(e){const n=O(),{showLoginModal:t,showRegisterModal:o,ISDEV:r}=j(n),s=de(),{pageTransitionName:a}=oe(s),i=T("frontend-index,frontend-about"),c=Ae(),l=G(()=>(c.meta.path||c.path).replace(/\//g,"_")),g=G(()=>c.path.includes("backend"));function m(){s.setPageSwitching(!0)}function S(){s.setPageSwitching(!1)}return(v,d,p,u)=>{const R=me,f=Me("router-view"),x=ue,B=pe,w=le,V=ce,z=ie,I=re;d(`<div${N(F({class:g.value?"backend":"frontend",style:h(r)?"display: none;":""},u))}>`),d(b(R,{"is-backend":g.value},null,p)),d(b(f,{class:"app-view relative"},{default:M(({Component:X},_,W,C)=>{if(_)_(""),Ze(_,{default:()=>{et(_,k(ge(X),{key:l.value},null),W,C)},_:2});else return[k(Je,{name:h(a),mode:"out-in",onBeforeEnter:m,onAfterEnter:S},{default:M(()=>[(Z(),Q(Ge,{key:l.value,include:i.value},[(Z(),Q(Ke,null,{default:M(()=>[(Z(),Q(ge(X),{key:l.value}))]),_:2},1024))],1032,["include"]))]),_:2},1032,["name"])]}),_:1},p)),d(b(x,{show:h(t)},null,p)),d(b(B,{show:h(o)},null,p)),d(b(w,null,null,p)),d(b(V,null,{default:M((X,_,W,C)=>{if(_)_(b(z,null,null,W,C)),_(b(I,null,null,W,C));else return[k(z),k(I)]}),_:1},p)),d("</div>")}}}),xe=fe.setup;fe.setup=(e,n)=>{const t=E();return(t.modules||(t.modules=new Set)).add("src/app.vue"),xe?xe(e,n):void 0};const kt=()=>import("./assets/404-DgQJekxf.js"),J=()=>import("./assets/frontend-index-B3ZtJt7h.js"),bt=()=>import("./assets/frontend-article-C9oPHPvT.js"),yt=()=>import("./assets/frontend-about-CYQdFAnC.js"),St=()=>import("./assets/frontend-user-BZuJcqZK.js"),$t=()=>import("./assets/frontend-user-account-DCiJZTUi.js"),xt=()=>import("./assets/frontend-user-password-CRgXRfyP.js"),Rt=()=>import("./assets/backend-login-BcGnSVNS.js"),Pt=()=>import("./assets/backend-index-BGjdZevr.js"),Tt=()=>import("./assets/backend-article-list-iJWvnpbw.js"),Mt=()=>import("./assets/backend-article-insert-mu88U0id.js"),Bt=()=>import("./assets/backend-article-modify-DtcN6tLs.js"),Ct=()=>import("./assets/backend-article-comment-CFoBq32K.js"),At=()=>import("./assets/backend-category-list-CDmrAIzJ.js"),Lt=()=>import("./assets/backend-category-insert-CKCzU8PZ.js"),Et=()=>import("./assets/backend-category-modify-BkFg5D9J.js"),It=()=>import("./assets/backend-admin-list-DhAfa1o9.js"),Wt=()=>import("./assets/backend-admin-modify-B48u9AlI.js"),jt=()=>import("./assets/backend-user-list-BTR9_o6k.js"),Ft=()=>import("./assets/backend-user-modify-Dwx3cYL9.js");function Nt(e,n,t){const o=Ee.get("user");Ce&&!o?t("/"):t()}function Ut(e,n,t){const o=Ee.get("b_user");Ce&&!o?t("/backend/login"):t()}const $={meta:{index:1,path:"/backend"},beforeEnter:Ut},Dt=[{path:"/index.html",redirect:"/"},{name:"index",path:"/",component:J,meta:{index:1}},{name:"trending",path:"/trending/:by",component:J,meta:{index:1}},{name:"category",path:"/category/:id",component:J,meta:{index:1}},{name:"search",path:"/search/:key",component:J,meta:{index:1}},{name:"article",path:"/article/:id",component:bt,meta:{index:2}},{name:"about",path:"/about",component:yt,meta:{index:1}},{name:"account",path:"/user",component:St,meta:{index:1},beforeEnter:Nt,children:[{path:"account",component:$t,meta:{path:"/user"}},{path:"password",component:xt,meta:{path:"/user"}}]},{name:"backend",path:"/backend",component:Pt,redirect:"/backend/article/list",children:[{name:"login",path:"login",component:Rt},{name:"admin_list",path:"admin/list",component:It,...$},{name:"admin_modify",path:"admin/modify/:id",component:Wt,...$},{name:"article_list",path:"article/list",component:Tt,...$},{name:"article_insert",path:"article/insert",component:Mt,...$},{name:"article_modify",path:"article/modify/:id",component:Bt,...$},{name:"article_comment",path:"article/comment/:id",component:Ct,...$},{name:"category_list",path:"category/list",component:At,...$},{name:"category_insert",path:"category/insert",component:Lt,...$},{name:"category_modify",path:"category/modify/:id",component:Et,...$},{name:"user_list",path:"user/list",component:jt,...$},{name:"user_modify",path:"user/modify/:id",component:Ft,...$}]},{name:"404",path:"/:catchAll(.*)",component:kt}];function Ht(e){const n=ct({history:lt(),routes:Dt}),t="slide-left",o="slide-right";return n.beforeEach((r,s,a)=>{const i=de(e),{needPageTransition:c}=oe(i);if(c.value){let l;!s.meta.index||r.meta.index===s.meta.index?l="fade":r.meta.index>s.meta.index?l=t:l=o,i.setPageTransitionName(l)}a()}),n}console.log("当前环境: production");function Ot(){const e=Ye(fe),n=Pe(),t=Ht(n);return e.use(n).use(t).use(gt),{app:e,router:t,store:n}}const je=pt.env.API_URL||"http://127.0.0.1:4000";console.log(`当前API地址: ${je}`);const Vt=new dt({max:1e3,ttl:1e3*10})||null,y={api:`${je}/api/`,timeout:3e4,cached:Vt};function zt(e){return e=e||{},{api:Y.create({baseURL:y.api,headers:{"X-Requested-With":"XMLHttpRequest",cookie:at(e)},timeout:y.timeout}),getCookies(){return e},async get(t,o,r={}){const s=e.username||"",a=se(t+JSON.stringify(o)+s);if(y.cached&&o.cache&&y.cached.has(a)){const c=y.cached.get(a);return console.log(`${a}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"get",url:t,params:o,headers:{...r}});return y.cached&&o.cache&&y.cached.set(a,i),i&&i.data},async post(t,o,r={}){const s=e.username||"",a=se(t+JSON.stringify(o)+s);if(y.cached&&o.cache&&y.cached.has(a)){const c=y.cached.get(a);return console.log(`${a}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"post",url:t,data:Le.stringify(o),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...r}});return y.cached&&o.cache&&y.cached.set(a,i),i&&i.data}}}function Re(e){return e.endsWith(".js")?`<link rel="modulepreload" crossorigin href="${e}">`:e.endsWith(".css")?`<link rel="stylesheet" href="${e}">`:e.endsWith(".woff")?` <link rel="preload" href="${e}" as="font" type="font/woff" crossorigin>`:e.endsWith(".woff2")?` <link rel="preload" href="${e}" as="font" type="font/woff2" crossorigin>`:e.endsWith(".gif")?` <link rel="preload" href="${e}" as="image" type="image/gif">`:e.endsWith(".jpg")||e.endsWith(".jpeg")?` <link rel="preload" href="${e}" as="image" type="image/jpeg">`:e.endsWith(".png")?` <link rel="preload" href="${e}" as="image" type="image/png">`:""}function Xt(e,n){let t="";const o=new Set;return e.forEach(r=>{const s=n[r];s&&s.forEach(a=>{if(!o.has(a)){o.add(a);const i=De(a);if(n[i])for(const c of n[i])t+=Re(c),o.add(c);t+=Re(a)}})}),t}function qt(e){return e.replace(/<script(.*?)>/gi,"&lt;script$1&gt;").replace(/<\/script>/g,"&lt;/script&gt;")}async function mn(e,n,t){const{app:o,router:r,store:s}=Ot(),a=He({disableDefaults:!0});o.use(a).component("ReloadPrompt",{render:()=>null}).component("VMdEditor",{render:()=>null}),e.includes("/backend")&&!e.includes("/login")&&!t.cookies.b_user?await r.push("/backend/login"):e.includes("/user")&&!t.cookies.user?await r.push("/"):await r.push(e),await r.isReady(),r.currentRoute.value.matched.length;const i=r.currentRoute.value.matched.flatMap(v=>Object.values(v.components));O(s).setCookies(t.cookies);try{await Promise.all(i.map(v=>v.asyncData?v.asyncData({store:s,route:r.currentRoute.value,req:t,api:zt(t&&t.cookies)}):null).filter(Boolean))}catch(v){console.log(v)}const l={};let g=await Ve(o,l);const{headTags:m}=await Oe(a);g+=`<script>window.__INITIAL_STATE__ = ${qt(JSON.stringify(s.state.value))}<\/script>`;const S=Xt(l.modules,n);return{html:g,preloadLinks:S,headTags:m,store:s}}export{ce as _,O as a,Ie as b,We as c,ee as d,pn as e,de as f,mn as render,P as s,un as u};
