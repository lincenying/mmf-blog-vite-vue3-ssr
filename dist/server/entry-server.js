import{basename as Oe}from"node:path";import{createHead as Ve,renderSSRHead as ze}from"@unhead/vue/server";import{renderToString as Xe}from"@vue/server-renderer";import{createPinia as Ce,defineStore as Be,storeToRefs as oe}from"pinia";import{ref as C,defineComponent as E,unref as d,mergeProps as L,useSSRContext as I,reactive as O,onMounted as ae,computed as G,toRefs as N,onActivated as qe,getCurrentInstance as Je,toRef as K,createElementBlock as Ge,resolveComponent as re,withCtx as B,createVNode as _,resolveDynamicComponent as ve,Transition as Ke,createBlock as Q,openBlock as Z,KeepAlive as Ye,Suspense as Qe,createSSRApp as Ze}from"vue";import{E as Le,a as et,b as q}from"./assets/vendor-Dh2hNSeG.js";import{ssrRenderAttrs as A,ssrRenderAttr as j,ssrRenderComponent as k,ssrRenderSuspense as tt,ssrRenderVNode as nt}from"vue/server-renderer";import{useWindowSize as st,useRafFn as ot,useToggle as at,useWindowScroll as rt}from"@vueuse/core";import{strLen as we,isBrowser as Ae,objToCookies as it}from"@lincy/utils";import se from"md5";import{useRoute as Ee,onBeforeRouteLeave as ct,useRouter as lt,createRouter as pt,createMemoryHistory as ut}from"vue-router";import Y from"axios";import Ie from"qs";import We from"js-cookie";import{LRUCache as dt}from"lru-cache";import mt from"node:process";import"@vue/shared";import"@popperjs/core";import"lodash-unified";import"dayjs";import"dayjs/plugin/localeData.js";import"dayjs/plugin/customParseFormat.js";import"dayjs/plugin/advancedFormat.js";import"dayjs/plugin/weekOfYear.js";import"dayjs/plugin/weekYear.js";import"dayjs/plugin/dayOfYear.js";import"dayjs/plugin/isSameOrAfter.js";import"dayjs/plugin/isSameOrBefore.js";import"normalize-wheel-es";import"@element-plus/icons-vue";import"@ctrl/tinycolor";function ft(e){return e.use(et),e.config.globalProperties.$msgbox=q,e.config.globalProperties.$alert=q.alert,e.config.globalProperties.$confirm=q.confirm,e.config.globalProperties.$prompt=q.prompt,e.config.globalProperties.$message=Le,e}const gt=Le;function ht(e){ft(e)}const vt={install:ht};function wt(e={}){const{immediate:n=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:a}=e;let i,c;const u=async(l=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(i=await import("./assets/vendor-Dh2hNSeG.js").then(l=>l.w).then(({Workbox:l})=>new l("/sw.js",{scope:"/",type:"classic"})).catch(l=>{a==null||a(l)}),!i)return;i.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),i.addEventListener("installed",l=>{l.isUpdate||o==null||o()}),i.register({immediate:n}).then(l=>{s?s("/sw.js",l):r==null||r(l)}).catch(l=>{a==null||a(l)})}}return c=h(),u}function _t(e={}){const{immediate:n=!0,onNeedRefresh:t,onOfflineReady:o,onRegistered:r,onRegisteredSW:s,onRegisterError:a}=e,i=C(!1),c=C(!1);return{updateServiceWorker:wt({immediate:n,onNeedRefresh(){i.value=!0,t==null||t()},onOfflineReady(){c.value=!0,o==null||o()},onRegistered:r,onRegisteredSW:s,onRegisterError:a}),offlineReady:c,needRefresh:i}}const kt=300*1e3,ie=E({name:"ReloadPrompt",__name:"reload-prompt",__ssrInlineRender:!0,setup(e){const{needRefresh:n}=_t({onRegisteredSW(t,o){o&&setInterval(async()=>{if(o.installing||!navigator||"connection"in navigator&&!navigator.onLine)return;const r=await fetch(t,{cache:"no-store",headers:{cache:"no-store","cache-control":"no-cache"}});(r==null?void 0:r.status)===200&&await o.update()},kt)},onRegisterError(t){console.error("Service worker registration error",t)}});return(t,o,r,s)=>{d(n)?o(`<div${A(L({id:"app-refresh",class:"app-refresh"},s))}><div class="app-refresh-wrap"><label>新内容可用，单击刷新按钮更新</label><span>刷新</span><span>关闭</span></div></div>`):o("<!---->")}}}),_e=ie.setup;ie.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/reload-prompt.vue"),_e?_e(e,n):void 0};const bt="#88888825",ce=E({__name:"bg-plum",__ssrInlineRender:!0,setup(e){const n=Math.PI,t=Math.PI/2,o=Math.PI/12,r=C(null),{random:s}=Math,a=O(st()),i=C(()=>{}),c=C(4),u=C(6),h=C(!1);function l(g,m=400,x=400,T){const f=g.getContext("2d"),$=window.devicePixelRatio||1,W=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1,v=$/W;return g.style.width=`${m}px`,g.style.height=`${x}px`,g.width=v*m,g.height=v*x,f.scale(v,v),{ctx:f,dpi:v}}function S(g=0,m=0,x=0,T=0){const f=x*Math.cos(T),$=x*Math.sin(T);return[g+f,m+$]}ae(async()=>{const g=r.value,{ctx:m}=l(g,a.width,a.height),{width:x,height:T}=g;let f=[],$=[],W=0;const v=(w,P,R)=>{const Ue=s()*u.value,[D,H]=S(w,P,Ue,R);m.beginPath(),m.moveTo(w,P),m.lineTo(D,H),m.stroke();const De=R+s()*o,He=R-s()*o;D<-100||D>a.width+100||H<-100||H>a.height+100||((W<=c.value||s()>.5)&&f.push(()=>v(D,H,De)),(W<=c.value||s()>.5)&&f.push(()=>v(D,H,He)))};let U=performance.now();const z=1e3/40;let F;F=ot(()=>{performance.now()-U<z||(W+=1,$=f,f=[],U=performance.now(),$.length||(F.pause(),h.value=!0),$.forEach(w=>w()))},{immediate:!1}),i.value=()=>{F.pause(),W=0,m.clearRect(0,0,x,T),m.lineWidth=1,m.strokeStyle=bt,$=[],f=[()=>v(s()*a.width,0,t),()=>v(s()*a.width,a.height,-t),()=>v(0,s()*a.height,0),()=>v(a.width,s()*a.height,n)],a.width<500&&(f=f.slice(0,2)),F.resume(),h.value=!1},i.value()});const p=G(()=>"radial-gradient(circle, transparent, black);");return(g,m,x,T)=>{m(`<div${A(L({class:"pointer-events-none fixed bottom-0 left-0 right-0 top-0",style:[{"z-index":"-1"},`mask-image: ${d(p)};--webkit-mask-image: ${d(p)};`]},T))}><canvas width="400" height="400"></canvas></div>`)}}}),ke=ce.setup;ce.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/bg-plum.vue"),ke?ke(e,n):void 0};Ce();const V=Be("globalStore",()=>{const e=O({loading:!1,cookies:{},showLoginModal:!1,showRegisterModal:!1,ISDEV:!1,ISPRE:!1,ISPROD:!0}),n=r=>{e.showLoginModal=r},t=r=>{e.showRegisterModal=r},o=r=>{e.cookies=r};return{...N(e),setLoginModal:n,setRegisterModal:t,setCookies:o}}),le=Be("appShellStore",()=>{const e=O({needPageTransition:!0,isPageSwitching:!1,pageTransitionName:"",historyPageScrollTop:{}}),n=()=>{e.needPageTransition=!0},t=()=>{e.needPageTransition=!1},o=a=>{e.isPageSwitching=a},r=a=>{const{path:i,scrollTop:c}=a;e.historyPageScrollTop[i]=c},s=a=>{e.pageTransitionName=a};return{...N(e),enablePageTransition:n,disablePageTransition:t,setPageSwitching:o,saveScrollTop:r,setPageTransitionName:s}});function Mn(){const e=Je(),n=e.appContext.config.globalProperties,t=e.type;return{ctx:n,options:t}}function je(e,n="auto"){const[t,o]=at(!1);return async(...r)=>{if(!t.value){o(!0);try{const s=await e(...r);(n===!0||n==="auto"&&s!==!1)&&o(!1)}catch(s){throw o(!1),s}}}}function Cn(){const e=Ee(),n=le(),{historyPageScrollTop:t}=oe(n);qe(()=>{const o=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,o)},500)}),ae(()=>{const o=t.value[e.fullPath]||0;setTimeout(()=>{window.scrollTo(0,o)},500)}),ct((o,r,s)=>{const a=Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop);a!==0&&n.saveScrollTop({path:r.fullPath,scrollTop:a}),s()})}function ee(e,n){return e=e||"123456",e=decodeURIComponent(e),n=n||256,`https://cravatar.cn/avatar/${se(e)}?s=${n}&d=identicon&r=g`}function M(e){let n,t;e?typeof e=="string"?(n=e,t="error"):(n=e.content,t=e.type):(n="接口返回数据错误",t="error"),gt[t](n)}const be={api:"/api/",timeout:3e4};Y.interceptors.request.use(e=>e,e=>Promise.reject(e));Y.interceptors.response.use(e=>e,e=>{const n={};return n.config=e.config,n.data=null,n.headers=e.config.headers,n.status=e.code,n.statusText=e.message,n.request=e.request,Promise.resolve(n)});function te(e){return e.status===200||e.status===304?e.data:e.status===401?{code:401,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:"您还没有登录, 或者登录超时!"}:e.status===429?{code:429,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:"请求过于频繁!"}:{code:-404,info:e.statusText||e.toString(),data:e.statusText||e.toString(),message:`接口返回数据错误, 错误代码: ${e.status||"未知"}`}}function ne(e){return e.code===-500?window.location.href="/backend":e.code===-400?window.location.href="/":e.code!==200&&M(e.message),e}function yt(){const e=Y.create({baseURL:be.api,headers:{"X-Requested-With":"XMLHttpRequest"},timeout:be.timeout});return{async get(n,t,o={}){const r=await e({method:"get",url:n,params:t,headers:{...o}}),s=te(r);return ne(s)},async post(n,t,o={}){const r=await e({method:"post",url:n,data:Ie.stringify(t),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...o}}),s=te(r);return ne(s)},async file(n,t,o={}){const r=await e({method:"post",url:n,data:t,headers:{...o}}),s=te(r);return ne(s)}}}const Fe=yt(),pe=E({name:"SignUp",__name:"sign-up",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=N(e),o=K(t,"show"),r=V(),s=O({username:"",email:"",password:"",re_password:""});function a(){r.setLoginModal(!0),r.setRegisterModal(!1)}return je(async()=>{const i=/^[\w\-.]+@[\w-]+\.[\w-]+$/;if(!s.username||!s.password||!s.email)return M("请将表单填写完整!");if(we(s.username)<4)return M("用户长度至少 2 个中文或 4 个英文!");if(i.test(s.email)){if(we(s.password)<8)return M("密码长度至少 8 位!");if(s.password!==s.re_password)return M("两次输入的密码不一致!")}else return M("邮箱格式错误!");const{code:c,message:u}=await Fe.post("frontend/user/insert",s);c===200&&(M({type:"success",content:u}),a())}),(i,c,u,h)=>{c(`<div${A(L({class:["modal-wrap modal-signup-wrap",o.value?"active":""]},h))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">注册</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${j("value",d(s).username)} type="text" placeholder="昵称" class="base-input" name="username" maxlength="20"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${j("value",d(s).email)} type="text" placeholder="邮箱" class="base-input" name="email"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${j("value",d(s).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password" maxlength="20"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${j("value",d(s).re_password)} type="password" placeholder="重复密码" class="base-input" autocomplete="off" name="re_password" maxlength="20"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认注册</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">直接登录</a></form></div></div></div>`)}}}),ye=pe.setup;pe.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/sign-up.vue"),ye?ye(e,n):void 0};const ue=E({name:"SignIn",__name:"sign-in",__ssrInlineRender:!0,props:{show:{type:Boolean}},setup(e){const t=N(e),o=K(t,"show");V();const r=O({username:"",password:""});return je(async()=>{if(!r.username||!r.password)return M("请将表单填写完整!");const{code:s,message:a}=await Fe.post("frontend/user/login",r);s===200&&(M({type:"success",content:a}),window.location.reload())}),(s,a,i,c)=>{a(`<div${A(L({class:["modal-wrap modal-sign-in-wrap",o.value?"active":""]},c))}><span class="center-helper"></span><div class="modal modal-signup"><h2 class="modal-title">登录</h2><a href="javascript:;" class="modal-close"><i class="icon icon-close-black"></i></a><div class="modal-content"><form class="sign-up-form"><div class="input-wrap"><input${j("value",d(r).username)} type="text" placeholder="昵称" class="base-input" name="username" maxlength="20"><p class="error-info input-info hidden">长度至少 6 位</p></div><div class="input-wrap"><input${j("value",d(r).password)} type="password" placeholder="密码" class="base-input" autocomplete="off" name="password" maxlength="20"><p class="error-info input-info hidden">长度至少 6 位</p></div><a href="javascript:;" class="btn sign-up-btn btn-yellow">确认登录</a><a href="javascript:;" class="btn sign-up-btn btn-blue block">我要注册</a></form></div></div></div>`)}}}),Se=ue.setup;ue.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/sign-in.vue"),Se?Se(e,n):void 0};const de=E({name:"ClientOnly",props:{fallback:String,placeholder:String,placeholderTag:String,fallbackTag:String},setup(e,{slots:n}){const t=C(!1);return ae(()=>{t.value=!0}),o=>{var i;if(t.value)return(i=n.default)==null?void 0:i.call(n);const r=n.fallback||n.placeholder;if(r)return r();const s=o.fallback||o.placeholder||"",a=o.fallbackTag||o.placeholderTag||"span";return Ge(a,null,s)}}}),xe=de.setup;de.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/client-only.vue"),xe?xe(e,n):void 0};const me=E({name:"BackTop",__name:"back-top",__ssrInlineRender:!0,setup(e){const{y:n}=rt();return(t,o,r,s)=>{o(`<div${A(L({class:"back-top"},s,{style:d(n)>500?null:{display:"none"}}))}><a href="javascript:;"></a></div>`)}}}),$e=me.setup;me.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/back-top.vue"),$e?$e(e,n):void 0};const fe=E({name:"UserIcon",__name:"user-avatar",__ssrInlineRender:!0,setup(e){const n=V(),t=N(n),o=K(t,"cookies"),r=G(()=>!!o.value.user);return(s,a,i,c)=>{const u=re("router-link");d(r)?(a(`<span${A(L({class:"nav-me"},c))}>`),a(k(u,{to:"/user/account",class:"nav-me-link"},{default:B((h,l,S,p)=>{if(l)l(`<img${j("src",("useAvatar"in s?s.useAvatar:d(ee))(o.value.useremail,100))} class="nav-avatar-img"${p}>`);else return[_("img",{src:("useAvatar"in s?s.useAvatar:d(ee))(o.value.useremail,100),class:"nav-avatar-img"},null,8,["src"])]}),_:1},i)),a("</span>")):a(`<span${A(L({class:"nav-me"},c))}><a href="javascript:;" class="nav-me-link"><img${j("src",("useAvatar"in s?s.useAvatar:d(ee))("noavatar"))} class="nav-avatar-img"></a></span>`)}}}),Re=fe.setup;fe.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/user-avatar.vue"),Re?Re(e,n):void 0};const ge=E({name:"GlobalNavigation",__name:"global-navigation",__ssrInlineRender:!0,props:{isBackend:{type:Boolean}},setup(e){const t=N(e),o=K(t,"isBackend");return lt(),(r,s,a,i)=>{const c=re("router-link"),u=fe;s(`<nav${A(L({class:"global-nav"},i))}><div class="wrap"><div class="left-part">`),s(k(c,{to:"/","active-class":"current",exact:"",class:"logo-link"},{default:B((h,l,S,p)=>{if(l)l(`<i class="icon icon-nav-logo"${p}></i><span class="hidden"${p}>M.M.F 小屋</span>`);else return[_("i",{class:"icon icon-nav-logo"}),_("span",{class:"hidden"},"M.M.F 小屋")]}),_:1},a)),s('<div class="main-nav">'),s(k(c,{to:"/","active-class":"current",exact:"",class:"nav-link"},{default:B((h,l,S,p)=>{if(l)l(`<i class="icon icon-nav-home"${p}></i><span class="text"${p}>首页</span>`);else return[_("i",{class:"icon icon-nav-home"}),_("span",{class:"text"},"首页")]}),_:1},a)),s(k(c,{to:"/trending/visit","active-class":"current",class:"nav-link"},{default:B((h,l,S,p)=>{if(l)l(`<i class="icon icon-nav-explore"${p}></i><span class="text"${p}>热门</span>`);else return[_("i",{class:"icon icon-nav-explore"}),_("span",{class:"text"},"热门")]}),_:1},a)),s(k(c,{to:"/about","active-class":"current",class:"nav-link"},{default:B((h,l,S,p)=>{if(l)l(`<i class="icon icon-nav-features"${p}></i><span class="text"${p}>关于</span>`);else return[_("i",{class:"icon icon-nav-features"}),_("span",{class:"text"},"关于")]}),_:1},a)),s('<a href="https://handle.mmxiaowu.com/" target="_blank" class="nav-link"><i class="icon icon-nav-game"></i><span class="text">汉兜</span></a></div></div>'),o.value?s("<!---->"):(s('<div class="right-part"><span class="nav-search"><i class="icon icon-search-white"></i><input placeholder="记得按回车哦" name="search" class="nav-search-input"></span>'),s(k(u,null,null,a)),s("</div>")),s("</div></nav>")}}}),Te=ge.setup;ge.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/components/global-navigation.vue"),Te?Te(e,n):void 0};const he=E({name:"AppRoot",__name:"app",__ssrInlineRender:!0,setup(e){const n=V(),{showLoginModal:t,showRegisterModal:o,ISDEV:r}=N(n),s=le(),{pageTransitionName:a}=oe(s),i=C("frontend-index,frontend-about"),c=Ee(),u=G(()=>(c.meta.path||c.path).replace(/\//g,"_")),h=G(()=>c.path.includes("backend"));function l(){s.setPageSwitching(!0)}function S(){s.setPageSwitching(!1)}return(p,g,m,x)=>{const T=ge,f=re("router-view"),$=me,W=de,v=ue,U=pe,z=ce,F=ie;g(`<div${A(L({class:h.value?"backend":"frontend",style:d(r)?"display: none;":""},x))}>`),g(k(T,{"is-backend":h.value},null,m)),g(k(f,{class:"app-view relative"},{default:B(({Component:X},w,P,R)=>{if(w)w(""),tt(w,{default:()=>{nt(w,_(ve(X),{key:u.value},null),P,R)},_:2});else return[_(Ke,{name:d(a),mode:"out-in",onBeforeEnter:l,onAfterEnter:S},{default:B(()=>[(Z(),Q(Ye,{key:u.value,include:i.value},[(Z(),Q(Qe,null,{default:B(()=>[(Z(),Q(ve(X),{key:u.value}))]),_:2},1024))],1032,["include"]))]),_:2},1032,["name"])]}),_:1},m)),g(k($,null,null,m)),g(k(W,null,{default:B((X,w,P,R)=>{if(w)w(k(v,{show:d(t)},null,P,R)),w(k(U,{show:d(o)},null,P,R)),w(k(z,null,null,P,R)),w(k(F,null,null,P,R));else return[_(v,{show:d(t)},null,8,["show"]),_(U,{show:d(o)},null,8,["show"]),_(z),_(F)]}),_:1},m)),g("</div>")}}}),Pe=he.setup;he.setup=(e,n)=>{const t=I();return(t.modules||(t.modules=new Set)).add("src/app.vue"),Pe?Pe(e,n):void 0};const St=()=>import("./assets/404-DecOVE9O.js"),J=()=>import("./assets/frontend-index-C0pcgdn0.js"),xt=()=>import("./assets/frontend-article-rCtZz4am.js"),$t=()=>import("./assets/frontend-about-C6l7zHEp.js"),Rt=()=>import("./assets/frontend-user-CcL-5TVM.js"),Tt=()=>import("./assets/frontend-user-account-DqOqLKC2.js"),Pt=()=>import("./assets/frontend-user-password-DtGUkXwL.js"),Mt=()=>import("./assets/backend-login-BGYwYnSr.js"),Ct=()=>import("./assets/backend-index-BGjdZevr.js"),Bt=()=>import("./assets/backend-article-list-BdU1-pfZ.js"),Lt=()=>import("./assets/backend-article-insert-BAxWMOt8.js"),At=()=>import("./assets/backend-article-modify-Cy1UjQpz.js"),Et=()=>import("./assets/backend-article-comment-BsmTYkfQ.js"),It=()=>import("./assets/backend-category-list-CLo3L2vg.js"),Wt=()=>import("./assets/backend-category-insert-Dnv-CxmA.js"),jt=()=>import("./assets/backend-category-modify-D3aiKD-O.js"),Ft=()=>import("./assets/backend-admin-list-z94HBO8c.js"),Nt=()=>import("./assets/backend-admin-modify-DjKU6b4_.js"),Ut=()=>import("./assets/backend-user-list-SrTIyLPZ.js"),Dt=()=>import("./assets/backend-user-modify-BXjCoMXw.js");function Ht(e,n,t){const o=We.get("user");Ae&&!o?t("/"):t()}function Ot(e,n,t){const o=We.get("b_user");Ae&&!o?t("/backend/login"):t()}const y={meta:{index:1,path:"/backend"},beforeEnter:Ot},Vt=[{path:"/index.html",redirect:"/"},{name:"index",path:"/",component:J,meta:{index:1}},{name:"trending",path:"/trending/:by",component:J,meta:{index:1}},{name:"category",path:"/category/:id",component:J,meta:{index:1}},{name:"search",path:"/search/:key",component:J,meta:{index:1}},{name:"article",path:"/article/:id",component:xt,meta:{index:2}},{name:"about",path:"/about",component:$t,meta:{index:1}},{name:"account",path:"/user",component:Rt,meta:{index:1},beforeEnter:Ht,children:[{path:"account",component:Tt,meta:{path:"/user"}},{path:"password",component:Pt,meta:{path:"/user"}}]},{name:"backend",path:"/backend",component:Ct,redirect:"/backend/article/list",children:[{name:"login",path:"login",component:Mt},{name:"admin_list",path:"admin/list",component:Ft,...y},{name:"admin_modify",path:"admin/modify/:id",component:Nt,...y},{name:"article_list",path:"article/list",component:Bt,...y},{name:"article_insert",path:"article/insert",component:Lt,...y},{name:"article_modify",path:"article/modify/:id",component:At,...y},{name:"article_comment",path:"article/comment/:id",component:Et,...y},{name:"category_list",path:"category/list",component:It,...y},{name:"category_insert",path:"category/insert",component:Wt,...y},{name:"category_modify",path:"category/modify/:id",component:jt,...y},{name:"user_list",path:"user/list",component:Ut,...y},{name:"user_modify",path:"user/modify/:id",component:Dt,...y}]},{name:"404",path:"/:catchAll(.*)",component:St}];function zt(e){const n=pt({history:ut(),routes:Vt}),t="slide-left",o="slide-right";return n.beforeEach((r,s,a)=>{const i=le(e),{needPageTransition:c}=oe(i);if(c.value){let u;!s.meta.index||r.meta.index===s.meta.index?u="fade":r.meta.index>s.meta.index?u=t:u=o,i.setPageTransitionName(u)}a()}),n}console.log("当前环境: production");function Xt(){const e=Ze(he),n=Ce(),t=zt(n);return e.use(n).use(t).use(vt),{app:e,router:t,store:n}}const Ne=mt.env.API_URL||"http://127.0.0.1:4000";console.log(`当前API地址: ${Ne}`);const qt=new dt({max:1e3,ttl:1e3*10})||null,b={api:`${Ne}/api/`,timeout:3e4,cached:qt};function Jt(e){return e=e||{},{api:Y.create({baseURL:b.api,headers:{"X-Requested-With":"XMLHttpRequest",cookie:it(e)},timeout:b.timeout}),getCookies(){return e},async get(t,o,r={}){const s=e.username||"",a=se(t+JSON.stringify(o)+s);if(b.cached&&o.cache&&b.cached.has(a)){const c=b.cached.get(a);return console.log(`${a}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"get",url:t,params:o,headers:{...r}});return b.cached&&o.cache&&b.cached.set(a,i),i&&i.data},async post(t,o,r={}){const s=e.username||"",a=se(t+JSON.stringify(o)+s);if(b.cached&&o.cache&&b.cached.has(a)){const c=b.cached.get(a);return console.log(`${a}: 命中缓存`),Promise.resolve(c&&c.data)}const i=await this.api({method:"post",url:t,data:Ie.stringify(o),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",...r}});return b.cached&&o.cache&&b.cached.set(a,i),i&&i.data}}}function Me(e){return e.endsWith(".js")?`<link rel="modulepreload" crossorigin href="${e}">`:e.endsWith(".css")?`<link rel="stylesheet" href="${e}">`:e.endsWith(".woff")?` <link rel="preload" href="${e}" as="font" type="font/woff" crossorigin>`:e.endsWith(".woff2")?` <link rel="preload" href="${e}" as="font" type="font/woff2" crossorigin>`:e.endsWith(".gif")?` <link rel="preload" href="${e}" as="image" type="image/gif">`:e.endsWith(".jpg")||e.endsWith(".jpeg")?` <link rel="preload" href="${e}" as="image" type="image/jpeg">`:e.endsWith(".png")?` <link rel="preload" href="${e}" as="image" type="image/png">`:""}function Gt(e,n){let t="";const o=new Set;return e.forEach(r=>{const s=n[r];s&&s.forEach(a=>{if(!o.has(a)){o.add(a);const i=Oe(a);if(n[i])for(const c of n[i])t+=Me(c),o.add(c);t+=Me(a)}})}),t}function Kt(e){return e.replace(/<script(.*?)>/gi,"&lt;script$1&gt;").replace(/<\/script>/g,"&lt;/script&gt;")}async function Bn(e,n,t){const{app:o,router:r,store:s}=Xt(),a=Ve({disableDefaults:!0});o.use(a).component("ReloadPrompt",{render:()=>null}).component("VMdEditor",{render:()=>null}),e.includes("/backend")&&!e.includes("/login")&&!t.cookies.b_user?await r.push("/backend/login"):e.includes("/user")&&!t.cookies.user?await r.push("/"):await r.push(e),await r.isReady(),r.currentRoute.value.matched.length;const i=r.currentRoute.value.matched.flatMap(p=>Object.values(p.components));V(s).setCookies(t.cookies);try{await Promise.all(i.map(p=>p.asyncData?p.asyncData({store:s,route:r.currentRoute.value,req:t,api:Jt(t&&t.cookies)}):null).filter(Boolean))}catch(p){console.log(p)}const u={};let h=await Xe(o,u);const{headTags:l}=await ze(a);h+=`<script>window.__INITIAL_STATE__ = ${Kt(JSON.stringify(s.state.value))}<\/script>`;const S=Gt(u.modules,n);return{html:h,preloadLinks:S,headTags:l,store:s}}export{de as _,V as a,je as b,Fe as c,ee as d,Mn as e,le as f,Bn as render,M as s,Cn as u};
